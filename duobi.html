<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <title>åœ°çƒå¨±ä¹ä¸­å¿ƒ</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg1:#89f7fe;
      --bg2:#66a6ff;
      --card: rgba(255,255,255,0.06);
      --glass: rgba(255,255,255,0.08);
      --accent: #ffd54a;
      --danger: #ff4c4c;
      --soft: rgba(255,255,255,0.12);
      --text-color: #fff;
    }
    /* Dark theme styles */
    body.dark-theme {
      --bg1: #2c3e50;
      --bg2: #34495e;
      --card: rgba(0,0,0,0.2);
      --glass: rgba(0,0,0,0.15);
      --accent: #f39c12;
      --danger: #e74c3c;
      --soft: rgba(255,255,255,0.08);
      --text-color: #ecf0f1;
    }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:"Microsoft Yahei", "PingFang SC", "Noto Sans SC", sans-serif;background: linear-gradient(120deg,var(--bg1),var(--bg2)); color:var(--text-color); transition: background 0.5s ease, color 0.5s ease;}
    .app {
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
      transition: background 1s;
    }

    .card {
      width:100%;
      max-width:980px;
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      border-radius:18px;
      padding:28px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.25);
      backdrop-filter: blur(6px);
      transition: background 0.5s ease, box-shadow 0.5s ease;
    }

    header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    header h1{margin:0;font-size:1.4rem;display:flex;align-items:center;gap:10px}
    header .sub {opacity:0.85;font-size:0.9rem}

    /* pages */
    .page { display:none; padding:24px 0; min-height:420px; }
    .page.active { display:block; animation:fadeIn .35s ease; }
    @keyframes fadeIn { from {opacity:0; transform: translateY(6px)} to {opacity:1; transform: translateY(0)} }

    /* name input */
    .center { display:flex; align-items:center; justify-content:center; flex-direction:column; gap:12px; padding:30px 0;}
    input[type="text"] {
      padding:12px 16px;
      border-radius:12px;
      border: none;
      width:320px;
      max-width:90%;
      background:var(--glass);
      color:var(--text-color);
      font-size:1rem;
      outline: none;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.02);
      transition: transform .14s ease, box-shadow .14s ease, background 0.3s ease;
    }
    input[type="text"]:focus { transform: translateY(-4px); box-shadow: 0 8px 24px rgba(0,0,0,0.25); }
    select {
      padding:8px 12px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.12);
      background: var(--card);
      color:var(--text-color);
      font-size:0.9rem;
      outline: none;
      cursor: pointer;
      transition: background 0.3s ease, color 0.3s ease;
    }

    /* Math game specific styles */
    #mathDifficulty .btn {
      min-width: 80px;
      flex-grow: 1; /* Make buttons expand evenly */
      justify-content: center; /* Center text in button */
    }
    #mathProgressBar {
      background: linear-gradient(90deg, #2ecc71, #f1c40f, #e74c3c); /* Green -> Yellow -> Red */
      transition: width 0.1s linear; /* Smooth transition for width changes */
      transform-origin: left; /* Make it shrink from the right */
    }
    #mathAnswerInput {
      font-weight: 600;
      letter-spacing: 0.5px;
    }
    #mathAnswerInput:focus {
      transform: none; /* Override default input animation */
      box-shadow: 0 0 0 1px var(--accent); /* More subtle focus */
    }
    @media (max-width:720px){
      #mathDifficulty{
        flex-direction: column; /* Stack difficulty buttons on small screens */
      }
      #mathDifficulty .btn{
        min-width: unset; /* Remove min-width for stacking */
      }
    }

    .hint, .error {
      margin-top:6px;
      font-weight:600;
    }
    .hint { color: var(--accent); }
    .error { color: var(--danger); animation: none; }

    .error.shake {
      animation: shake .35s;
    }
    @keyframes shake {
      0%,100%{ transform:translateX(0);}
      25%{ transform:translateX(-8px);}
      50%{ transform:translateX(8px);}
      75%{ transform:translateX(-6px);}
    }

    /* buttons */
    .btn {
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:10px 18px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.12);
      background: var(--card);
      color:var(--text-color);
      cursor:pointer;
      font-weight:600;
      transition: transform .16s ease, box-shadow .16s ease, background .16s, color 0.3s ease;
      user-select:none;
    }
    .btn:hover { transform: scale(1.06); box-shadow: 0 10px 30px rgba(0,0,0,0.28); background: rgba(255,255,255,0.06); }
    .btn.small { padding:6px 10px; border-radius:8px; font-weight:600; }
    .btn.accent { background: linear-gradient(90deg,#ffd54a,#ffb74d); color:#222; border:none; }
    .btn.ghost { background: transparent; border:1px solid rgba(255,255,255,0.06); }

    /* main menu layout */
    .welcome { display:flex; align-items:center; gap:20px; flex-wrap:wrap; }
    .welcome h2 { margin:0; font-size:1.7rem; }
    .menu { display:flex; gap:14px; flex-wrap:wrap; margin-top:18px; }
    .game-card {
      min-width:180px;
      width:220px;
      padding:18px;
      border-radius:14px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      display:flex;
      flex-direction:column;
      gap:10px;
      align-items:flex-start;
      transition: transform .16s ease, box-shadow .16s, background 0.3s ease;
    }
    .game-card:hover { transform: translateY(-6px) scale(1.03); box-shadow: 0 18px 40px rgba(0,0,0,0.35); }
    .game-card h3 { margin:0; font-size:1.05rem; }
    .game-card p { margin:0; opacity:0.85; font-size:0.95rem; }

    /* area for games */
    .game-area { margin-top:20px; }

    /* Stone game */
    #stoneCanvas {background: linear-gradient(180deg,#e6f6ff00,#ffffff0a); border-radius:12px; display:block; width:100%; height:400px; touch-action:none; }
    .stone-controls { margin-top:10px; display:flex; gap:10px; align-items:center; }

    /* Wordle style */
    .wordle-board { display:grid; grid-template-columns: repeat(5, 56px); gap:8px; justify-content:center; margin:16px 0; }
    .cell { width:56px; height:56px; border-radius:8px; background: rgba(255,255,255,0.03); display:flex; align-items:center; justify-content:center; font-weight:800; font-size:20px; text-transform:uppercase; transition: background 0.3s ease, color 0.3s ease, transform 0.1s ease; }
    .cell.correct { background: #6aaa64; color:#fff; }
    .cell.present { background: #c9b458; color:#fff; }
    .cell.absent { background: rgba(255,255,255,0.08); color:#ddd; opacity:0.9; }

    /* Wordle Animations */
    .cell.pop {
      animation: pop 0.1s ease-out;
    }
    @keyframes pop {
      0% { transform: scale(0.8); opacity: 0.7; }
      100% { transform: scale(1); opacity: 1; }
    }

    .cell.flip-in {
      animation: flip-in 0.3s forwards;
    }
    .cell.flip-out {
      animation: flip-out 0.3s 0.3s forwards; /* Delay the second half */
    }
    @keyframes flip-in {
      0% { transform: rotateX(0deg); background: rgba(255,255,255,0.03); }
      50% { transform: rotateX(90deg); background: rgba(255,255,255,0.03); }
      100% { transform: rotateX(90deg); } /* Hold at 90deg */
    }
    @keyframes flip-out {
      0% { transform: rotateX(90deg); }
      50% { transform: rotateX(90deg); } /* Start from 90deg */
      100% { transform: rotateX(0deg); }
    }

    .row-shake {
      animation: shake .4s;
    }

    .keyboard { margin-top:12px; display:flex; gap:8px; flex-wrap:wrap; justify-content:center; }

    .kbd-btn {
      min-width:36px;padding:10px;border-radius:6px;background:var(--soft);border:1px solid rgba(255,255,255,0.04);cursor:pointer;text-align:center;font-weight:700;
      transition: transform .12s ease, background 0.3s ease, color 0.3s ease;
    }
    .kbd-btn:hover{ transform:scale(1.06); }
    .kbd-btn.big{ min-width:64px; }

    /* 2048 grid */
    .grid-2048 {
      width:100%;
      max-width:420px;
      margin:10px auto;
      display:grid;
      grid-template-columns: repeat(4,1fr);
      gap:12px;
      padding:12px;
      border-radius:12px;
      background: rgba(0,0,0,0.12);
      touch-action: none; /* Prevent default touch actions like scrolling/zooming */
    }
    .tile {
      height:84px; display:flex;align-items:center;justify-content:center;border-radius:10px;font-weight:800;font-size:24px;background:rgba(255,255,255,0.03);
      transition: transform .12s ease, background .18s, color .18s; /* Added color to transition */
    }
    .tile.t2{ background:#eee4da;color:#776e65 }
    .tile.t4{ background:#ede0c8;color:#776e65 }
    .tile.t8{ background:#f2b179;color:#fff }
    .tile.t16{ background:#f59563;color:#fff }
    .tile.t32{ background:#f67c5f;color:#fff }
    .tile.t64{ background:#f65e3b;color:#fff }
    .tile.t128{ background:#edcf72;color:#fff;font-size:20px }
    .tile.t256{ background:#edcc61;color:#fff;font-size:20px }
    .tile.t512{ background:#edc850;color:#fff;font-size:20px }
    .tile.t1024{ background:#edc53f;color:#fff;font-size:18px }
    .tile.t2048{ background:#edc22e;color:#fff;font-size:18px }

    /* Dark theme 2048 tiles */
    .dark-theme .tile.t2{ background:#776e65; color:#eee4da; }
    .dark-theme .tile.t4{ background:#776e65; color:#ede0c8; }
    /* Other tiles remain the same as their colors are strong enough */


    /* 2048 Animations */
    .tile.new-tile {
      animation: pop-2048 0.2s ease-out;
    }
    @keyframes pop-2048 {
      0% { transform: scale(0); }
      100% { transform: scale(1); }
    }
    .score-board {
      display: flex;
      justify-content: space-between;
      width: 100%;
      max-width: 420px;
      margin: 0 auto 10px;
      font-weight: 700;
      color: rgba(255,255,255,0.9);
      background: rgba(0,0,0,0.1);
      padding: 8px 15px;
      border-radius: 8px;
    }


    /* small helper */
    .row { display:flex; gap:10px; align-items:center; }
    #bulletHellCanvas {
      background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.01));
      box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
    }
    #bulletHellLives {
      color: var(--danger);
    }
    .muted { opacity:0.78; font-size:0.95rem }
    footer { margin-top:16px; display:flex; gap:10px; justify-content:flex-end; align-items:center; opacity:0.95; }
    @media (max-width:720px){
      .game-card{ width:48% }
      .keyboard{ gap:6px }
      .wordle-board{ gap:6px }
      .cell{ width:44px;height:44px;font-size:18px }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <header>
        <div>
          <h1 data-i18n-key="title"></h1>
          <div class="sub" data-i18n-key="subtitle"></div>
        </div>
        <div style="display:flex;gap:10px;align-items:center">
          <div id="userBadge" style="opacity:0.9;font-weight:700" data-i18n-key="notLoggedIn"></div>
          <button class="btn small ghost" id="toHomeBtn" style="display:none" data-i18n-key="returnToHome"></button>
          <!-- Language Selector -->
          <select id="languageSelector" class="btn small ghost">
            <option value="zh-CN" data-i18n-key="zhLangName"></option>
            <option value="en-US" data-i18n-key="enLangName"></option>
            <option value="fr-FR" data-i18n-key="frLangName"></option> <!-- New: French option -->
            <option value="ja-JP" data-i18n-key="jaLangName"></option> <!-- New: Japanese option -->
          </select>
          <!-- Theme Toggle -->
          <button class="btn small ghost" id="themeToggle">ğŸŒ™</button>
        </div>
      </header>

      <!-- PAGE: name input -->
      <section id="page-name" class="page active">
        <div class="center">
          <h2 data-i18n-key="welcomePrompt"></h2>
          <input id="nameInput" data-i18n-placeholder="inputPlaceholder" />
          <div style="display:flex;gap:10px">
            <button class="btn accent" id="enterBtn" data-i18n-key="enterBtn"></button>
            <button class="btn small ghost" id="demoBtn" data-i18n-key="demoBtn"></button>
          </div>
          <!-- Renamed from hintText to dynamicHintMsg for dynamic alerts -->
          <div id="dynamicHintMsg" class="hint" style="height:24px"></div>
          <!-- Added new div for static hint text that may contain HTML -->
          <div class="muted" style="margin-top:6px;" data-i18n-html="hintEasterEgg"></div>
        </div>
      </section>

      <!-- PAGE: main menu -->
      <section id="page-main" class="page">
        <div class="welcome">
          <div>
            <h2 id="welcomeText"></h2> <!-- This is set dynamically in JS, no data-i18n-key needed here -->
            <div class="muted" data-i18n-key="chooseGame"></div>
          </div>
        </div>

        <div class="menu" aria-hidden="false">
          <div class="game-card">
            <h3 data-i18n-key="stoneGameTitle"></h3>
            <p data-i18n-key="stoneGameDesc"></p>
            <div style="display:flex;gap:8px;margin-top:auto">
              <button class="btn" id="openStone" data-i18n-key="startBtn"></button>
              <button class="btn small ghost" id="stoneInfo" data-i18n-key="infoBtn"></button>
            </div>
          </div>

          <div class="game-card">
            <h3 data-i18n-key="wordleTitle"></h3>
            <p data-i18n-key="wordleDesc"></p>
            <div style="display:flex;gap:8px;margin-top:auto">
              <button class="btn" id="openWordle" data-i18n-key="startBtn"></button>
              <button class="btn small ghost" id="wordleInfo" data-i18n-key="infoBtn"></button>
            </div>
          </div> 

          <div class="game-card">
            <h3 data-i18n-key="game2048Title"></h3>
            <p data-i18n-key="game2048Desc"></p>
            <div style="display:flex;gap:8px;margin-top:auto">
              <button class="btn" id="open2048" data-i18n-key="startBtn"></button>
              <button class="btn small ghost" id="g2048Info" data-i18n-key="infoBtn"></button>
            </div>
          </div>

          <div class="game-card">
            <h3 data-i18n-key="bulletHellTitle"></h3>
            <p data-i18n-key="bulletHellDesc"></p>
            <div style="display:flex;gap:8px;margin-top:auto">
              <button class="btn" id="openBulletHell" data-i18n-key="startBtn"></button>
              <button class="btn small ghost" id="bulletHellInfo" data-i18n-key="infoBtn"></button>
            </div>
          </div>

          <div class="game-card" style="min-width:120px">
            <h3 data-i18n-key="toolsTitle"></h3>
            <p data-i18n-key="toolsDesc"></p>
            <div style="display:flex;gap:8px;margin-top:auto">
              <button class="btn" id="openTools" data-i18n-key="openBtn"></button>
            </div>
          </div>

          <div class="game-card" style="min-width:120px">
            <h3 data-i18n-key="learningTitle"></h3>
            <p data-i18n-key="learningDesc"></p>
            <div style="display:flex;gap:8px;margin-top:auto">
              <button class="btn" id="openLearning" data-i18n-key="openBtn"></button>
            </div>
          </div>

          <div class="game-card" style="min-width:120px">
            <h3 data-i18n-key="notepadTitle"></h3>
            <p data-i18n-key="notepadDesc"></p>
            <div style="display:flex;gap:8px;margin-top:auto">
              <button class="btn" id="openNotepad" data-i18n-key="openBtn"></button>
            </div>
          </div>
        </div>

        <div class="game-area" id="mainToolArea"></div>
      </section>

      <!-- PAGE: stone -->
      <section id="page-stone" class="page">
        <h2 data-i18n-key="stoneGamePageTitle"></h2>
        <canvas id="stoneCanvas"></canvas>
        <div class="stone-controls">
          <button class="btn" id="resetStone" data-i18n-key="resetStone"></button>
          <button class="btn small ghost" id="stoneBack" data-i18n-key="returnToHome"></button>
          <div style="margin-left: 20px; display:flex; align-items:center; gap: 8px;">
            <label for="elasticityRange" data-i18n-key="elasticityLabel"></label>
            <input type="range" id="elasticityRange" min="0.1" max="0.95" step="0.05" value="0.82" style="width:120px;" />
          </div>
          <div class="muted" style="margin-left:auto" data-i18n-key="stoneHint"></div>
        </div>
      </section>

      <!-- PAGE: learning -->
    <section id="page-learning" class="page">
        <h2 data-i18n-key="learningPageTitle"></h2>
        <div class="menu" style="margin-top:20px; justify-content:center;">
            <div class="game-card">
                <h3 data-i18n-key="mathGameTitle"></h3>
                <p data-i18n-key="mathGameDesc"></p>
                <div style="display:flex;gap:8px;margin-top:auto">
                    <button class="btn" id="openMath" data-i18n-key="startBtn"></button>
                    <button class="btn small ghost" id="mathInfo" data-i18n-key="infoBtn"></button>
                </div>
            </div>
            <!-- æœªæ¥å¯ä»¥æ·»åŠ æ›´å¤šå­¦ä¹ æ¸¸æˆï¼Œä¾‹å¦‚ï¼š
            <div class="game-card">
                <h3 data-i18n-key="languageGameTitle"></h3>
                <p data-i18n-key="languageGameDesc"></p>
                <div style="display:flex;gap:8px;margin-top:auto">
                    <button class="btn" id="openLanguage" data-i18n-key="startBtn"></button>
                </div>
            </div>
            -->
        </div>
        <div style="margin-top:20px; text-align:center;">
            <button class="btn small ghost" id="learningBack" data-i18n-key="returnToHome"></button>
        </div>
    </section>

    <!-- PAGE: math -->
    <section id="page-math" class="page">
      <h2 data-i18n-key="mathGamePageTitle"></h2>
      <div style="display:flex;flex-direction:column;align-items:center;width:100%;max-width:500px;margin:0 auto;">
        <div id="mathDifficulty" style="display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap;justify-content:center;">
          <button class="btn small" data-difficulty="easy" data-i18n-key="difficultyEasy"></button>
          <button class="btn small" data-difficulty="medium" data-i18n-key="difficultyMedium"></button>
          <button class="btn small" data-difficulty="hard" data-i18n-key="difficultyHard"></button>
          <button class="btn small" data-difficulty="expert" data-i18n-key="difficultyExpert"></button>
          <button class="btn small" data-difficulty="master" data-i18n-key="difficultyMaster"></button>
        </div>

        <div id="mathGameArea" style="width:100%; display:none; flex-direction:column; align-items:center;">
          <div class="score-board" style="width:100%; margin-bottom:15px; background: rgba(0,0,0,0.1); padding: 8px 15px; border-radius: 8px;">
            <div id="mathScore" style="font-weight:700; color:rgba(255,255,255,0.9);" data-i18n-key="score"></div>
            <div id="mathQuestionCount" style="font-weight:700; color:rgba(255,255,255,0.9);" data-i18n-key="questionCount"></div>
          </div>

          <div id="mathProgressBarContainer" style="width:100%; height:12px; background:rgba(0,0,0,0.2); border-radius:6px; margin-bottom:20px; overflow:hidden;">
            <div id="mathProgressBar" style="height:100%; width:100%; background:linear-gradient(90deg, #2ecc71, #f1c40f, #e74c3c); transform-origin: left; transition: width 0.1s linear;"></div>
          </div>

          <h3 id="mathQuestion" style="font-size:1.5rem; margin-bottom:20px; text-align:center;"></h3>
          <input type="text" id="mathAnswerInput" data-i18n-placeholder="mathAnswerPlaceholder" style="width:200px; text-align:center; margin-bottom:15px;" />
          <div id="mathMessage" class="hint" style="height:24px; margin-bottom:15px;"></div>
          
          <div style="display:flex;gap:8px;margin-top:10px;">
            <button class="btn accent" id="mathNextQuestionBtn" data-i18n-key="mathSubmitAnswer"></button>
            <button class="btn" id="mathRestartBtn" data-i18n-key="restartGame"></button>
            <button class="btn small ghost" id="mathBack" data-i18n-key="returnToLearning"></button>
          </div>
        </div>
      </div>
    </section>

      <!-- PAGE: wordle -->
      <section id="page-wordle" class="page">
        <h2 data-i18n-key="wordleGamePageTitle"></h2>
        <div id="wordleBoard" style="display:flex;flex-direction:column;align-items:center">
          <div id="boardGrid" class="wordle-board"></div>
          <div id="wordleMsg" style="height:30px;margin-top:8px"></div>
          <div class="keyboard" id="keyboardArea"></div>
          <div style="margin-top:12px; display:flex; gap:8px;">
            <button class="btn" id="wordleRestart" data-i18n-key="restartGame"></button>
            <button class="btn small ghost" id="wordleBack" data-i18n-key="returnToHome"></button>
          </div>
        </div>
      </section>

      <!-- PAGE: 2048 -->
      <section id="page-2048" class="page">
        <h2 data-i18n-key="game2048PageTitle"></h2>
        <div style="display:flex;gap:12px;align-items:center;flex-direction:column">
          <div class="score-board">
            <div id="score2048"></div> <!-- This is dynamically set in JS, no data-i18n-key needed -->
            <div id="bestScore2048"></div> <!-- This is dynamically set in JS, no data-i18n-key needed -->
          </div>
          <div class="grid-2048" id="grid2048"></div>
          <div style="display:flex;gap:8px;">
            <button class="btn" id="g2048Restart" data-i18n-key="game2048Restart"></button>
            <button class="btn small ghost" id="g2048Back" data-i18n-key="returnToHome"></button>
          </div>
        </div>
      </section>

      <section id="page-bullet-hell" class="page">
        <h2 data-i18n-key="bulletHellPageTitle"></h2>
        <div style="display:flex;flex-direction:column;align-items:center;width:100%;max-width:600px;margin:0 auto;">
          <div class="score-board" style="width:100%">
            <div id="bulletHellScore" data-i18n-key="score" data-i18n-suffix="0">åˆ†æ•°ï¼š0</div>
            <div id="bulletHellBestScore" data-i18n-key="bestScore" data-i18n-suffix="0">æœ€é«˜åˆ†ï¼š0</div>
            <div id="bulletHellLives" data-i18n-key="lives" data-i18n-suffix="5">ç”Ÿå‘½ï¼š5</div>
          </div>
          <canvas id="bulletHellCanvas" width="500" height="400" style="background: rgba(0,0,0,0.2); border-radius:12px; display:block; margin-top:10px;"></canvas>
          <div id="bulletHellGameMessage" style="color:var(--accent); font-weight:bold; margin-top:10px;"></div>
          <div style="margin-top:12px; display:flex; gap:8px;">
            <button class="btn accent" id="bulletHellStartBtn" data-i18n-key="bulletHellStartButton"></button>
            <button class="btn small ghost" id="bulletHellBack" data-i18n-key="returnToHome"></button>
          </div>
        </div>
      </section>

      <section id="page-notepad" class="page">
        <h2 data-i18n-key="notepadPageTitle"></h2>
        <textarea id="notepadContent" style="width:100%; height:300px; margin-top:15px; padding:15px; border-radius:12px; border:1px solid var(--soft); background:var(--card); color:var(--text-color); font-size:1rem; resize:vertical; outline:none; box-shadow: inset 0 0 0 1px rgba(255,255,255,0.02); transition: background 0.3s ease, color 0.3s ease;"></textarea>
        <div style="margin-top:15px; display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
          <button class="btn accent" id="saveNotepadBtn" data-i18n-key="saveTextBtn"></button>
          <button class="btn" id="loadNotepadBtn" data-i18n-key="loadTextBtn"></button>
          <button class="btn small ghost" id="notepadBack" data-i18n-key="returnToHome"></button>
        </div>
        <div id="notepadOutput" style="margin-top:15px; word-break: break-all; background:var(--soft); padding:10px; border-radius:8px; display:none; flex-direction:column; gap:8px;">
          <strong data-i18n-key="saveCodePrompt"></strong>
          <input type="text" id="notepadSaveCode" readonly style="width:100%; padding:8px; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); border-radius:6px; color:var(--text-color);">
          <button class="btn small ghost" onclick="copyNotepadCode()" data-i18n-key="copyCodeBtn"></button>
        </div>
        <div id="notepadLoadInputArea" style="margin-top:15px; display:none; flex-direction:column; gap:8px;">
          <strong data-i18n-key="loadCodePrompt"></strong>
          <input type="text" id="notepadLoadCodeInput" data-i18n-placeholder="loadCodePlaceholder" style="width:100%; padding:8px; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); border-radius:6px; color:var(--text-color);">
          <button class="btn small accent" id="applyLoadNotepadBtn" data-i18n-key="applyLoadBtn"></button>
        </div>
        <div id="notepadMessage" class="hint" style="margin-top:10px; height:24px;"></div>
      </section>

      <footer>
        <div class="muted" data-i18n-key="madeBy"></div>
      </footer>

    </div>
  </div>

  <script>
    // Language data
    // Language data
    const i18n = {
    'zh-CN': {
        zhLangName: 'ä¸­æ–‡',
        enLangName: 'English',
        frLangName: 'FranÃ§ais', // New
        jaLangName: 'æ—¥æœ¬èª',   // New
        darkThemeIcon: 'ğŸŒ™',
        lightThemeIcon: 'â˜€ï¸',
        title: 'åœ°çƒå¨±ä¹ä¸­å¿ƒ',
        subtitle: 'è½»æ¾å¥½ç©çš„å°å·¥å…·ä¸å°æ¸¸æˆ',
        notLoggedIn: 'æœªç™»å½•',
        returnToHome: 'è¿”å›ä¸»èœå•',
        welcomePrompt: 'æ¬¢è¿ï¼Œå…ˆå‘Šè¯‰æˆ‘ä½ çš„åå­—å§ ğŸ‘‹',
        inputPlaceholder: 'åœ¨è¿™é‡Œè¾“å…¥åå­—ï¼Œç„¶åæŒ‰ Enter æˆ– ç‚¹å‡»è¿›å…¥',
        enterBtn: 'è¿›å…¥',
        demoBtn: 'è¯•ç©ï¼ˆåŒ¿åï¼‰',
        hintEasterEgg: 'æç¤ºï¼šè¾“å…¥ <strong>????</strong> ç³»åˆ—ä¼šè§¦å‘å°å½©è›‹ ğŸ˜',
        badWordWarning: 'âš ï¸ åå­—ä¸­åŒ…å«ç¦æ­¢è¯ï¼',
        easterEggGreeting: 'å±…ç„¶æ˜¯ä½ ï¼Ÿ ğŸ‰',
        welcomeUser: 'æ¬¢è¿ {name} æ¥åˆ°åœ°çƒï¼',
        welcomeAnon: 'æ¬¢è¿ åŒ¿åè®¿å®¢ æ¥åˆ°åœ°çƒï¼',
        chooseGame: 'æŒ‘ä¸ªæ¸¸æˆ / åŠŸèƒ½å¼€å§‹ç©å§',
        stoneGameTitle: 'ğŸª¨ çŸ³å¤´æ¸¸æˆ',
        stoneGameDesc: 'æ‹–åŠ¨çŸ³å¤´ï¼Œæ”¾æ‰‹è®©å®ƒæ‰è½å¹¶å¼¹è·³ â€” ç‰©ç†æ„Ÿåè¶³ã€‚',
        startBtn: 'å¼€å§‹',
        infoBtn: 'è¯´æ˜',
        wordleTitle: 'ğŸ”¤ Wordle çŒœè¯',
        wordleDesc: 'ç»å…¸ 5 å­—æ¯çŒœè¯ï¼ˆ6 æ¬¡æœºä¼šï¼‰â€”â€”å’ŒåŸç‰ˆä¸€æ ·çš„ä¹è¶£ã€‚',
        game2048Title: 'ğŸ”¢ 2048',
        game2048Desc: 'ç»å…¸ 2048 åˆå¹¶æ•°å­—ï¼Œç›®æ ‡ 2048ï¼ˆæˆ–æ›´é«˜ï¼‰ã€‚',
        toolsTitle: 'âœ¨ å°å·¥å…·',
        toolsDesc: 'ä»Šæ—¥è¿åŠ¿ / éšæœºç¬‘è¯ / å†·çŸ¥è¯†',
        openBtn: 'æ‰“å¼€',
        stoneGamePageTitle: 'ğŸª¨ çŸ³å¤´ç‰©ç†ï¼ˆæ‹–æ‹½ & é‡åŠ›ï¼‰',
        resetStone: 'é‡ç½®çŸ³å¤´',
        stoneHint: 'æç¤ºï¼šæ‹–æ‹½çŸ³å¤´å¹¶æ”¾æ‰‹ï¼Œå®ƒä¼šå—åˆ°é‡åŠ›å’Œåœ°é¢æ‘©æ“¦ã€‚',
        wordleGamePageTitle: 'ğŸ”¤ Wordle - çŒœè¯æ¸¸æˆ',
        restartGame: 'é‡å¼€ä¸€å±€',
        wordleMsg5Letters: 'è¯·å¡«å†™5ä¸ªå­—æ¯',
        wordleMsgInvalidWord: 'ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆå•è¯',
        wordleMsgWin: 'ä½ èµ¢äº†ï¼ğŸ‰',
        wordleMsgLose: 'æŒ‘æˆ˜å¤±è´¥ï¼Œç­”æ¡ˆæ˜¯ï¼š',
        game2048PageTitle: 'ğŸ”¢ 2048',
        game2048Restart: 'é‡æ–°å¼€å§‹',
        game2048Info: '2048ï¼šä½¿ç”¨æ–¹å‘é”®åˆå¹¶ç›¸åŒæ•°å­—ï¼Œç›®æ ‡å¾—åˆ° 2048ã€‚',
        gameOverNoMerge: 'æ¸¸æˆç»“æŸï¼æ— æ³•ç»§ç»­åˆå¹¶ã€‚',
        madeBy: 'Made By Jovan Jin',
        fortuneBtn: 'ğŸŒŸ ä»Šæ—¥è¿åŠ¿',
        jokeBtn: 'ğŸ˜‚ éšæœºç¬‘è¯',
        factBtn: 'ğŸ§  åœ°çƒå†·çŸ¥è¯†',
        fortunes: ["ä»Šå¤©è¿æ°”çˆ†æ£šï¼","ä½ ä¼šé‡åˆ°å°æƒŠå–œ","æ³¨æ„åˆ«å–åˆ°å‡‰èŒ¶","æœ‰äººæˆä¸ºä½ ä»Šå¤©çš„è´µäºº","é€‚åˆå‡ºå»èµ°èµ°"],
        jokes: ["ç¨‹åºå‘˜ä¸ºä»€ä¹ˆä¸æ´—æ¾¡ï¼Ÿå› ä¸ºä»–ä»¬åœ¨è°ƒè¯•ï¼ˆdebugï¼‰ğŸ˜‚","æˆ‘æ˜¨å¤©ä¹°äº†ä¸ªåœ°çƒä»ªï¼Œç»“æœæ²¡æ ‡ä½ å®¶","ä¸ºä»€ä¹ˆä¹¦åº—è€æ¿ä¸å¿«ä¹ï¼Ÿå› ä¸ºä»–æ€»æœ‰ä¹¦ï¼ˆè¾“ï¼‰ï¼"],
        facts: ["åœ°çƒçº¦71%è¢«æµ·æ´‹è¦†ç›–","åœ°çƒå¹¶éå®Œç¾çƒä½“ï¼Œè€Œæ˜¯ç•¥æ‰æ¤­çƒ","äººçš„éª¨éª¼å¤§çº¦206å—"],
        stoneInfoText: 'æ‹–åŠ¨çŸ³å¤´å¹¶æ”¾æ‰‹ï¼Œé‡åŠ›ä¼šè®©å®ƒè½åœ°å¹¶å¼¹è·³ã€‚è¯•è¯•å·¦å³æ‹–åŠ¨è®©å®ƒæ»šåŠ¨ã€‚',
        wordleInfoText: 'Wordleï¼šçŒœä¸€ä¸ª 5 å­—æ¯å•è¯ï¼Œ6 æ¬¡æœºä¼šã€‚æ­£ç¡®ä½ç½®ä¸ºç»¿è‰²ï¼Œå­˜åœ¨ä½†ä½ç½®ä¸å¯¹ä¸ºé»„è‰²ã€‚',
        elasticityLabel: 'å¼¹æ€§ç³»æ•°',
        score: 'åˆ†æ•°ï¼š',
        bestScore: 'æœ€é«˜åˆ†ï¼š',
        wordleEnterBtn: 'Enter',
        wordleBackBtn: 'é€€æ ¼',
        bulletHellTitle: 'â¤ï¸ èº²é¿å¼¹å¹•',
        bulletHellDesc: 'æ“æ§ä¸€é¢—å¿ƒï¼Œèº²é¿ä¸æ–­è¢­æ¥çš„å¼¹å¹•ï¼Œçœ‹ä½ èƒ½åšæŒå¤šä¹…ï¼',
        bulletHellPageTitle: 'â¤ï¸ èº²é¿å¼¹å¹•æ¸¸æˆ',
        bulletHellStartButton: 'å¼€å§‹æ¸¸æˆ',
        bulletHellInfoText: 'æ“æ§ä¸€é¢—å¿ƒèº²é¿å¼¹å¹•ã€‚æ¯ç§’åŠ ä¸€åˆ†ã€‚æœ‰åŠ é€Ÿâš¡ã€å›è¡€â¤ï¸ã€å˜å°â¬‡ï¸ã€æ— æ•ŒğŸ›¡ï¸ã€ç¬ç§»â¡ï¸äº”ç§é“å…·ã€‚ç¢°åˆ°å¼¹å¹•ä¼šæ‰£è¡€ï¼Œç”Ÿå‘½ä¸º0åˆ™æ¸¸æˆç»“æŸã€‚',
        lives: 'ç”Ÿå‘½ï¼š',
        gameOverBulletHell: 'æ¸¸æˆç»“æŸï¼',
        powerUpSpeed: 'åŠ é€Ÿ',
        powerUpHeal: 'å›è¡€',
        powerUpShrink: 'å˜å°',
        powerUpInvincible: 'æ— æ•Œ',
        powerUpTeleport: 'ç¬ç§»',
        bulletHellTruckWarning: 'è­¦å‘Šï¼å…‰æŸå……èƒ½ï¼', // ä¿®æ”¹æ­¤å¤„
        bulletHellBossAppear: 'BOSSå‡ºç°ï¼',
        bossDefeated: 'BOSSè¢«å‡»è´¥ï¼',
        bulletHellBeamComing: 'å…‰æŸæ¥è¢­ï¼',
        notepadTitle: 'ğŸ“ è®°äº‹æœ¬',
        notepadDesc: 'ä¿å­˜å’ŒåŠ è½½ä½ çš„æ–‡æœ¬ç¬”è®°',
        notepadPageTitle: 'ğŸ“ è®°äº‹æœ¬',
        saveTextBtn: 'ä¿å­˜æ–‡æœ¬',
        loadTextBtn: 'åŠ è½½æ–‡æœ¬',
        saveCodePrompt: 'è‡ªåŠ¨ä¸ºä½ ç”Ÿæˆäº†ä¿å­˜ç¼–ç ï¼Œä½ å¯ä»¥å¤åˆ¶è¿™ä¸²ç¼–ç ï¼š',
        copyCodeBtn: 'å¤åˆ¶ç¼–ç ',
        loadCodePrompt: 'è¯·ç²˜è´´ä¿å­˜ç¼–ç åˆ°ä¸‹æ–¹ï¼Œç„¶åç‚¹å‡»åº”ç”¨ï¼š',
        loadCodePlaceholder: 'ç²˜è´´ä½ çš„ä¿å­˜ç¼–ç ...',
        applyLoadBtn: 'åº”ç”¨åŠ è½½',
        notepadSaveSuccess: 'æ–‡æœ¬å·²ä¿å­˜ï¼è¯·å¤åˆ¶ç”Ÿæˆçš„ç¼–ç ã€‚',
        notepadLoadSuccess: 'æ–‡æœ¬å·²æˆåŠŸåŠ è½½ï¼',
        notepadLoadError: 'åŠ è½½å¤±è´¥ï¼šæ— æ•ˆçš„ç¼–ç æˆ–æ•°æ®ã€‚',
        notepadEmptySave: 'è®°äº‹æœ¬ä¸ºç©ºï¼Œæ— éœ€ä¿å­˜ã€‚',
        notepadCopySuccess: 'ç¼–ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼',
        notepadCopyFail: 'å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ã€‚',
        learningTitle: 'ğŸ“ å­¦ä¹ ä¸­å¿ƒ',
        learningDesc: 'æ•°å­¦ / è¯­æ–‡ / è‹±è¯­ ç­‰ç­‰...',
        learningPageTitle: 'ğŸ“ å­¦ä¹ ä¸­å¿ƒ',
        mathGameTitle: 'â•â– æ•°å­¦è®¡ç®—',
        mathGameDesc: 'éšæœºç”Ÿæˆè®¡ç®—é¢˜ï¼Œè€ƒéªŒä½ çš„ç®—æœ¯èƒ½åŠ›ï¼',
        mathGamePageTitle: 'â•â– æ•°å­¦è®¡ç®—æŒ‘æˆ˜',
        difficultyEasy: 'ç®€å•',
        difficultyMedium: 'ä¸­ç­‰',
        difficultyHard: 'å›°éš¾',
        difficultyExpert: 'ä¸“å®¶',
        difficultyMaster: 'å¤§å¸ˆ',
        mathAnswerPlaceholder: 'åœ¨æ­¤è¾“å…¥ç­”æ¡ˆ',
        mathSubmitAnswer: 'æäº¤ç­”æ¡ˆ',
        questionCount: 'é¢˜ç›®ï¼š',
        mathCorrect: 'âœ… æ­£ç¡®ï¼',
        mathIncorrect: 'âŒ é”™è¯¯ï¼Œæ­£ç¡®ç­”æ¡ˆæ˜¯ {answer}',
        mathTimeout: 'âŒ› æ—¶é—´åˆ°ï¼Œæ­£ç¡®ç­”æ¡ˆæ˜¯ {answer}',
        mathGameFinish: 'æŒ‘æˆ˜ç»“æŸï¼ä½ çš„æœ€ç»ˆåˆ†æ•°æ˜¯ {score} / 30',
        returnToLearning: 'è¿”å›å­¦ä¹ ä¸­å¿ƒ',
        mathInfoText: 'é€‰æ‹©éš¾åº¦åå¼€å§‹ç­”é¢˜ã€‚æ¯é¢˜æœ‰æ—¶é—´é™åˆ¶ï¼Œè¶Šå¿«ç­”å¯¹å¾—åˆ†è¶Šé«˜ï¼ˆ3/2/1åˆ†ï¼‰ã€‚ç­”é”™æˆ–è¶…æ—¶ä¼šæ‰£1åˆ†ã€‚å…±10é¢˜ã€‚ç­”æ¡ˆç²¾ç¡®åˆ°å°æ•°ç‚¹å2ä½ï¼ˆå¦‚æœ‰ï¼‰ã€‚',
    },
    'en-US': {
        zhLangName: 'ä¸­æ–‡',
        enLangName: 'English',
        frLangName: 'FranÃ§ais',
        jaLangName: 'æ—¥æœ¬èª',
        darkThemeIcon: 'ğŸŒ™',
        lightThemeIcon: 'â˜€ï¸',
        title: 'Earth Entertainment Hub',
        subtitle: 'Fun little tools & games â€” Bro Edition',
        notLoggedIn: 'Not Logged In',
        returnToHome: 'Back to Main Menu',
        welcomePrompt: 'Welcome, tell me your name first ğŸ‘‹',
        inputPlaceholder: 'Enter your name here, then press Enter or Click to proceed',
        enterBtn: 'Enter',
        demoBtn: 'Play as Guest (Anonymous)',
        hintEasterEgg: 'Hint: Entering <strong>????</strong> series will trigger a small easter egg ğŸ˜',
        badWordWarning: 'âš ï¸ Name contains forbidden words!',
        easterEggGreeting: 'It\'s you? ğŸ‰',
        welcomeUser: 'Welcome {name} to Earth!',
        welcomeAnon: 'Welcome Anonymous Guest to Earth!',
        chooseGame: 'Pick a game / feature to play',
        stoneGameTitle: 'ğŸª¨ Stone Game',
        stoneGameDesc: 'Drag stones, release them to drop and bounce â€” very physical.',
        startBtn: 'Start',
        infoBtn: 'Info',
        wordleTitle: 'ğŸ”¤ Wordle Guess',
        wordleDesc: 'Classic 5-letter word guess (6 tries) â€” same fun as the original.',
        game2048Title: 'ğŸ”¢ 2048',
        game2048Desc: 'Classic 2048 merge numbers, aim for 2048 (or higher).',
        toolsTitle: 'âœ¨ Mini Tools',
        toolsDesc: 'Daily fortune / Random joke / Trivia',
        openBtn: 'Open',
        stoneGamePageTitle: 'ğŸª¨ Stone Physics (Drag & Gravity)',
        resetStone: 'Reset Stone',
        stoneHint: 'Hint: Drag the stone and release. It will be affected by gravity and ground friction.',
        wordleGamePageTitle: 'ğŸ”¤ Wordle - Word Guess Game',
        restartGame: 'New Game',
        wordleMsg5Letters: 'Please fill 5 letters',
        wordleMsgInvalidWord: 'Not a valid word',
        wordleMsgWin: 'You win! ğŸ‰',
        wordleMsgLose: 'Challenge failed, answer was: ',
        game2048PageTitle: 'ğŸ”¢ 2048',
        game2048Restart: 'Restart',
        game2048Info: '2048: Use arrow keys to merge identical numbers, aim for 2048.',
        gameOverNoMerge: 'Game Over! No more merges possible.',
        madeBy: 'Made with Jovan Jin',
        fortuneBtn: 'ğŸŒŸ Daily Fortune',
        jokeBtn: 'ğŸ˜‚ Random Joke',
        factBtn: 'ğŸ§  Earth Trivia',
        fortunes: ["You're super lucky today!","You will encounter a small surprise","Be careful not to drink cold tea","Someone will be your benefactor today","Good for a walk outside"],
        jokes: ["Why do programmers not shower? Because they are debugging ğŸ˜‚","I bought a globe yesterday, but it didn't mark your house","Why isn't a bookstore owner happy? Because he always has books (loses)! (Pun: ä¹¦ = book, è¾“ = lose)"],
        facts: ["Earth is about 71% covered by oceans","Earth is not a perfect sphere, but an oblate spheroid","Human skeleton has about 206 bones"],
        stoneInfoText: 'Drag the stone and release, gravity will make it fall and bounce. Try dragging left and right to make it roll.',
        wordleInfoText: 'Wordle: Guess a 5-letter word in 6 tries. Green means correct letter in correct spot, yellow means correct letter in wrong spot.',
        elasticityLabel: 'Elasticity',
        score: 'Score: ',
        bestScore: 'Best: ',
        wordleEnterBtn: 'Enter',
        wordleBackBtn: 'Back',
        bulletHellTitle: 'â¤ï¸ Bullet Hell',
        bulletHellDesc: 'Control a heart, dodge endless bullets, see how long you can last!',
        bulletHellPageTitle: 'â¤ï¸ Bullet Hell Game',
        bulletHellStartButton: 'Start Game',
        bulletHellInfoText: 'Control a heart to dodge bullets. Score increases every second. Five power-ups: Speedâš¡, Healâ¤ï¸, Shrinkâ¬‡ï¸, InvincibilityğŸ›¡ï¸, Teleportâ¡ï¸. Lose a life on hit, game over at 0 lives.',
        lives: 'Lives: ',
        gameOverBulletHell: 'Game Over!',
        powerUpSpeed: 'Speed Up',
        powerUpHeal: 'Heal',
        powerUpShrink: 'Shrink',
        powerUpInvincible: 'Invincible',
        powerUpTeleport: 'Teleport',
        bulletHellTruckWarning: 'WARNING! Beam charging!', // ä¿®æ”¹æ­¤å¤„
        bulletHellBossAppear: 'BOSS APPEARS!',
        bossDefeated: 'BOSS DEFEATED!',
        bulletHellBeamComing: 'BEAM INCOMING!',
        notepadTitle: 'ğŸ“ Notepad',
        notepadDesc: 'Save and load your text notes',
        notepadPageTitle: 'ğŸ“ Notepad',
        saveTextBtn: 'Save Text',
        loadTextBtn: 'Load Text',
        saveCodePrompt: 'Your save code has been generated, please copy it:',
        copyCodeBtn: 'Copy Code',
        loadCodePrompt: 'Please paste your save code below, then click Apply:',
        loadCodePlaceholder: 'Paste your save code...',
        applyLoadBtn: 'Apply Load',
        notepadSaveSuccess: 'Text saved! Please copy the generated code.',
        notepadLoadSuccess: 'Text successfully loaded!',
        notepadLoadError: 'Load failed: Invalid code or data.',
        notepadEmptySave: 'Notepad is empty, nothing to save.',
        notepadCopySuccess: 'Code copied to clipboard!',
        notepadCopyFail: 'Failed to copy, please copy manually.',
        learningTitle: 'ğŸ“ Learning Hub',
        learningDesc: 'Math / Language / English etc...',
        learningPageTitle: 'ğŸ“ Learning Hub',
        mathGameTitle: 'â•â– Math Challenge',
        mathGameDesc: 'Random calculation problems to test your arithmetic skills!',
        mathGamePageTitle: 'â•â– Math Calculation Challenge',
        difficultyEasy: 'Easy',
        difficultyMedium: 'Medium',
        difficultyHard: 'Hard',
        difficultyExpert: 'Expert',
        difficultyMaster: 'Master',
        mathAnswerPlaceholder: 'Enter your answer here',
        mathSubmitAnswer: 'Submit Answer',
        questionCount: 'Question: ',
        mathCorrect: 'âœ… Correct!',
        mathIncorrect: 'âŒ Incorrect, the correct answer was {answer}',
        mathTimeout: 'âŒ› Time out, the correct answer was {answer}',
        mathGameFinish: 'Challenge finished! Your final score is {score} / 30',
        returnToLearning: 'Back to Learning Hub',
        mathInfoText: 'Select a difficulty to start. Each question has a time limit, answer faster for higher scores (3/2/1 points). Incorrect answers or timeouts deduct 1 point. 10 questions total. Answers precise to 2 decimal places (if applicable).',
    },
    'fr-FR': { // New language: French
        zhLangName: 'Chinois',
        enLangName: 'Anglais',
        frLangName: 'FranÃ§ais',
        jaLangName: 'Japonais',
        darkThemeIcon: 'ğŸŒ™',
        lightThemeIcon: 'â˜€ï¸',
        title: 'Centre de divertissement terrestre',
        subtitle: 'Petits outils et jeux amusants',
        notLoggedIn: 'Non connectÃ©',
        returnToHome: 'Retour au menu principal',
        welcomePrompt: 'Bienvenue, dis-moi ton nom d\'abord ğŸ‘‹',
        inputPlaceholder: 'Entrez votre nom ici, puis appuyez sur EntrÃ©e ou cliquez pour continuer',
        enterBtn: 'Entrer',
        demoBtn: 'Jouer en tant qu\'invitÃ© (Anonyme)',
        hintEasterEgg: 'Astuce : Saisir la sÃ©rie <strong>????</strong> dÃ©clenchera un petit Å“uf de PÃ¢ques ğŸ˜',
        badWordWarning: 'âš ï¸ Le nom contient des mots interdits !',
        easterEggGreeting: 'C\'est toi ? ğŸ‰',
        welcomeUser: 'Bienvenue {name} sur Terre !',
        welcomeAnon: 'Bienvenue invitÃ© anonyme sur Terre !',
        chooseGame: 'Choisissez un jeu / une fonction Ã  jouer',
        stoneGameTitle: 'ğŸª¨ Jeu de la pierre',
        stoneGameDesc: 'Faites glisser les pierres, relÃ¢chez-les pour les faire tomber et rebondir â€” trÃ¨s physique.',
        startBtn: 'Commencer',
        infoBtn: 'Infos',
        wordleTitle: 'ğŸ”¤ Wordle - Deviner le mot',
        wordleDesc: 'Devinez un mot de 5 lettres (6 essais) â€” le mÃªme plaisir que l\'original.',
        game2048Title: 'ğŸ”¢ 2048',
        game2048Desc: 'Jeu classique de fusion de nombres 2048, visez 2048 (ou plus).',
        toolsTitle: 'âœ¨ Mini-outils',
        toolsDesc: 'Fortune du jour / Blague alÃ©atoire / Anecdotes',
        openBtn: 'Ouvrir',
        stoneGamePageTitle: 'ğŸª¨ Physique de la pierre (Glisser & GravitÃ©)',
        resetStone: 'RÃ©initialiser la pierre',
        stoneHint: 'Astuce : Faites glisser la pierre et relÃ¢chez. Elle sera affectÃ©e par la gravitÃ© et la friction au sol.',
        wordleGamePageTitle: 'ğŸ”¤ Wordle - Jeu de mots',
        restartGame: 'Nouvelle partie',
        wordleMsg5Letters: 'Veuillez remplir 5 lettres',
        wordleMsgInvalidWord: 'Pas un mot valide',
        wordleMsgWin: 'Vous avez gagnÃ© ! ğŸ‰',
        wordleMsgLose: 'DÃ©fi Ã©chouÃ©, la rÃ©ponse Ã©tait : ',
        game2048PageTitle: 'ğŸ”¢ 2048',
        game2048Restart: 'Recommencer',
        game2048Info: '2048 : Utilisez les flÃ¨ches pour fusionner des nombres identiques, visez 2048.',
        gameOverNoMerge: 'Partie terminÃ©e ! Aucune fusion possible.',
        madeBy: 'Fait avec â¤ï¸ Jovan Jin',
        fortuneBtn: 'ğŸŒŸ Fortune du jour',
        jokeBtn: 'ğŸ˜‚ Blague alÃ©atoire',
        factBtn: 'ğŸ§  Anecdotes sur la Terre',
        fortunes: ["Vous avez une chance incroyable aujourd'hui !","Vous rencontrerez une petite surprise","Attention Ã  ne pas boire de thÃ© froid","Quelqu\'un sera votre bienfaiteur aujourd\'hui","Bon pour une promenade Ã  l\'extÃ©rieur"],
        jokes: ["Pourquoi les programmeurs ne se douchent-ils pas ? Parce qu'ils sont en mode dÃ©bogage (debugging) ğŸ˜‚","J'ai achetÃ© un globe hier, mais il ne marquait pas ta maison","Pourquoi le propriÃ©taire d'une librairie n'est-il pas heureux ? Parce qu'il a toujours des livres (perd) ! (Jeu de mots : livre = book, perdre = lose)"],
        facts: ["La Terre est couverte Ã  environ 71% par les ocÃ©ans","La Terre n'est pas une sphÃ¨re parfaite, mais un sphÃ©roÃ¯de oblate","Le squelette humain compte environ 206 os"],
        stoneInfoText: 'Faites glisser la pierre et relÃ¢chez, la gravitÃ© la fera tomber et rebondir. Essayez de la faire glisser Ã  gauche et Ã  droite pour la faire rouler.',
        wordleInfoText: 'Wordle : Devinez un mot de 5 lettres en 6 essais. Le vert signifie la bonne lettre au bon endroit, le jaune signifie la bonne lettre au mauvais endroit.',
        elasticityLabel: 'Ã‰lasticitÃ©',
        score: 'Score : ',
        bestScore: 'Meilleur : ',
        wordleEnterBtn: 'EntrÃ©e',
        wordleBackBtn: 'Retour',
        bulletHellTitle: 'â¤ï¸ Bullet Hell',
        bulletHellDesc: 'ContrÃ´lez un cÅ“ur, esquivez des balles infinies, voyez combien de temps vous pouvez tenir !',
        bulletHellPageTitle: 'â¤ï¸ Jeu Bullet Hell',
        bulletHellStartButton: 'DÃ©marrer le jeu',
        bulletHellInfoText: 'ContrÃ´lez un cÅ“ur pour esquiver les balles. Le score augmente chaque seconde. Cinq bonus : Vitesseâš¡, Soinâ¤ï¸, RÃ©trÃ©cirâ¬‡ï¸, InvincibilitÃ©ğŸ›¡ï¸, TÃ©lÃ©portationâ¡ï¸. Perdez une vie au toucher, partie terminÃ©e Ã  0 vies.',
        lives: 'Vies : ',
        gameOverBulletHell: 'Partie terminÃ©e !',
        powerUpSpeed: 'AccÃ©lÃ©rer',
        powerUpHeal: 'Soigner',
        powerUpShrink: 'RÃ©trÃ©cir',
        powerUpInvincible: 'Invincible',
        powerUpTeleport: 'TÃ©lÃ©porter',
        bulletHellTruckWarning: 'ATTENTION ! Rayon en chargement !', // ä¿®æ”¹æ­¤å¤„
        bulletHellBossAppear: 'BOSS APPARAÃT !',
        bossDefeated: 'BOSS DÃ‰FAIT !',
        bulletHellBeamComing: 'RAYON EN APPROCHE !',
        notepadTitle: 'ğŸ“ Bloc-notes',
        notepadDesc: 'Enregistrer et charger vos notes textuelles',
        notepadPageTitle: 'ğŸ“ Bloc-notes',
        saveTextBtn: 'Enregistrer le texte',
        loadTextBtn: 'Charger le texte',
        saveCodePrompt: 'Votre code de sauvegarde a Ã©tÃ© gÃ©nÃ©rÃ©, veuillez le copier :',
        copyCodeBtn: 'Copier le code',
        loadCodePrompt: 'Veuillez coller votre code de sauvegarde ci-dessous, puis cliquez sur Appliquer :',
        loadCodePlaceholder: 'Collez votre code de sauvegarde...',
        applyLoadBtn: 'Appliquer le chargement',
        notepadSaveSuccess: 'Texte enregistrÃ© ! Veuillez copier le code gÃ©nÃ©rÃ©.',
        notepadLoadSuccess: 'Texte chargÃ© avec succÃ¨s !',
        notepadLoadError: 'Ã‰chec du chargement : Code ou donnÃ©es invalides.',
        notepadEmptySave: 'Le bloc-notes est vide, rien Ã  enregistrer.',
        notepadCopySuccess: 'Code copiÃ© dans le presse-papiers !',
        notepadCopyFail: 'Ã‰chec de la copie, veuillez copier manuellement.',
        learningTitle: 'ğŸ“ Centre d\'apprentissage',
        learningDesc: 'Maths / Langues / Anglais etc...',
        learningPageTitle: 'ğŸ“ Centre d\'apprentissage',
        mathGameTitle: 'â•â– DÃ©fi mathÃ©matique',
        mathGameDesc: 'ProblÃ¨mes de calcul alÃ©atoires pour tester vos compÃ©tences en arithmÃ©tique !',
        mathGamePageTitle: 'â•â– DÃ©fi de calcul mathÃ©matique',
        difficultyEasy: 'Facile',
        difficultyMedium: 'Moyen',
        difficultyHard: 'Difficile',
        difficultyExpert: 'Expert',
        difficultyMaster: 'MaÃ®tre',
        mathAnswerPlaceholder: 'Entrez votre rÃ©ponse ici',
        mathSubmitAnswer: 'Soumettre la rÃ©ponse',
        questionCount: 'Question : ',
        mathCorrect: 'âœ… Correct !',
        mathIncorrect: 'âŒ Incorrect, la bonne rÃ©ponse Ã©tait {answer}',
        mathTimeout: 'âŒ› Temps Ã©coulÃ©, la bonne rÃ©ponse Ã©tait {answer}',
        mathGameFinish: 'DÃ©fi terminÃ© ! Votre score final est de {score} / 30',
        returnToLearning: 'Retour au Centre d\'apprentissage',
        mathInfoText: 'SÃ©lectionnez une difficultÃ© pour commencer. Chaque question a une limite de temps, rÃ©pondez plus vite pour des scores plus Ã©levÃ©s (3/2/1 points). Les rÃ©ponses incorrectes ou les dÃ©lais d\'attente dÃ©duisent 1 point. 10 questions au total. RÃ©ponses prÃ©cises Ã  2 dÃ©cimales (le cas Ã©chÃ©ant).',
    },
    'ja-JP': { // New language: Japanese
        zhLangName: 'ä¸­å›½èª',
        enLangName: 'è‹±èª',
        frLangName: 'ãƒ•ãƒ©ãƒ³ã‚¹èª',
        jaLangName: 'æ—¥æœ¬èª',
        darkThemeIcon: 'ğŸŒ™',
        lightThemeIcon: 'â˜€ï¸',
        title: 'åœ°çƒã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒ¡ãƒ³ãƒˆãƒãƒ–',
        subtitle: 'æ¥½ã—ã„ãƒŸãƒ‹ãƒ„ãƒ¼ãƒ«ã¨ã‚²ãƒ¼ãƒ ',
        notLoggedIn: 'æœªãƒ­ã‚°ã‚¤ãƒ³',
        returnToHome: 'ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹',
        welcomePrompt: 'ã‚ˆã†ã“ãã€ã¾ãšãŠåå‰ã‚’æ•™ãˆã¦ãã ã•ã„ ğŸ‘‹',
        inputPlaceholder: 'ã“ã“ã«ãŠåå‰ã‚’å…¥åŠ›ã—ã€Enterã‚­ãƒ¼ã‚’æŠ¼ã™ã‹ã‚¯ãƒªãƒƒã‚¯ã—ã¦é€²ã‚“ã§ãã ã•ã„',
        enterBtn: 'å…¥åŠ›',
        demoBtn: 'ã‚²ã‚¹ãƒˆã¨ã—ã¦ãƒ—ãƒ¬ã‚¤ï¼ˆåŒ¿åï¼‰',
        hintEasterEgg: 'ãƒ’ãƒ³ãƒˆï¼š<strong>????</strong>ã‚·ãƒªãƒ¼ã‚ºã‚’å…¥åŠ›ã™ã‚‹ã¨ã€ã¡ã‚‡ã£ã¨ã—ãŸã‚¤ãƒ¼ã‚¹ã‚¿ãƒ¼ã‚¨ãƒƒã‚°ãŒç™ºç”Ÿã—ã¾ã™ ğŸ˜',
        badWordWarning: 'âš ï¸ åå‰ã«ç¦æ­¢èªå¥ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ï¼',
        easterEggGreeting: 'ã¾ã•ã‹ã‚ãªãŸã§ã™ã‹ï¼Ÿ ğŸ‰',
        welcomeUser: '{name}ã•ã‚“ã€åœ°çƒã¸ã‚ˆã†ã“ãï¼',
        welcomeAnon: 'åŒ¿åã‚²ã‚¹ãƒˆã•ã‚“ã€åœ°çƒã¸ã‚ˆã†ã“ãï¼',
        chooseGame: 'ã‚²ãƒ¼ãƒ ã‚„æ©Ÿèƒ½ã‚’é¸ã‚“ã§ãã ã•ã„',
        stoneGameTitle: 'ğŸª¨ çŸ³ã‚²ãƒ¼ãƒ ',
        stoneGameDesc: 'çŸ³ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦æ”¾ã—ã€è½ä¸‹ã•ã›ã¦è·³ã­ã•ã›ã¾ã™ â€” ç‰©ç†çš„ãªæ„Ÿè¦šãŒæº€è¼‰ã§ã™ã€‚',
        startBtn: 'é–‹å§‹',
        infoBtn: 'æƒ…å ±',
        wordleTitle: 'ğŸ”¤ Wordle - å˜èªæ¨æ¸¬',
        wordleDesc: 'ã‚¯ãƒ©ã‚·ãƒƒã‚¯ãª5æ–‡å­—ã®å˜èªæ¨æ¸¬ï¼ˆ6å›æŒ‘æˆ¦ï¼‰â€” ã‚ªãƒªã‚¸ãƒŠãƒ«ã¨åŒã˜ãã‚‰ã„æ¥½ã—ã„ã§ã™ã€‚',
        game2048Title: 'ğŸ”¢ 2048',
        game2048Desc: 'ã‚¯ãƒ©ã‚·ãƒƒã‚¯ãª2048æ•°å­—ãƒãƒ¼ã‚¸ã‚²ãƒ¼ãƒ ã€2048ï¼ˆã¾ãŸã¯ãã‚Œä»¥ä¸Šï¼‰ã‚’ç›®æŒ‡ã—ã¾ã™ã€‚',
        toolsTitle: 'âœ¨ ãƒŸãƒ‹ãƒ„ãƒ¼ãƒ«',
        toolsDesc: 'ä»Šæ—¥ã®é‹å‹¢ / ãƒ©ãƒ³ãƒ€ãƒ ã‚¸ãƒ§ãƒ¼ã‚¯ / é›‘å­¦',
        openBtn: 'é–‹ã',
        stoneGamePageTitle: 'ğŸª¨ çŸ³ã®ç‰©ç†ï¼ˆãƒ‰ãƒ©ãƒƒã‚°ï¼†é‡åŠ›ï¼‰',
        resetStone: 'çŸ³ã‚’ãƒªã‚»ãƒƒãƒˆ',
        stoneHint: 'ãƒ’ãƒ³ãƒˆï¼šçŸ³ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦æ”¾ã™ã¨ã€é‡åŠ›ã¨åœ°é¢ã®æ‘©æ“¦ã®å½±éŸ¿ã‚’å—ã‘ã¾ã™ã€‚',
        wordleGamePageTitle: 'ğŸ”¤ Wordle - å˜èªæ¨æ¸¬ã‚²ãƒ¼ãƒ ',
        restartGame: 'æ–°ã—ã„ã‚²ãƒ¼ãƒ ',
        wordleMsg5Letters: '5æ–‡å­—å…¥åŠ›ã—ã¦ãã ã•ã„',
        wordleMsgInvalidWord: 'æœ‰åŠ¹ãªå˜èªã§ã¯ã‚ã‚Šã¾ã›ã‚“',
        wordleMsgWin: 'ã‚ãªãŸã®å‹ã¡ã§ã™ï¼ğŸ‰',
        wordleMsgLose: 'æ®‹å¿µã€æ­£è§£ã¯ï¼š',
        game2048PageTitle: 'ğŸ”¢ 2048',
        game2048Restart: 'ã‚„ã‚Šç›´ã™',
        game2048Info: '2048ï¼šçŸ¢å°ã‚­ãƒ¼ã‚’ä½¿ã£ã¦åŒã˜æ•°å­—ã‚’ãƒãƒ¼ã‚¸ã—ã€2048ã‚’ç›®æŒ‡ã—ã¾ã™ã€‚',
        gameOverNoMerge: 'ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ï¼ã“ã‚Œä»¥ä¸Šãƒãƒ¼ã‚¸ã§ãã¾ã›ã‚“ã€‚',
        madeBy: 'â¤ï¸ã‚’è¾¼ã‚ã¦ä½œã‚‰ã‚Œã¾ã—ãŸ By Jovan Jin',
        fortuneBtn: 'ğŸŒŸ ä»Šæ—¥ã®é‹å‹¢',
        jokeBtn: 'ğŸ˜‚ ãƒ©ãƒ³ãƒ€ãƒ ã‚¸ãƒ§ãƒ¼ã‚¯',
        factBtn: 'ğŸ§  åœ°çƒã®é›‘å­¦',
        fortunes: ["ä»Šæ—¥ã¯è¶…ãƒ©ãƒƒã‚­ãƒ¼ï¼","å°ã•ãªã‚µãƒ—ãƒ©ã‚¤ã‚ºã«å‡ºä¼šã†ã§ã—ã‚‡ã†","å†·ãŸã„ãŠèŒ¶ã‚’é£²ã¾ãªã„ã‚ˆã†ã«æ³¨æ„","èª°ã‹ãŒä»Šæ—¥ã®ã‚ãªãŸã®æ©äººã«ãªã‚‹ã§ã—ã‚‡ã†","å¤–ã‚’æ•£æ­©ã™ã‚‹ã®ã«è‰¯ã„æ—¥ã§ã™"],
        jokes: ["ãªãœãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼ã¯ã‚·ãƒ£ãƒ¯ãƒ¼ã‚’æµ´ã³ãªã„ã®ã§ã™ã‹ï¼Ÿãƒ‡ãƒãƒƒã‚°ï¼ˆdebuggingï¼‰ã—ã¦ã„ã‚‹ã‹ã‚‰ã§ã™ğŸ˜‚","æ˜¨æ—¥åœ°çƒå„€ã‚’è²·ã£ãŸã‚“ã ã‘ã©ã€å›ã®å®¶ãŒè¼‰ã£ã¦ãªã‹ã£ãŸã‚“ã ","ãªãœæ›¸åº—ä¸»ã¯å¹¸ã›ã§ã¯ãªã„ã®ã§ã™ã‹ï¼Ÿã„ã¤ã‚‚æœ¬ï¼ˆè² ã‘ï¼‰ãŒã‚ã‚‹ã‹ã‚‰ã§ã™ï¼ï¼ˆãƒ€ã‚¸ãƒ£ãƒ¬ï¼šæœ¬ï¼book, è² ã‘ï¼loseï¼‰"],
        facts: ["åœ°çƒã®ç´„71%ã¯æµ·ã§è¦†ã‚ã‚Œã¦ã„ã¾ã™","åœ°çƒã¯å®Œå…¨ãªçƒä½“ã§ã¯ãªãã€ã‚ãšã‹ã«æ‰å¹³ãªæ¥•å††ä½“ã§ã™","äººé–“ã®éª¨ã¯ç´„206å€‹ã‚ã‚Šã¾ã™"],
        stoneInfoText: 'çŸ³ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦æ”¾ã™ã¨ã€é‡åŠ›ã«ã‚ˆã£ã¦è½ä¸‹ã—è·³ã­ã¾ã™ã€‚å·¦å³ã«ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦è»¢ãŒã—ã¦ã¿ã¦ãã ã•ã„ã€‚',
        wordleInfoText: 'Wordleï¼š5æ–‡å­—ã®å˜èªã‚’6å›æŒ‘æˆ¦ã§æ¨æ¸¬ã—ã¾ã™ã€‚ç·‘ã¯æ­£ã—ã„ä½ç½®ã®æ­£ã—ã„æ–‡å­—ã€é»„è‰²ã¯é–“é•ã£ãŸä½ç½®ã®æ­£ã—ã„æ–‡å­—ã‚’æ„å‘³ã—ã¾ã™ã€‚',
        elasticityLabel: 'å¼¾æ€§ä¿‚æ•°',
        score: 'ã‚¹ã‚³ã‚¢ï¼š',
        bestScore: 'ãƒ™ã‚¹ãƒˆï¼š',
        wordleEnterBtn: 'æ±ºå®š',
        wordleBackBtn: 'æˆ»ã‚‹',
        bulletHellTitle: 'â¤ï¸ å¼¾å¹•é¿ã‘ã‚²ãƒ¼ãƒ ',
        bulletHellDesc: 'ãƒãƒ¼ãƒˆã‚’æ“ä½œã—ã¦ã€æ¬¡ã€…ã¨è¿«ã‚‹å¼¾å¹•ã‚’é¿ã‘ã¾ã—ã‚‡ã†ï¼ã©ã‚Œã ã‘é•·ãç”Ÿãæ®‹ã‚Œã‚‹ã‹ï¼Ÿ',
        bulletHellPageTitle: 'â¤ï¸ å¼¾å¹•é¿ã‘ã‚²ãƒ¼ãƒ ',
        bulletHellStartButton: 'ã‚²ãƒ¼ãƒ é–‹å§‹',
        bulletHellInfoText: 'ãƒãƒ¼ãƒˆã‚’æ“ä½œã—ã¦å¼¾å¹•ã‚’é¿ã‘ã¾ã™ã€‚1ç§’ã”ã¨ã«ã‚¹ã‚³ã‚¢ãŒå¢—åŠ ã€‚ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—âš¡ã€å›å¾©â¤ï¸ã€ç¸®å°â¬‡ï¸ã€ç„¡æ•µğŸ›¡ï¸ã€ãƒ†ãƒ¬ãƒãƒ¼ãƒˆâ¡ï¸ã®5ç¨®é¡ã®ãƒ‘ãƒ¯ãƒ¼ã‚¢ãƒƒãƒ—ãŒã‚ã‚Šã¾ã™ã€‚å¼¾å¹•ã«å½“ãŸã‚‹ã¨ãƒ©ã‚¤ãƒ•ãŒæ¸›ã‚Šã€0ã«ãªã‚‹ã¨ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã§ã™ã€‚',
        lives: 'ãƒ©ã‚¤ãƒ•ï¼š',
        gameOverBulletHell: 'ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ï¼',
        powerUpSpeed: 'ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—',
        powerUpHeal: 'å›å¾©',
        powerUpShrink: 'ç¸®å°',
        powerUpInvincible: 'ç„¡æ•µ',
        powerUpTeleport: 'ãƒ†ãƒ¬ãƒãƒ¼ãƒˆ',
        bulletHellTruckWarning: 'è­¦å‘Šï¼ãƒ“ãƒ¼ãƒ ãƒãƒ£ãƒ¼ã‚¸ä¸­ï¼', // ä¿®æ”¹æ­¤å¤„
        bulletHellBossAppear: 'ãƒœã‚¹å‡ºç¾ï¼',
        bossDefeated: 'ãƒœã‚¹ã‚’å€’ã—ãŸï¼',
        bulletHellBeamComing: 'ãƒ“ãƒ¼ãƒ æ¥è¥²ï¼',
        notepadTitle: 'ğŸ“ ãƒ¡ãƒ¢å¸³',
        notepadDesc: 'ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ¢ã‚’ä¿å­˜ã—ã¦èª­ã¿è¾¼ã‚€',
        notepadPageTitle: 'ğŸ“ ãƒ¡ãƒ¢å¸³',
        saveTextBtn: 'ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¿å­˜',
        loadTextBtn: 'ãƒ†ã‚­ã‚¹ãƒˆã‚’èª­ã¿è¾¼ã‚€',
        saveCodePrompt: 'ä¿å­˜ã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ï¼š',
        copyCodeBtn: 'ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼',
        loadCodePrompt: 'ä¿å­˜ã‚³ãƒ¼ãƒ‰ã‚’ä»¥ä¸‹ã«è²¼ã‚Šä»˜ã‘ã¦ã€ã€Œé©ç”¨ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼š',
        loadCodePlaceholder: 'ä¿å­˜ã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„...',
        applyLoadBtn: 'èª­ã¿è¾¼ã¿ã‚’é©ç”¨',
        notepadSaveSuccess: 'ãƒ†ã‚­ã‚¹ãƒˆãŒä¿å­˜ã•ã‚Œã¾ã—ãŸï¼ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚',
        notepadLoadSuccess: 'ãƒ†ã‚­ã‚¹ãƒˆãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸï¼',
        notepadLoadError: 'èª­ã¿è¾¼ã¿å¤±æ•—ï¼šç„¡åŠ¹ãªã‚³ãƒ¼ãƒ‰ã¾ãŸã¯ãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚',
        notepadEmptySave: 'ãƒ¡ãƒ¢å¸³ã¯ç©ºã§ã™ã€‚ä¿å­˜ã™ã‚‹ã‚‚ã®ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚',
        notepadCopySuccess: 'ã‚³ãƒ¼ãƒ‰ãŒã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã•ã‚Œã¾ã—ãŸï¼',
        notepadCopyFail: 'ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ‰‹å‹•ã§ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚',
        learningTitle: 'ğŸ“ å­¦ç¿’ãƒãƒ–',
        learningDesc: 'æ•°å­¦ / å›½èª / è‹±èª ãªã©...',
        learningPageTitle: 'ğŸ“ å­¦ç¿’ãƒãƒ–',
        mathGameTitle: 'â•â– è¨ˆç®—ãƒãƒ£ãƒ¬ãƒ³ã‚¸',
        mathGameDesc: 'ãƒ©ãƒ³ãƒ€ãƒ ãªè¨ˆç®—å•é¡Œã§ç®—æ•°ã‚¹ã‚­ãƒ«ã‚’ãƒ†ã‚¹ãƒˆï¼',
        mathGamePageTitle: 'â•â– è¨ˆç®—ãƒãƒ£ãƒ¬ãƒ³ã‚¸',
        difficultyEasy: 'ç°¡å˜',
        difficultyMedium: 'ä¸­ç¨‹åº¦',
        difficultyHard: 'é›£ã—ã„',
        difficultyExpert: 'ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆ',
        difficultyMaster: 'ãƒã‚¹ã‚¿ãƒ¼',
        mathAnswerPlaceholder: 'ã“ã“ã«ç­”ãˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„',
        mathSubmitAnswer: 'ç­”ãˆã‚’æå‡º',
        questionCount: 'å•é¡Œï¼š',
        mathCorrect: 'âœ… æ­£è§£ï¼',
        mathIncorrect: 'âŒ ä¸æ­£è§£ã€æ­£è§£ã¯ {answer} ã§ã—ãŸ',
        mathTimeout: 'âŒ› ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã€æ­£è§£ã¯ {answer} ã§ã—ãŸ',
        mathGameFinish: 'ãƒãƒ£ãƒ¬ãƒ³ã‚¸çµ‚äº†ï¼æœ€çµ‚ã‚¹ã‚³ã‚¢ã¯ {score} / 30 ã§ã™',
        returnToLearning: 'å­¦ç¿’ãƒãƒ–ã«æˆ»ã‚‹',
        mathInfoText: 'é›£æ˜“åº¦ã‚’é¸æŠã—ã¦é–‹å§‹ã—ã¾ã™ã€‚å„å•é¡Œã«ã¯æ™‚é–“åˆ¶é™ãŒã‚ã‚Šã€é€Ÿãæ­£è§£ã™ã‚‹ã»ã©é«˜å¾—ç‚¹ãŒå¾—ã‚‰ã‚Œã¾ã™ï¼ˆ3/2/1ç‚¹ï¼‰ã€‚ä¸æ­£è§£ã¾ãŸã¯ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã¯1ç‚¹æ¸›ç‚¹ã•ã‚Œã¾ã™ã€‚å…¨10å•ã§ã™ã€‚ç­”ãˆã¯å°æ•°ç‚¹ä»¥ä¸‹2æ¡ã¾ã§ï¼ˆè©²å½“ã™ã‚‹å ´åˆï¼‰ã€‚',
    }
    };

    let currentLang = 'zh-CN'; // Default language

    function setLanguage(lang) {
      currentLang = lang;
      document.documentElement.lang = lang; // Update HTML lang attribute
      applyTranslations();
    }

    function getTranslation(key, params = {}) {
      let text = i18n[currentLang][key] || i18n['zh-CN'][key] || key; // Fallback to Chinese, then key itself
      for (const p in params) {
        text = text.replace(`{${p}}`, params[p]);
      }
      return text;
    }

    function applyTranslations() {
      // Update HTML lang attribute
      document.documentElement.lang = currentLang;

      // Theme Toggle Icon
      if (themeToggle) {
        themeToggle.textContent = document.body.classList.contains('dark-theme') ? getTranslation('lightThemeIcon') : getTranslation('darkThemeIcon');
      }

      // --- Generic element translation using data attributes ---
      document.querySelectorAll('[data-i18n-key]').forEach(el => {
        const key = el.dataset.i18nKey;
        el.textContent = getTranslation(key);
      });

      document.querySelectorAll('[data-i18n-html]').forEach(el => {
        const key = el.dataset.i18nHtml;
        el.innerHTML = getTranslation(key);
      });

      document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
        const key = el.dataset.i18nPlaceholder;
        el.placeholder = getTranslation(key);
      });

      document.querySelectorAll('[data-i18n-value]').forEach(el => {
        const key = el.dataset.i18nValue;
        el.value = getTranslation(key);
      });

      // --- Special cases and dynamically updated elements ---

      // Language Selector Options - ensure selector shows current language
      document.getElementById('languageSelector').value = currentLang;

      // User Badge initial state (dynamic parts handled in `enterEarth`)
      userBadge.textContent = getTranslation('notLoggedIn');

      // Update 2048 scores if visible
      if (document.getElementById('score2048')) {
        document.getElementById('score2048').textContent = getTranslation('score') + score2048;
        document.getElementById('bestScore2048').textContent = getTranslation('bestScore') + bestScore2048;
      }

      // Update Bullet Hell UI if visible
      if (document.getElementById('bulletHellScore') && bulletHellGame.running) {
        // We call the update function directly, it will use the current language
        updateBulletHellUI();
      } else if (document.getElementById('bulletHellScore')) { // If not running, just update text content for scores (e.g., after language change on page)
        document.getElementById('bulletHellScore').textContent = getTranslation('score') + (bulletHellGame.score ? Math.floor(bulletHellGame.score) : 0);
        document.getElementById('bulletHellBestScore').textContent = getTranslation('bestScore') + (bulletHellGame.bestScore || 0);
        document.getElementById('bulletHellLives').textContent = getTranslation('lives') + (bulletHellGame.lives || 0);
      }

      // Update Math UI if visible
      if (document.getElementById('mathScore') && mathGame.gameRunning) {
          updateMathUI(); // This function will use the new language
      } else if (document.getElementById('mathScore') && !mathGame.gameRunning && document.getElementById('page-math').classList.contains('active')) {
          // If Math page is active but game is not running (e.g. difficulty select or game over screen)
          // Ensure scores and question count display are reset for translation purposes.
          document.getElementById('mathScore').textContent = getTranslation('score') + (mathGame.score || 0);
          document.getElementById('mathQuestionCount').textContent = getTranslation('questionCount') + `0/${mathGame.totalQuestions}`;
      }

      // Update tool buttons if they are rendered
      const mainToolArea = document.getElementById('mainToolArea');
      if (mainToolArea && mainToolArea.children.length > 0 && mainToolArea.querySelector('.btn[onclick="showFortune()"]')) {
        mainToolArea.querySelector('.btn[onclick="showFortune()"]').textContent = `ğŸŒŸ ${getTranslation('fortuneBtn')}`;
        mainToolArea.querySelector('.btn[onclick="showJoke()"]').textContent = `ğŸ˜‚ ${getTranslation('jokeBtn')}`;
        mainToolArea.querySelector('.btn[onclick="showFact()"]').textContent = `ğŸ§  ${getTranslation('factBtn')}`;
      }

      // Stone elasticity label and hint text
      const elasticityLabel = document.querySelector('label[for="elasticityRange"]');
      if (elasticityLabel) { // Check if element exists
        elasticityLabel.textContent = getTranslation('elasticityLabel');
      }
      const stoneHintDiv = document.querySelector('.stone-controls .muted');
      if (stoneHintDiv) {
          stoneHintDiv.textContent = getTranslation('stoneHint');
      }
    }

    /* -----------------------
       å…¨å±€è®¾ç½® + ç™»å½• / å½©è›‹ / è¿ç¦è¯
       ------------------------*/
    /* -----------------------
       å…¨å±€è®¾ç½® + ç™»å½• / å½©è›‹ / è¿ç¦è¯
       ------------------------*/
    const badWords = ["fuck","shit","bitch","asshole","å‚»é€¼","å¦ˆçš„","æ“","å±","æ»š","æ»šä½ ","å»æ­»"];
    const easterAliases = ["eason","eason xie","easonxie","easonx","eason_xie"];
    const nameInput = document.getElementById('nameInput');
    const dynamicHintMsg = document.getElementById('dynamicHintMsg'); // Renamed from hintText
    const enterBtn = document.getElementById('enterBtn');
    const demoBtn = document.getElementById('demoBtn');
    const userBadge = document.getElementById('userBadge');
    const toHomeBtn = document.getElementById('toHomeBtn');

    // helpers for page switching
    function showPage(id) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      const el = document.getElementById(id);
      if(el) el.classList.add('active');
      // show/hide back button
      const hasSpecificBackButton = document.querySelector(`#${id} .btn[data-i18n-key="returnToHome"], #${id} .btn[data-i18n-key="returnToLearning"]`);
      const isTopLevel = id === 'page-main' || id === 'page-name';
      toHomeBtn.style.display = (isTopLevel || hasSpecificBackButton) ? 'none' : 'inline-flex';
    }

    // check input realtime
    function checkInputRealtime() {
      const raw = nameInput.value || '';
      const v = raw.trim().toLowerCase();
      dynamicHintMsg.className = 'hint'; // Apply to dynamicHintMsg
      dynamicHintMsg.innerHTML = ''; // Use innerHTML
      if (!v) { dynamicHintMsg.innerHTML = ''; dynamicHintMsg.className=''; return; } // Use innerHTML

      for (let b of badWords) {
        if (v.includes(b)) {
          dynamicHintMsg.innerHTML = getTranslation('badWordWarning'); // Use innerHTML
          dynamicHintMsg.className = 'error';
          return;
        }
      }
      if (easterAliases.includes(v) || v === 'eason' || v.includes('eason')) {
        dynamicHintMsg.innerHTML = getTranslation('easterEggGreeting'); // Use innerHTML
        dynamicHintMsg.className = 'hint';
        // special style â€” pulsate (we'll set briefly)
        dynamicHintMsg.animate([{transform:'scale(1)'},{transform:'scale(1.06)'},{transform:'scale(1)'}],{duration:700});
        return;
      }
      dynamicHintMsg.innerHTML = ''; // No specific dynamic message, rely on static hint
      dynamicHintMsg.className = '';
    }

    nameInput.addEventListener('input', checkInputRealtime);
    nameInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        enterEarth();
      }
    });

    function shakeHint() { // This now applies to dynamicHintMsg
      dynamicHintMsg.classList.remove('shake');
      void dynamicHintMsg.offsetWidth;
      dynamicHintMsg.classList.add('shake');
    }

    function enterEarth() {
      const raw = nameInput.value || '';
      const v = raw.trim();
      const low = v.toLowerCase();
      for (let b of badWords) {
        if (low.includes(b)) {
          dynamicHintMsg.innerHTML = getTranslation('badWordWarning'); // Use innerHTML
          dynamicHintMsg.className = 'error';
          shakeHint();
          return;
        }
      }
      let display = v || getTranslation('welcomeAnon', {name:''}); // Use translation
      // if easter alias, add small special greeting
      if (easterAliases.includes(low) || low.includes('eason')) {
        display = display + `ï¼ˆ${getTranslation('easterEggGreeting').replace(' ğŸ‰', '')}ï¼‰`; // Only the text part
      }
      userBadge.textContent = display;
      document.getElementById('welcomeText').textContent = getTranslation('welcomeUser', {name: display}); // Use translation
      document.querySelector('#page-main .muted').textContent = getTranslation('chooseGame'); // Update this too
      showPage('page-main');
    }

    enterBtn.addEventListener('click', enterEarth);
    demoBtn.addEventListener('click', () => {
      nameInput.value = '';
      userBadge.textContent = getTranslation('welcomeAnon', {name:''}); // Use translation
      document.getElementById('welcomeText').textContent = getTranslation('welcomeAnon', {name:''}); // Use translation
      document.querySelector('#page-main .muted').textContent = getTranslation('chooseGame'); // Update this too
      showPage('page-main');
    });

    toHomeBtn.addEventListener('click', () => showPage('page-main'));

    // Language selector event listener
    const languageSelector = document.getElementById('languageSelector');
    languageSelector.value = currentLang; // Set initial selection
    languageSelector.addEventListener('change', (e) => {
      const newLang = e.target.value;
      setLanguage(newLang);
      localStorage.setItem('appLang', newLang); // Save preference
    });

    // Theme toggle event listener
    const themeToggle = document.getElementById('themeToggle');
    themeToggle.addEventListener('click', () => {
      document.body.classList.toggle('dark-theme');
      // Save theme preference (optional)
      if (document.body.classList.contains('dark-theme')) {
        localStorage.setItem('appTheme', 'dark');
        themeToggle.textContent = 'â˜€ï¸';
      } else {
        localStorage.setItem('appTheme', 'light');
        themeToggle.textContent = 'ğŸŒ™';
      }
    });

    // Apply saved language and theme on load
    document.addEventListener('DOMContentLoaded', () => {
        const storedLang = localStorage.getItem('appLang');
        if (storedLang && i18n[storedLang]) {
            setLanguage(storedLang);
        } else {
            setLanguage(currentLang); // Apply default
        }

        if (localStorage.getItem('appTheme') === 'dark') {
            document.body.classList.add('dark-theme');
            themeToggle.textContent = getTranslation('lightThemeIcon'); // ä½¿ç”¨ç¿»è¯‘
        } else {
            document.body.classList.remove('dark-theme'); // Ensure light theme is set if not dark
            themeToggle.textContent = getTranslation('darkThemeIcon'); // ä½¿ç”¨ç¿»è¯‘
        }
        // Initial translation application after theme/lang are set
        applyTranslations(); // Call applyTranslations to ensure all data-i18n elements are translated
    });


    /* -----------------------
       æ‰“å¼€å„æ¨¡å—æŒ‰é’®
       ------------------------*/
    document.getElementById('openStone').addEventListener('click', ()=> { showPage('page-stone'); initStone(); });
    document.getElementById('stoneBack').addEventListener('click', ()=> { showPage('page-main'); });
    document.getElementById('openWordle').addEventListener('click', ()=> { showPage('page-wordle'); initWordle(); });
    document.getElementById('wordleBack').addEventListener('click', ()=> { showPage('page-main'); });
    document.getElementById('open2048').addEventListener('click', ()=> { showPage('page-2048'); init2048(); });
    document.getElementById('g2048Back').addEventListener('click', ()=> { showPage('page-main'); });
    document.getElementById('openBulletHell').addEventListener('click', ()=> { showPage('page-bullet-hell'); initBulletHell(); });
    document.getElementById('bulletHellBack').addEventListener('click', ()=> { showPage('page-main'); });
    document.getElementById('bulletHellStartBtn').addEventListener('click', ()=> { startGameBulletHell(); });
    document.getElementById('bulletHellInfo').addEventListener('click', ()=> alert(getTranslation('bulletHellInfoText')));
    document.getElementById('openLearning').addEventListener('click', ()=> { showPage('page-learning'); });
    document.getElementById('learningBack').addEventListener('click', ()=> { showPage('page-main'); }); // From Learning Hub back to Main

    // Math Game navigation and controls
    document.getElementById('openMath').addEventListener('click', ()=> { showPage('page-math'); initMath(); });
    document.getElementById('mathBack').addEventListener('click', ()=> { showPage('page-learning'); }); // From Math Game back to Learning Hub
    document.getElementById('mathInfo').addEventListener('click', ()=> alert(getTranslation('mathInfoText')));

    document.getElementById('mathRestartBtn').addEventListener('click', ()=> initMath());
    document.getElementById('mathNextQuestionBtn').addEventListener('click', checkAnswer);

    // Difficulty buttons event listeners
    document.querySelectorAll('#mathDifficulty .btn').forEach(button => {
        button.addEventListener('click', (e) => {
            const difficulty = e.target.dataset.difficulty;
            startMathGame(difficulty);
        });
    });

    // Handle Enter key for math answer input
    document.getElementById('mathAnswerInput').addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && mathGame.gameRunning) {
            checkAnswer();
            e.preventDefault(); // Prevent accidental form submission
        }
    });
    document.getElementById('openTools').addEventListener('click', ()=> {
      const area = document.getElementById('mainToolArea');
      area.innerHTML = `
        <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
          <button class="btn" onclick="showFortune()">ğŸŒŸ ${getTranslation('fortuneBtn')}</button>
          <button class="btn" onclick="showJoke()">ğŸ˜‚ ${getTranslation('jokeBtn')}</button>
          <button class="btn" onclick="showFact()">ğŸ§  ${getTranslation('factBtn')}</button>
        </div>
        <div id="toolOutput" style="margin-top:12px;font-weight:700"></div>
      `;
      // No need to call applyTranslations here explicitly for these buttons as their text is set directly with getTranslation
    });

    window.showFortune = ()=> {
      const fortunes = i18n[currentLang].fortunes; // Use translation
      document.getElementById('toolOutput').textContent = fortunes[Math.floor(Math.random()*fortunes.length)];
    }
    window.showJoke = ()=> {
      const jokes = i18n[currentLang].jokes; // Use translation
      document.getElementById('toolOutput').textContent = jokes[Math.floor(Math.random()*jokes.length)];
    }
    window.showFact = ()=> {
      const facts = i18n[currentLang].facts; // Use translation
      document.getElementById('toolOutput').textContent = facts[Math.floor(Math.random()*facts.length)];
    }

    /* -----------------------
       STONE GAME (canvas) - draggable stone with gravity with improved physics
       ------------------------*/
    let stoneInited=false;
    function initStone(){
      if(stoneInited) return;
      stoneInited=true;
      const canvas = document.getElementById('stoneCanvas');
      const ctx = canvas.getContext('2d');
      function resize(){
        canvas.width = canvas.clientWidth * devicePixelRatio;
        canvas.height = Math.max(300, canvas.clientHeight) * devicePixelRatio;
        ctx.scale(devicePixelRatio, devicePixelRatio);
      }
      canvas.style.height = '420px';
      resize();
      window.addEventListener('resize', ()=> { ctx.setTransform(1,0,0,1,0,0); resize(); draw(); });

      // Stone physics parameters
      const G = 1200; // gravity px/s^2
      let ELASTICITY = 0.82; // Coefficient of restitution (bounciness)
      const AIR_FRICTION = 0.999; // Air resistance factor
      const GROUND_FRICTION = 0.98; // Velocity reduction on ground contact

      let stone = { x:150, y:40, r:28, vx:0, vy:0, fixed:false, lastX:150, lastY:40 }; // Added lastX/Y for velocity calculation
      let last = performance.now();
      let dragging=false, dragOffset = {x:0,y:0};
      let lastMousePos = {x:0, y:0};
      let mouseVel = {x:0, y:0};
      let lastMouseTime = performance.now();

      // Elasticity slider
      const elasticityRange = document.getElementById('elasticityRange');
      elasticityRange.value = ELASTICITY; // Set initial value
      elasticityRange.addEventListener('input', (e) => {
        ELASTICITY = parseFloat(e.target.value);
      });
      // Update elasticity label for i18n
      document.querySelector('label[for="elasticityRange"]').textContent = getTranslation('elasticityLabel');


      function draw(){
        // clear
        ctx.clearRect(0,0,canvas.width,canvas.height);
        // background ground
        const w = canvas.clientWidth, h = canvas.clientHeight;
        ctx.fillStyle = 'rgba(255,255,255,0.02)';
        ctx.fillRect(0,0,w,h);
        // ground line
        ctx.fillStyle = 'rgba(255,255,255,0.04)';
        ctx.fillRect(0,h-40,w,40);
        // stone shadow
        ctx.beginPath();
        ctx.ellipse(stone.x, h-18, stone.r*0.9, stone.r*0.28, 0, 0, Math.PI*2);
        ctx.fillStyle = 'rgba(0,0,0,0.18)';
        ctx.fill();
        // stone
        ctx.beginPath();
        const g = ctx.createRadialGradient(stone.x-stone.r*0.4, stone.y-stone.r*0.4, 2, stone.x, stone.y, stone.r*1.3);
        g.addColorStop(0,'#e6e6e6'); g.addColorStop(1,'#bdbdbd');
        ctx.fillStyle = g;
        ctx.arc(stone.x, stone.y, stone.r, 0, Math.PI*2);
        ctx.fill();
        // texture
        ctx.strokeStyle = 'rgba(0,0,0,0.06)';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(stone.x-stone.r*0.6, stone.y);
        ctx.lineTo(stone.x+stone.r*0.3, stone.y+stone.r*0.2);
        ctx.stroke();
      }

      function step(now){
        let dt = (now - last)/1000;
        if (dt > 0.05) dt = 0.05; // Cap delta time to prevent physics explosions
        last = now;
        const h = canvas.clientHeight;

        if(!dragging){
          // Apply gravity
          stone.vy += G*dt;

          // Apply air friction (simple damping)
          stone.vx *= Math.pow(AIR_FRICTION, dt * 60); // Apply per-second damping
          stone.vy *= Math.pow(AIR_FRICTION, dt * 60);

          // Integrate position (Verlet-like for stability, though explicit Euler is fine here)
          stone.x += stone.vx*dt;
          stone.y += stone.vy*dt;

          // Floor collision
          const floorY = h - 40 - stone.r;
          if(stone.y > floorY){
            stone.y = floorY;
            stone.vy = -stone.vy * ELASTICITY; // Use elasticity
            stone.vx *= GROUND_FRICTION; // Ground friction
            // Stop if very slow
            if(Math.abs(stone.vy) < 20) stone.vy = 0;
            if(Math.abs(stone.vx) < 10) stone.vx = 0;
          }

          // Wall collisions
          if(stone.x < stone.r){
            stone.x = stone.r;
            stone.vx = -stone.vx * ELASTICITY;
            if(Math.abs(stone.vx) < 10) stone.vx = 0;
          }
          if(stone.x > canvas.clientWidth - stone.r){
            stone.x = canvas.clientWidth - stone.r;
            stone.vx = -stone.vx * ELASTICITY;
            if(Math.abs(stone.vx) < 10) stone.vx = 0;
          }
        }
        draw();
        requestAnimationFrame(step);
      }
      requestAnimationFrame(step);

      // pointer events for drag
      function toLocal(e){
        const rect = canvas.getBoundingClientRect();
        const x = (e.clientX || (e.touches && e.touches[0].clientX)) - rect.left;
        const y = (e.clientY || (e.touches && e.touches[0].clientY)) - rect.top;
        return {x,y};
      }
      function onDown(e){
        e.preventDefault();
        const p = toLocal(e);
        const dx = p.x - stone.x, dy = p.y - stone.y;
        if(Math.hypot(dx,dy) <= stone.r + 8){
          dragging = true;
          stone.fixed = true;
          dragOffset.x = dx; dragOffset.y = dy;
          stone.vx = stone.vy = 0; // Stop stone movement when dragging starts
          lastMousePos = {x:p.x, y:p.y};
          lastMouseTime = performance.now();
        }
      }
      function onMove(e){
        if(!dragging) return;
        const p = toLocal(e);
        stone.x = p.x - dragOffset.x;
        stone.y = p.y - dragOffset.y;

        const now = performance.now();
        const dt = (now - lastMouseTime) / 1000;
        if (dt > 0) {
          mouseVel.x = (p.x - lastMousePos.x) / dt;
          mouseVel.y = (p.y - lastMousePos.y) / dt;
        }
        lastMousePos = {x:p.x, y:p.y};
        lastMouseTime = now;
      }
      function onUp(e){
        if(dragging){
          dragging = false;
          stone.fixed = false;
          // Transfer mouse velocity to stone velocity
          stone.vx = mouseVel.x * 0.8; // Dampen the thrown velocity slightly
          stone.vy = mouseVel.y * 0.8; // Dampen the thrown velocity slightly
        }
      }
      canvas.addEventListener('mousedown', onDown);
      canvas.addEventListener('mousemove', onMove);
      window.addEventListener('mouseup', onUp);
      canvas.addEventListener('touchstart', onDown, {passive:false});
      canvas.addEventListener('touchmove', onMove, {passive:false});
      canvas.addEventListener('touchend', onUp);

      document.getElementById('resetStone').addEventListener('click', ()=> {
        stone.x = 150; stone.y = 60; stone.vx = 0; stone.vy = 0;
        dragging = false; // Ensure dragging stops on reset
      });
      // initial draw
      draw();
    }

    /* -----------------------
       MATH GAME
       ------------------------*/

    // New helper for getting random integer
    function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    // New helper for evaluating expressions accurately (returns float if needed)
    function evaluateAccurate(a, op, b) {
        let res;
        switch (op) {
            case '+': res = a + b; break;
            case '-': res = a - b; break;
            case '*': res = a * b; break;
            case '/':
                if (b === 0) return 0; // Safeguard, should be prevented by problem generation
                res = a / b;
                break;
            default: res = 0;
        }
        return res; // Return the exact result
    }

    function initMath() {
        mathGame.gameRunning = false;
        document.getElementById('mathDifficulty').style.display = 'flex';
        document.getElementById('mathGameArea').style.display = 'none';
        document.getElementById('mathMessage').textContent = '';
        document.getElementById('mathAnswerInput').value = '';
        document.getElementById('mathQuestion').textContent = '';
        if (mathGame.animationFrameId) {
            cancelAnimationFrame(mathGame.animationFrameId);
            mathGame.animationFrameId = null;
        }
        document.getElementById('mathProgressBar').style.width = '100%'; // Reset bar visual
        updateMathUI(); // Reset scores/question count visually
    }

    function startMathGame(difficulty) {
        mathGame.currentDifficulty = difficulty;
        mathGame.score = 0;
        mathGame.questionNumber = 0;
        mathGame.gameRunning = true;
        document.getElementById('mathDifficulty').style.display = 'none';
        document.getElementById('mathGameArea').style.display = 'flex';
        document.getElementById('mathMessage').textContent = '';

        // Set time per question based on difficulty
        switch(difficulty) {
            case 'easy': mathGame.timePerQuestion = 20000; break; // 20 seconds
            case 'medium': mathGame.timePerQuestion = 18000; break; // 18 seconds (slightly more time for new challenge)
            case 'hard': mathGame.timePerQuestion = 15000; break; // 15 seconds
            case 'expert': mathGame.timePerQuestion = 12000; break; // 12 seconds
            case 'master': mathGame.timePerQuestion = 10000; break; // 10 seconds
            default: mathGame.timePerQuestion = 18000; // Default to medium
        }

        nextMathQuestion();
    }

    function nextMathQuestion() {
        if (!mathGame.gameRunning) return; // Ensure game is still running
        if (mathGame.questionNumber >= mathGame.totalQuestions) {
            gameOverMath();
            return;
        }
        mathGame.questionNumber++;
        document.getElementById('mathAnswerInput').value = '';
        document.getElementById('mathMessage').textContent = '';
        
        generateMathProblem(mathGame.currentDifficulty); // This also updates mathGame.currentProblem/correctAnswer
        
        mathGame.timeRemaining = mathGame.timePerQuestion;
        mathGame.lastProgressTime = performance.now();
        if (mathGame.animationFrameId) {
            cancelAnimationFrame(mathGame.animationFrameId);
        }
        updateProgressBarSmooth(performance.now()); // Start smooth animation
        updateMathUI();
        document.getElementById('mathAnswerInput').focus();
    }

    function generateMathProblem(difficulty) {
        let problem = '';
        let answer = 0;
        let num1, num2, num3, num4; 
        let op1, op2, op3;
        
        const operations = ['+', '-', '*', '/'];

        function getRandOp(excludeDiv = false) {
            const ops = excludeDiv ? ['+', '-', '*'] : operations;
            return ops[getRandomInt(0, ops.length - 1)];
        }

        // Generates a dividend and a divisor such that the division result is an integer >= 1
        function generateIntegerDivisionPair(maxDividend, maxDivisor) {
            let divisor;
            let dividend;
            let result;

            do {
                divisor = getRandomInt(1, maxDivisor);
                // Ensure there's at least one possible integer result >= 1
                const maxPossibleResult = Math.floor(maxDividend / divisor);
                if (maxPossibleResult < 1) { // If no positive integer result >= 1 is possible, retry divisor
                    continue;
                }
                result = getRandomInt(1, maxPossibleResult);
                dividend = divisor * result;
            } while (false); // Loop only once if conditions are met. This `while(false)` is a pattern to allow `continue`
            
            return [dividend, divisor];
        }

        switch (difficulty) {
            case 'easy':
                // Numbers: 1-20
                // Operations: +, -, *, /
                // No decimals, subtraction non-negative, division yields integer
                num1 = getRandomInt(1, 20);
                num2 = getRandomInt(1, 20);
                op1 = getRandOp();
                
                if (op1 === '/') {
                    [num1, num2] = generateIntegerDivisionPair(20, 10); // Dividend up to 20, divisor up to 10
                } else if (op1 === '-') {
                    while (num1 < num2) num1 = getRandomInt(1, 20); // Ensure non-negative result
                }

                problem = `${num1} ${op1} ${num2}`;
                answer = evaluateAccurate(num1, op1, num2);
                break;

            case 'medium':
                // Numbers: 1-50
                // Operations: +, -, *, /
                // No decimals, division yields integer, multiplication with smaller factors
                num1 = getRandomInt(1, 50);
                num2 = getRandomInt(1, 50);
                op1 = getRandOp();

                if (op1 === '/') {
                    [num1, num2] = generateIntegerDivisionPair(50, 15); // Dividend up to 50, divisor up to 15
                } else if (op1 === '*') {
                    num2 = getRandomInt(2, 12); // Smaller multiplier for one operand
                } else if (op1 === '-') {
                    // Allow simple negative results, or non-negative more often
                    if (Math.random() < 0.7) { // 70% chance for non-negative
                        while (num1 < num2) num1 = getRandomInt(1, 50);
                    }
                }
                
                problem = `${num1} ${op1} ${num2}`;
                answer = evaluateAccurate(num1, op1, num2);
                break;

            case 'hard':
                // Numbers: 1-100 (for single ops), maybe -20 to 100 for chained
                // Operations: chained +, -, *, / (max 2 ops)
                // No decimals, division yields integer, handle operator precedence
                num1 = getRandomInt(1, 100);
                num2 = getRandomInt(1, 100);
                op1 = getRandOp();

                if (Math.random() < 0.6) { // 60% chance for chained operations (A op B) op C
                    num3 = getRandomInt(1, 20); // Third operand smaller
                    op2 = getRandOp();

                    // Generate first part (A op1 B)
                    let currentNum1 = num1;
                    let currentNum2 = num2;
                    if (op1 === '/') {
                        [currentNum1, currentNum2] = generateIntegerDivisionPair(100, 15); // Max 100, div up to 15
                    }
                    if (op1 === '-' && currentNum1 < currentNum2 && Math.random() < 0.5) currentNum1 = getRandomInt(currentNum2, 100); // Sometimes force non-negative
                    if (op1 === '*' && currentNum2 > 15) currentNum2 = getRandomInt(2, 15); // Smaller multiplier

                    let intermediateResult = evaluateAccurate(currentNum1, op1, currentNum2);
                    
                    // Generate second part (intermediateResult op2 C)
                    let currentNum3 = num3;
                    if (op2 === '/') {
                        if (!Number.isInteger(intermediateResult) || intermediateResult === 0) {
                            op2 = getRandOp(true); // Change to non-division if intermediate is not a clean integer or zero
                            currentNum3 = getRandomInt(1,20); // Assign a new random num3
                        } else {
                             let divisors = [];
                            for (let i = 1; i <= Math.abs(intermediateResult); i++) {
                                if (intermediateResult % i === 0) {
                                    divisors.push(i);
                                }
                            }
                            if (divisors.length > 0) {
                                const validDivisors = divisors.filter(d => d <= 10 && d >= 1); // Keep divisors small for mental math
                                if (validDivisors.length > 0) {
                                    currentNum3 = validDivisors[getRandomInt(0, validDivisors.length - 1)];
                                } else {
                                    currentNum3 = divisors[getRandomInt(0, divisors.length - 1)]; // Fallback to any divisor
                                    if (currentNum3 > 10 && Math.random() < 0.7) { // High chance to change op if large divisor
                                        op2 = getRandOp(true);
                                        currentNum3 = getRandomInt(1,20);
                                    }
                                }
                            } else { // Should not happen for integers
                                op2 = getRandOp(true);
                                currentNum3 = getRandomInt(1,20);
                            }
                        }
                    }
                    if (op2 === '*' && currentNum3 > 15) currentNum3 = getRandomInt(2, 15); // Smaller multiplier
                    if (op2 === '-' && intermediateResult < currentNum3 && Math.random() < 0.5) currentNum3 = getRandomInt(intermediateResult, 20); // Sometimes force non-negative

                    // For display, use parentheses for clarity in chained operations for mental math
                    problem = `(${currentNum1} ${op1} ${currentNum2}) ${op2} ${currentNum3}`;
                    answer = evaluateAccurate(intermediateResult, op2, currentNum3);

                } else { // Single operation for hard
                    if (op1 === '/') {
                        [num1, num2] = generateIntegerDivisionPair(100, 20); // Max 100, div up to 20
                    }
                    if (op1 === '-' && num1 < num2 && Math.random() < 0.5) num1 = getRandomInt(num2, 100);
                    if (op1 === '*' && num2 > 20) num2 = getRandomInt(2, 20);
                    problem = `${num1} ${op1} ${num2}`;
                    answer = evaluateAccurate(num1, op1, num2);
                }
                break;

            case 'expert':
                // Numbers: Larger integers (-100 to 200), max 3 operations, chained
                // No decimals, division yields integer, explicit grouping for mental math
                num1 = getRandomInt(-100, 200);
                num2 = getRandomInt(-100, 200);
                op1 = getRandOp();

                // Generate first part (A op1 B)
                let currentNum1_exp = num1;
                let currentNum2_exp = num2;
                if (op1 === '/') {
                    [currentNum1_exp, currentNum2_exp] = generateIntegerDivisionPair(200, 20);
                }
                if (op1 === '-' && currentNum1_exp < currentNum2_exp && Math.random() < 0.3) currentNum1_exp = getRandomInt(currentNum2_exp, 200);
                if (op1 === '*' && currentNum2_exp > 20) currentNum2_exp = getRandomInt(2, 20);

                let intermediateRes_exp1 = evaluateAccurate(currentNum1_exp, op1, currentNum2_exp);

                // Generate second part (intermediateRes_exp1 op2 C)
                num3 = getRandomInt(-20, 100);
                op2 = getRandOp();

                let currentNum3_exp = num3;
                if (op2 === '/') {
                    if (!Number.isInteger(intermediateRes_exp1) || intermediateRes_exp1 === 0) {
                        op2 = getRandOp(true);
                        currentNum3_exp = getRandomInt(1, 30);
                    } else {
                        let divisors = [];
                        for (let i = 1; i <= Math.abs(intermediateRes_exp1); i++) {
                            if (intermediateRes_exp1 % i === 0) {
                                divisors.push(i);
                            }
                        }
                        if (divisors.length > 0) {
                            const validDivisors = divisors.filter(d => d <= 15 && d >= 1);
                            if (validDivisors.length > 0) {
                                currentNum3_exp = validDivisors[getRandomInt(0, validDivisors.length - 1)];
                            } else {
                                currentNum3_exp = divisors[getRandomInt(0, divisors.length - 1)];
                                if (currentNum3_exp > 15 && Math.random() < 0.7) {
                                    op2 = getRandOp(true);
                                    currentNum3_exp = getRandomInt(1,30);
                                }
                            }
                        } else {
                            op2 = getRandOp(true);
                            currentNum3_exp = getRandomInt(1,30);
                        }
                    }
                }
                if (op2 === '*' && currentNum3_exp > 20) currentNum3_exp = getRandomInt(2, 20);
                if (op2 === '-' && intermediateRes_exp1 < currentNum3_exp && Math.random() < 0.3) currentNum3_exp = getRandomInt(intermediateRes_exp1, 100);


                // Decide if to add a third operation
                if (Math.random() < 0.5) { // 50% chance for a third operation ((A op B) op C) op D
                    let intermediateRes_exp2 = evaluateAccurate(intermediateRes_exp1, op2, currentNum3_exp);
                    num4 = getRandomInt(-10, 50);
                    op3 = getRandOp();

                    let currentNum4_exp = num4;
                    if (op3 === '/') {
                        if (!Number.isInteger(intermediateRes_exp2) || intermediateRes_exp2 === 0) {
                            op3 = getRandOp(true);
                            currentNum4_exp = getRandomInt(1, 20);
                        } else {
                            let divisors = [];
                            for (let i = 1; i <= Math.abs(intermediateRes_exp2); i++) {
                                if (intermediateRes_exp2 % i === 0) {
                                    divisors.push(i);
                                }
                            }
                            if (divisors.length > 0) {
                                const validDivisors = divisors.filter(d => d <= 10 && d >= 1);
                                if (validDivisors.length > 0) {
                                    currentNum4_exp = validDivisors[getRandomInt(0, validDivisors.length - 1)];
                                } else {
                                    currentNum4_exp = divisors[getRandomInt(0, divisors.length - 1)];
                                    if (currentNum4_exp > 10 && Math.random() < 0.7) {
                                        op3 = getRandOp(true);
                                        currentNum4_exp = getRandomInt(1,20);
                                    }
                                }
                            } else {
                                op3 = getRandOp(true);
                                currentNum4_exp = getRandomInt(1,20);
                            }
                        }
                    }
                    if (op3 === '*' && currentNum4_exp > 10) currentNum4_exp = getRandomInt(2, 10);
                    if (op3 === '-' && intermediateRes_exp2 < currentNum4_exp && Math.random() < 0.3) currentNum4_exp = getRandomInt(intermediateRes_exp2, 50);
                    
                    problem = `((${currentNum1_exp} ${op1} ${currentNum2_exp}) ${op2} ${currentNum3_exp}) ${op3} ${currentNum4_exp}`;
                    answer = evaluateAccurate(intermediateRes_exp2, op3, currentNum4_exp);
                } else { // Two operations (A op B) op C
                    problem = `(${currentNum1_exp} ${op1} ${currentNum2_exp}) ${op2} ${currentNum3_exp}`;
                    answer = evaluateAccurate(intermediateRes_exp1, op2, currentNum3_exp);
                }
                break;

            case 'master':
                // Numbers: Larger integers (-300 to 400), 3-4 operations, chained
                // No decimals, division yields integer, explicit grouping for mental math
                num1 = getRandomInt(-300, 400);
                num2 = getRandomInt(-300, 400);
                op1 = getRandOp();

                // Generate first part (A op1 B)
                let currentNum1_mas = num1;
                let currentNum2_mas = num2;
                if (op1 === '/') {
                    [currentNum1_mas, currentNum2_mas] = generateIntegerDivisionPair(400, 30);
                }
                if (op1 === '-' && currentNum1_mas < currentNum2_mas && Math.random() < 0.2) currentNum1_mas = getRandomInt(currentNum2_mas, 400);
                if (op1 === '*' && currentNum2_mas > 30) currentNum2_mas = getRandomInt(2, 30);

                let intermediateRes_mas1 = evaluateAccurate(currentNum1_mas, op1, currentNum2_mas);

                // Generate second part (intermediateRes_mas1 op2 C)
                num3 = getRandomInt(-50, 150);
                op2 = getRandOp();

                let currentNum3_mas = num3;
                if (op2 === '/') {
                    if (!Number.isInteger(intermediateRes_mas1) || intermediateRes_mas1 === 0) {
                        op2 = getRandOp(true);
                        currentNum3_mas = getRandomInt(1, 50);
                    } else {
                        let divisors = [];
                        for (let i = 1; i <= Math.abs(intermediateRes_mas1); i++) {
                            if (intermediateRes_mas1 % i === 0) {
                                divisors.push(i);
                            }
                        }
                        if (divisors.length > 0) {
                            const validDivisors = divisors.filter(d => d <= 20 && d >= 1);
                            if (validDivisors.length > 0) {
                                currentNum3_mas = validDivisors[getRandomInt(0, validDivisors.length - 1)];
                            } else {
                                currentNum3_mas = divisors[getRandomInt(0, divisors.length - 1)];
                                if (currentNum3_mas > 20 && Math.random() < 0.7) {
                                    op2 = getRandOp(true);
                                    currentNum3_mas = getRandomInt(1,50);
                                }
                            }
                        } else {
                            op2 = getRandOp(true);
                            currentNum3_mas = getRandomInt(1,50);
                        }
                    }
                }
                if (op2 === '*' && currentNum3_mas > 25) currentNum3_mas = getRandomInt(2, 25);
                if (op2 === '-' && intermediateRes_mas1 < currentNum3_mas && Math.random() < 0.2) currentNum3_mas = getRandomInt(intermediateRes_mas1, 150);
                
                let intermediateRes_mas2 = evaluateAccurate(intermediateRes_mas1, op2, currentNum3_mas);

                // Generate third part (intermediateRes_mas2 op3 D)
                num4 = getRandomInt(-20, 80);
                op3 = getRandOp();

                let currentNum4_mas = num4;
                if (op3 === '/') {
                    if (!Number.isInteger(intermediateRes_mas2) || intermediateRes_mas2 === 0) {
                        op3 = getRandOp(true);
                        currentNum4_mas = getRandomInt(1, 30);
                    } else {
                        let divisors = [];
                        for (let i = 1; i <= Math.abs(intermediateRes_mas2); i++) {
                            if (intermediateRes_mas2 % i === 0) {
                                divisors.push(i);
                            }
                        }
                        if (divisors.length > 0) {
                            const validDivisors = divisors.filter(d => d <= 15 && d >= 1);
                            if (validDivisors.length > 0) {
                                currentNum4_mas = validDivisors[getRandomInt(0, validDivisors.length - 1)];
                            } else {
                                currentNum4_mas = divisors[getRandomInt(0, divisors.length - 1)];
                                if (currentNum4_mas > 15 && Math.random() < 0.7) {
                                    op3 = getRandOp(true);
                                    currentNum4_mas = getRandomInt(1,30);
                                }
                            }
                        } else {
                            op3 = getRandOp(true);
                            currentNum4_mas = getRandomInt(1,30);
                        }
                    }
                }
                if (op3 === '*' && currentNum4_mas > 15) currentNum4_mas = getRandomInt(2, 15);
                if (op3 === '-' && intermediateRes_mas2 < currentNum4_mas && Math.random() < 0.2) currentNum4_mas = getRandomInt(intermediateRes_mas2, 80);

                problem = `((${currentNum1_mas} ${op1} ${currentNum2_mas}) ${op2} ${currentNum3_mas}) ${op3} ${currentNum4_mas}`;
                answer = evaluateAccurate(intermediateRes_mas2, op3, currentNum4_mas);
                break;
        }

        mathGame.currentProblem = problem.replace(/\s+/g, ' ');
        // Store the answer formatted to 2 decimal places for consistent comparison and display.
        // Since we are generating integer problems (and integer division), it will typically be X.00
        mathGame.correctAnswer = parseFloat(answer.toFixed(2)); 
        document.getElementById('mathQuestion').textContent = mathGame.currentProblem;
    }


    function checkAnswer() {
        if (!mathGame.gameRunning) return;

        const userAnswer = parseFloat(document.getElementById('mathAnswerInput').value);
        const feedbackElement = document.getElementById('mathMessage');

        // Stop progress bar and timer
        if (mathGame.animationFrameId) {
            cancelAnimationFrame(mathGame.animationFrameId);
            mathGame.animationFrameId = null;
        }

        // Determine points based on time remaining
        let pointsEarned = 0;
        const timeElapsed = mathGame.timePerQuestion - mathGame.timeRemaining;

        if (isNaN(userAnswer)) { // Check for invalid input like empty string
             pointsEarned = -1;
             feedbackElement.textContent = getTranslation('mathIncorrect', { answer: mathGame.correctAnswer.toFixed(2) });
             feedbackElement.className = 'error shake';
        } else if (Math.abs(userAnswer - mathGame.correctAnswer) < 0.01) { // Fuzzy comparison for floats (0.01 threshold for up to 2 decimal places)
            // Correct answer
            if (timeElapsed < mathGame.timePerQuestion * mathGame.scoreTiers[0]) {
                pointsEarned = 3;
            } else if (timeElapsed < mathGame.timePerQuestion * mathGame.scoreTiers[1]) {
                pointsEarned = 2;
            } else {
                pointsEarned = 1;
            }
            feedbackElement.textContent = getTranslation('mathCorrect');
            feedbackElement.className = 'hint'; // Correct answer feedback
        } else {
            // Incorrect answer
            pointsEarned = -1;
            feedbackElement.textContent = getTranslation('mathIncorrect', { answer: mathGame.correctAnswer.toFixed(2) });
            feedbackElement.className = 'error shake';
        }

        mathGame.score += pointsEarned;
        updateMathUI();

        // Regenerate problem and continue after a short delay
        setTimeout(() => {
            nextMathQuestion();
        }, 1000); // 1 second delay before next question
    }

    function timeoutMathQuestion() {
        if (!mathGame.gameRunning) return;

        // Stop progress bar and timer
        if (mathGame.animationFrameId) {
            cancelAnimationFrame(mathGame.animationFrameId);
            mathGame.animationFrameId = null;
        }

        const feedbackElement = document.getElementById('mathMessage');
        feedbackElement.textContent = getTranslation('mathTimeout', { answer: mathGame.correctAnswer.toFixed(2) });
        feedbackElement.className = 'error shake'; // Timeout also shows as error
        mathGame.score -= 1; // Deduct point for timeout
        updateMathUI();

        // Regenerate problem and continue after a short delay
        setTimeout(() => {
            nextMathQuestion();
        }, 1000); // 1 second delay before next question
    }

    // Smooth progress bar update using requestAnimationFrame
    function updateProgressBarSmooth(timestamp) {
        if (!mathGame.gameRunning) return;
        if (!mathGame.lastProgressTime) mathGame.lastProgressTime = timestamp;

        const elapsedSinceLastUpdate = timestamp - mathGame.lastProgressTime;
        mathGame.lastProgressTime = timestamp;

        mathGame.timeRemaining -= elapsedSinceLastUpdate;

        if (mathGame.timeRemaining <= 0) {
            mathGame.timeRemaining = 0;
            timeoutMathQuestion();
            return;
        }

        const progress = (mathGame.timeRemaining / mathGame.timePerQuestion) * 100;
        const progressBar = document.getElementById('mathProgressBar');
        progressBar.style.width = `${Math.max(0, progress)}%`; // Ensure width doesn't go negative

        // Request next frame
        mathGame.animationFrameId = requestAnimationFrame(updateProgressBarSmooth);
    }


    function updateMathUI() {
        document.getElementById('mathScore').textContent = `${getTranslation('score')}${mathGame.score}`;
        document.getElementById('mathQuestionCount').textContent = `${getTranslation('questionCount')}${mathGame.questionNumber}/${mathGame.totalQuestions}`;
        // The progress bar width is handled by updateProgressBarSmooth
    }

    function gameOverMath() {
        mathGame.gameRunning = false;
        if (mathGame.animationFrameId) {
            cancelAnimationFrame(mathGame.animationFrameId);
            mathGame.animationFrameId = null;
        }
        document.getElementById('mathGameArea').style.display = 'none';
        document.getElementById('mathDifficulty').style.display = 'flex';
        document.getElementById('mathMessage').textContent = getTranslation('mathGameFinish', { score: mathGame.score });
        document.getElementById('mathMessage').className = 'hint'; // Game over message as hint
        document.getElementById('mathQuestion').textContent = ''; // Clear question
    }

    /* -----------------------
       WORDLE clone (simple)
       - 5-letter words, 6 guesses
       ------------------------*/
    let wordleState = null;

    // Larger, more realistic English word list
    const targetWords = [
      "cigar", "rebut", "sissy", "humph", "awake", "blush", "focal", "evade", "naval", "serve", "heath", "dwarf", "model", "karma", "stink", "grade", "quiet", "feign", "gaily", "north", "flame", "swoop", "hasty", "scare", "stale", "twixt", "vivid", "clasp", "dream", "climb", "split", "gland", "glove", "weigh", "broom", "skate", "bugle", "claim", "patio", "smirk", "bless", "creat", "sworn", "quake", "gorge", "crude", "bagel", "smash", "windy", "brawl", "reign", "tread", "cheer", "fruit", "grime", "derby", "ovary", "grape", "stone", "apple", "pearl", "horse", "mouse", "plane", "story", "brick", "light", "trace", "sound", "drain", "shame", "stand", "blame", "grace", "chant", "hatch", "faint", "feast", "ghost", "giant", "haste", "honor", "knife", "lemon", "magic", "night", "ocean", "pouch", "quart", "ruler", "sniff", "truth", "unity", "voter", "waist", "youth", "zebra"
    ]; // A subset for daily words

    // A much larger list of valid 5-letter words for guesses
    const validGuesses = [
      "aahed", "aalii", "aargh", "aarti", "abaca", "abaci", "aback", "abacs", "abaft", "abaka", "abamp", "aband", "abase", "abash", "abask", "abaya", "abbas", "abbed", "abbes", "abbey", "abbot", "abcee", "abeam", "abear", "abele", "abets", "abhor", "abide", "abied", "abies", "abled", "abler", "ables", "ablow", "abmho", "abode", "abohm", "aboil", "aboma", "aboon", "abord", "abore", "abort", "about", "above", "abram", "abray", "abrim", "abrin", "abris", "absey", "absit", "abuna", "abune", "abuse", "abuts", "abuzz", "abyes", "abyss", "acdcd", "aceph", "acerb", "aches", "achoo", "achor", "acidy", "acing", "acini", "ackee", "ackey", "acles", "acned", "acnes", "acock", "acold", "acred", "acres", "acrid", "acron", "acted", "actin", "acton", "actor", "actos", "acute", "acyls", "adage", "adapt", "adawn", "adays", "adbot", "addax", "added", "adder", "addle", "adeem", "adept", "adhar", "adhoc", "adieu", "adios", "adits", "adjag", "admix", "adobo", "adopt", "adore", "adorn", "adown", "adoze", "adrad", "adred", "adsum", "aduki", "adult", "adunc", "adust", "adyta", "adyts", "aecia", "aedes", "aegan", "aeger", "aerie", "aeros", "aesir", "afald", "afara", "afars", "afear", "affen", "affix", "affle", "affly", "afghan", "afire", "aflaj", "afoot", "afore", "afoul", "afrit", "after", "again", "agama", "agamy", "agape", "agars", "agast", "agate", "agave", "agaze", "agene", "agent", "agger", "aggie", "aggri", "aggro", "aghas", "agila", "agile", "aging", "agios", "agism", "agist", "agita", "aglee", "aglet", "agley", "agloo", "aglow", "aglus", "agmas", "agoge", "agone", "agons", "agony", "agood", "agora", "agree", "agria", "agrin", "agrom", "agron", "agsam", "agued", "agues", "aguna", "agush", "aguti", "ahaed", "ahead", "aheap", "ahihi", "ahing", "ahint", "ahold", "ahoys", "ahull", "aidan", "aided", "aider", "aides", "ailed", "aimed", "aimer", "ainee", "ainga", "aioli", "aired", "airer", "airns", "airth", "airts", "aisle", "aitch", "aitus", "aiver", "aixes", "ajies", "ajiva", "ajuga", "ajwan", "akees", "akela", "akene", "aking", "akita", "akkas", "alamo", "aland", "alane", "alang", "alans", "alant", "alapa", "alaps", "alarm", "alary", "alate", "alays", "albas", "albee", "album", "alcid", "alcos", "aldea", "alder", "aldol", "aleck", "alecs", "alefs", "aleft", "aleph", "alert", "alews", "aleye", "alfas", "algal", "algas", "algid", "algin", "algor", "algum", "alias", "alibi", "alien", "alifs", "align", "alike", "aline", "alist", "alive", "aliya", "alkie", "alkos", "alkyd", "alkyl", "allay", "allee", "allel", "allen", "aller", "alley", "allix", "allod", "allot", "allow", "alloy", "allus", "allyl", "almah", "almas", "almeh", "almes", "almud", "almug", "alocs", "aloes", "aloft", "aloha", "aloin", "alone", "along", "aloof", "aloos", "aloud", "alpha", "altar", "alter", "altin", "altos", "altun", "alula", "alums", "alure", "alurs", "alway", "amahs", "amain", "amass", "amate", "amaut", "amban", "amber", "ambit", "amble", "ambos", "ambry", "ameba", "ameer", "amend", "amene", "amens", "ament", "amess", "amice", "amici", "amide", "amido", "amids", "amies", "amiga", "amigo", "amine", "amino", "amins", "amirs", "amiss", "amity", "amlas", "amman", "ammon", "ammos", "amnia", "amnic", "amnio", "amoks", "amole", "among", "amort", "amour", "amove", "amowt", "amped", "ample", "amply", "ampul", "amrit", "amuck", "amuse", "amyls", "anana", "anata", "ancho", "ancle", "ancon", "andro", "anear", "anele", "anent", "angas", "angel", "anger", "angle", "anglo", "angon", "angst", "anigh", "anile", "anils", "anima", "animi", "anion", "anise", "anker", "ankhs", "ankle", "ankus", "anlas", "annal", "annas", "annat", "annex", "annoy", "annul", "anoas", "anode", "anole", "anomy", "ansae", "antar", "antes", "antic", "antis", "antra", "antre", "antsy", "anura", "anvil", "anyon", "aorta", "apace", "apage", "apaid", "apayd", "apays", "apeak", "apeek", "apers", "apert", "apery", "apgar", "aphis", "apian", "aping", "apish", "apism", "apnea", "apple", "apply", "apron", "apses", "apsis", "apsos", "apres", "apter", "aptly", "aquae", "aquas", "araba", "araks", "arame", "arars", "arbas", "arbor", "arced", "archi", "ardeb", "ardor", "areae", "areal", "areas", "areca", "aredd", "arede", "arefy", "areic", "arena", "arene", "arepa", "arere", "arete", "argal", "argan", "argil", "argle", "argol", "argon", "argot", "argue", "argus", "arhat", "arias", "ariel", "ariki", "arils", "ariot", "arise", "arish", "arked", "arled", "armed", "armer", "armet", "armil", "armor", "arnas", "arnut", "aroba", "aroha", "aroid", "aroma", "arose", "arpas", "arpen", "arrah", "arras", "array", "arret", "arris", "arrow", "arroz", "arses", "arsis", "artsy", "artal", "artel", "artic", "artis", "artly", "aruhe", "arums", "arval", "arvos", "aryls", "asana", "ascon", "ascot", "ascus", "asdic", "ashed", "ashen", "ashes", "ashet", "aside", "asked", "asker", "askew", "askoi", "askos", "aspen", "asper", "aspic", "aspis", "assai", "assam", "assay", "assed", "asses", "asset", "assez", "assot", "aster", "astir", "asura", "asway", "aswim", "asyla", "ataps", "ataxy", "atigi", "atilt", "atimy", "atlas", "atman", "atmas", "atmos", "atocs", "atoke", "atoks", "atoll", "atoms", "atomy", "atone", "atony", "atopy", "atria", "atrip", "attap", "attar", "attic", "atule", "atumi", "atune", "atwoa", "auchs", "audio", "audit", "auger", "aught", "augur", "aulas", "aulic", "auloi", "aulos", "aumil", "aunes", "aunts", "aunty", "aurae", "aural", "aurar", "auras", "aurei", "aures", "auric", "aurin", "auris", "aurum", "autos", "auxes", "auxin", "avail", "avale", "avant", "avast", "avels", "avens", "avers", "avert", "avgas", "avian", "avine", "avion", "avise", "aviso", "avons", "avows", "awacs", "await", "awake", "award", "aware", "awarn", "awash", "awato", "awave", "aways", "awear", "aweto", "awful", "awing", "awkin", "awled", "awmes", "awmry", "awmut", "awork", "axels", "axile", "axils", "axing", "axiom", "axion", "axite", "axled", "axles", "axman", "axmen", "axoid", "axone", "axons", "ayahs", "ayaya", "ayelp", "aygre", "ayins", "ayont", "ayres", "ayrie", "azans", "azide", "azido", "azine", "azlon", "azoic", "azole", "azons", "azote", "azoth", "azuki", "azurn", "azury", "azygy", "azyme", "azyms",
      "babel", "bacon", "badge", "badly", "bagel", "baggy", "baker", "bakes", "baldy",
      "baled", "baler", "bales", "balks", "balky", "balls", "bally", "balms", "balmy", "balsa",
      "banal", "bands", "bandy", "banes", "bangs", "banjo", "banks", "bared", "barer", "bares",
      "barge", "barks", "barms", "barmy", "barns", "baron", "barre", "basal", "based", "baser",
      "bases", "basic", "basil", "basin", "basis", "basks", "baste", "batch", "bated", "bathe",
      "baths", "baton", "batty", "bawdy", "bawls", "bayed", "bayou", "beach", "beady", "beard",
      "bears", "beast", "beats", "beaus", "beech", "beefs", "beefy", "beeps", "beers", "beery",
      "beets", "befit", "befog", "began", "begat", "beget", "begin", "begun", "being", "belay",
      "belch", "belie", "belle", "bells", "belly", "below", "belts", "bench", "bends", "bendy",
      "bento", "beret", "bergs", "berry", "berth", "beset", "bests", "betas", "bevel", "bezel",
      "bible", "bicep", "biddy", "bided", "bides", "bight", "bigot", "bijou", "biked", "biker",
      "bikes", "bilge", "bills", "billy", "binds", "binge", "bingo", "biome", "biped", "birch",
      "birds", "birth", "bison", "bitch", "biter", "bites", "black", "blade", "blame", "bland",
      "blank", "blare", "blast", "blaze", "bleak", "bleat", "bleed", "bleep", "blend", "bless",
      "blimp", "blind", "bling", "blini", "blink", "blips", "bliss", "blitz", "bloat", "blobs",
      "block", "blocs", "bloke", "blond", "blood", "bloom", "bloop", "blots", "blown", "blows",
      "blued", "bluer", "blues", "bluff", "blunt", "blurb", "blurs", "blurt", "blush", "board",
      "boars", "boast", "boats", "bobby", "boded", "bodes", "boffo", "bogey", "boggy", "bogie",
      "bogus", "boils", "boles", "bolls", "bolts", "bomba", "bombs", "bonds", "boned", "boner",
      "bones", "bongo", "bongs", "bonny", "bonus", "booby", "books", "booms", "boons", "boors",
      "boost", "booth", "boots", "booty", "booze", "boozy", "borax", "bored", "borer", "bores",
      "boric", "borne", "boron", "bosom", "bossy", "botch", "bough", "bound", "bouts", "bowel",
      "bower", "bowls", "boxer", "boxes", "boyar", "brave", "brace", "brags", "braid", "brain",
      "brake", "brand", "brash", "brass", "brats", "brave", "bravo", "brawl", "brawn", "brays",
      "braze", "bread", "break", "breed", "brier", "brief", "brine", "bring", "brink", "brisk",
      "broad", "broil", "broke", "brood", "brook", "broom", "broth", "brown", "brows", "brush",
      "brusk", "brute", "bucks", "buddy", "budge", "buffs", "buggy", "bugle", "build", "built",
      "bulge", "bulgy", "bulks", "bulky", "bulls", "bully", "bumps", "bumpy", "bunch", "bunco",
      "bunds", "bungs", "bunks", "bunny", "bunts", "buoys", "burgs", "burly", "burns", "burnt",
      "burps", "burro", "burrs", "bursa", "burst", "busby", "bused", "buset", "bushy", "busks",
      "busts", "busty", "butch", "butts", "buxom", "buyer", "bylaw", "byres", "bytes", "byway",
      "cabal", "cabby", "cabin", "cable", "cacao", "cache", "cacti", "caddy", "cadet", "cadge",
      "cadre", "caged", "cages", "cagey", "cairn", "caked", "cakes", "calfs", "calix", "calks",
      "calla", "calls", "calms", "calve", "calyx", "camel", "cameo", "campo", "camps", "campy",
      "canal", "candy", "caned", "caner", "canes", "canny", "canoe", "canon", "caped", "caper",
      "capes", "capon", "capos", "caput", "carat", "carbs", "cards", "cared", "carer", "cares",
      "caret", "cargo", "carol", "carom", "carps", "carry", "carts", "carve", "casas", "cased",
      "cases", "casks", "caste", "casts", "catch", "cater", "catty", "caulk", "cause", "caved",
      "caver", "caves", "cavil", "cease", "cecal", "cecum", "cedar", "ceded", "cedes", "ceils",
      "cells", "cello", "cents", "chads", "chafe", "chaff", "chain", "chair", "chalk", "champ",
      "chant", "chaos", "chaps", "chapt", "charm", "chars", "chart", "chase", "chasm", "chats",
      "cheap", "cheat", "check", "cheek", "cheep", "cheer", "chefs", "chess", "chest", "chews",
      "chewy", "chick", "chide", "chief", "child", "chile", "chili", "chill", "chime", "chimp",
      "china", "chins", "chips", "chirp", "chock", "choir", "choke", "chops", "chord", "chore",
      "chose", "chows", "chuck", "chugs", "chump", "chums", "chunk", "churn", "chute", "cider",
      "cigar", "cilia", "cindy", "cinch", "circa", "cited", "cites", "civet", "civic", "civil",
      "clack", "claim", "clamp", "clams", "clang", "clank", "claps", "clash", "clasp", "class",
      "clave", "claws", "clays", "clean", "clear", "cleat", "cleft", "clerk", "click", "cliff",
      "climb", "clime", "cling", "clink", "clips", "clits", "cloak", "clods", "clogs", "clone",
      "close", "cloth", "cloud", "clout", "clove", "clown", "cloys", "cluck", "clued", "clues",
      "clump", "clung", "coach", "coals", "coast", "coati", "coats", "cobra", "cocks", "cocky",
      "cocoa", "codes", "codex", "codon", "coeds", "coils", "coins", "cokes", "colds", "coles",
      "colic", "colon", "color", "colts", "coma", "comas", "combo", "comes", "comet", "comfy",
      "comic", "comma", "conch", "condo", "cones", "conga", "congo", "conic", "conks", "cooch",
      "cooks", "cools", "coops", "coots", "coped", "copes", "copra", "copse", "coral", "cords",
      "cored", "corer", "cores", "corgi", "corks", "corns", "corny", "corps", "costa", "costs",
      "couch", "cough", "could", "count", "coupe", "coups", "court", "coven", "cover", "coves",
      "covet", "cowed", "cower", "cowls", "coxed", "coxes", "coyer", "coyly", "coypu", "crack",
      "craft", "crags", "cramp", "crams", "crane", "crank", "craps", "crash", "crass", "crate",
      "crave", "crawl", "craws", "craze", "crazy", "creak", "cream", "credo", "creed", "creek",
      "creel", "crema", "crepe", "crept", "cress", "crest", "crews", "cribs", "crick", "cried",
      "crier", "cries", "crime", "crimp", "crisp", "crits", "croak", "crock", "crocs", "croft",
      "crone", "crony", "crook", "crops", "cross", "croup", "crowd", "crown", "crows", "crude",
      "cruel", "cruet", "crumb", "crump", "crush", "crust", "crypt", "cubed", "cuber", "cubes",
      "cubic", "cuddy", "cuffs", "culms", "cults", "cumin", "cunts", "cupid", "curbs", "curds",
      "cured", "curer", "cures", "curio", "curls", "curly", "curry", "curse", "curve", "curvy",
      "cushy", "cuter", "cutie", "cutup", "cycle", "cynic", "cysts", "dacha", "daddy", "daffy",
      "daily", "dairy", "daisy", "dales", "dames", "damns", "damps", "dance", "dandy", "dared",
      "darer", "dares", "darks", "darns", "darts", "dashy", "dated", "dater", "dates", "datum",
      "daubs", "daunt", "dazed", "dazes", "deals", "dealt", "deans", "dears", "deary", "death",
      "debar", "debit", "debts", "debug", "debut", "decal", "decay", "decks", "decor", "decoy",
      "decry", "dedal", "deeds", "deems", "deeps", "defer", "defog", "defun", "deice", "deify",
      "deign", "deism", "deist", "delay", "deled", "deles", "delft", "delis", "dells", "delta",
      "delve", "demon", "demos", "demur", "denim", "dense", "dents", "depot", "depth", "derby",
      "detox", "deuce", "devil", "dewar", "dexter", "dhoti", "dials", "diary", "diced", "dicer",
      "dices", "dicey", "dicky", "dicta", "diets", "digit", "dikes", "dildo", "dills", "dilly",
      "dimer", "dimes", "dimly", "dinar", "dined", "diner", "dines", "dingo", "dings", "dingy",
      "dinky", "dinos", "diode", "dirge", "dirks", "dirty", "disco", "discs", "dishy", "disks",
      "ditch", "ditto", "ditty", "ditzy", "divan", "dived", "diver", "dives", "divot", "divvy",
      "dizzy", "djinn", "docks", "dodge", "dodgy", "doers", "doges", "doggy", "dogma", "doily",
      "doing", "dolls", "dolly", "domed", "domes", "donor", "donut", "dooms", "doors", "doped",
      "doper", "dopes", "dopey", "dosed", "doser", "doses", "doted", "doter", "dotes", "dotty",
      "doubt", "dough", "doula", "douse", "dowel", "downs", "downy", "dowry", "dozen", "dozes",
      "drabs", "drain", "drake", "drama", "drank", "drape", "drawl", "drawn", "draws", "drays",
      "dread", "dream", "drear", "dregs", "dress", "dried", "drier", "dries", "drift", "drill",
      "drink", "drips", "drive", "droll", "drone", "drool", "droop", "drops", "dross", "drove",
      "drown", "drubs", "drugs", "druid", "drums", "drunk", "dryad", "dryer", "dryly", "ducal",
      "ducat", "duces", "duchy", "ducks", "ducky", "ducts", "dudes", "duels", "duets", "duffs",
      "dummy", "dumps", "dumpy", "dunce", "dunes", "dungs", "dungy", "dunks", "duped", "duper",
      "dupes", "duple", "dural", "durst", "dusks", "dusky", "dusts", "dusty", "dutch", "duvet",
      "dwarf", "dwell", "dwelt", "dyads", "dying", "eager", "eagle", "eards", "earls", "early",
      "earns", "earth", "eased", "easel", "eases", "eaten", "eater", "eaves", "ebbed", "ebony",
      "echos", "edged", "edger", "edges", "edict", "edify", "edits", "eerie", "egged", "egret",
      "eider", "eight", "eject", "eking", "elate", "elbow", "elder", "elect", "elegy", "elfin",
      "elite", "elope", "elude", "elves", "email", "embed", "ember", "emcee", "empty", "enact",
      "ended", "ender", "endow", "enema", "enemy", "enjoy", "ennui", "ensue", "enter", "entry",
      "envoy", "eosin", "epact", "epees", "ephod", "epics", "epoch", "epoxy", "equal", "equip",
      "erase", "erect", "erode", "erred", "error", "erupt", "essay", "ester", "ether", "ethic",
      "ethos", "ethyl", "etude", "evade", "evens", "event", "every", "evict", "evils", "evoke",
      "exact", "exalt", "exams", "excel", "exert", "exile", "exist", "expel", "extol", "extra",
      "exude", "exult", "eying", "fable", "faced", "facer", "faces", "facet", "facts", "faded",
      "fader", "fades", "faery", "fagot", "fails", "faint", "faire", "fairy", "faith", "faked",
      "faker", "fakes", "falls", "false", "famed", "fancy", "fangs", "fanin", "fanny", "farce",
      "fared", "fares", "farms", "farts", "fasts", "fatal", "fated", "fates", "fatty", "fault",
      "fauna", "fauns", "favas", "faves", "favor", "fazed", "fazes", "fears", "feast", "feats",
      "fecal", "feces", "feeds", "feels", "feign", "feint", "fella", "fells", "felon", "felts",
      "femur", "fence", "fends", "feral", "feria", "ferns", "ferny", "ferry", "fetal", "fetch",
      "fetid", "fetus", "fever", "fewer", "fiber", "fibre", "fiche", "fichu", "ficus", "fiefs",
      "field", "fiend", "fiery", "fifth", "fifty", "fight", "filch", "filed", "filer", "files",
      "filet", "fills", "filly", "films", "filmy", "filth", "final", "finch", "finds", "fined",
      "finer", "fines", "finis", "finks", "finny", "fiord", "fired", "firer", "fires", "firma",
      "firms", "first", "fishy", "fists", "fitly", "fiver", "fives", "fixed", "fixer", "fixes",
      "fizzy", "fjord", "flack", "flags", "flail", "flair", "flake", "flaky", "flame", "flank",
      "flaps", "flare", "flash", "flask", "flats", "flaws", "flaxy", "flays", "fleas", "fleck",
      "fleer", "fleet", "flesh", "flick", "flied", "flier", "flies", "fling", "flint", "flips",
      "flirt", "float", "flock", "flops", "flora", "floss", "flour", "flout", "flown", "flows",
      "flubs", "flues", "fluff", "fluid", "fluke", "fluky", "flume", "flung", "flunk", "flush",
      "flute", "flyer", "foals", "foams", "foamy", "focal", "focus", "foggy", "foils", "foist",
      "folds", "folic", "folio", "folks", "folly", "fonts", "foods", "fools", "foots", "foray",
      "force", "fords", "forex", "forge", "forgo", "forks", "forms", "forte", "forth", "forts",
      "forty", "forum", "fossa", "fouls", "found", "fount", "fours", "fovea", "fowls", "foxed",
      "foxes", "foyer", "frack", "frail", "frame", "franc", "frank", "frats", "fraud", "fraus",
      "frays", "freak", "freed", "freer", "frees", "fresh", "frets", "friar", "fried", "frier",
      "fries", "frill", "frisk", "fritz", "frock", "frogs", "frond", "front", "froth", "frown",
      "froze", "fruit", "frump", "fryer", "fucks", "fudge", "fuels", "fugue", "fulls", "fully",
      "fumed", "fumes", "funds", "fungi", "funks", "funky", "funny", "furls", "furor", "furry",
      "furze", "fused", "fuses", "fussy", "fusty", "futon", "fuzed", "fuzes", "fuzzy", "gable",
      "gabby", "gaffs", "gaily", "gains", "gaits", "gales", "galls", "gamed", "gamer", "games",
      "gamma", "gangs", "gaped", "gapes", "garbs", "garde", "gashy", "gasps", "gassy", "gated",
      "gates", "gator", "gaudy", "gauge", "gaunt", "gauze", "gauzy", "gavel", "gawks", "gawky",
      "gayer", "gayly", "gazed", "gazer", "gazes", "gears", "gecko", "geeks", "geeky", "geese",
      "gelid", "genes", "genie", "genoa", "genre", "gents", "genus", "germs", "gesso", "getup",
      "ghost", "ghoul", "giant", "gibed", "gibes", "giddy", "gifts", "gilds", "gills", "gimme",
      "gimps", "gimpy", "ginny", "gipsy", "girds", "girls", "girly", "girth", "given", "giver",
      "gives", "gizmo", "glade", "glads", "gland", "glare", "glass", "glaze", "gleam", "glean",
      "glees", "glens", "glide", "glint", "glitz", "gloat", "globe", "globs", "gloom", "glory",
      "gloss", "glove", "glows", "glued", "glues", "gluey", "gluts", "gnash", "gnats", "gnaws",
      "gnome", "goals", "goats", "godly", "going", "golds", "golly", "gonad", "gongs", "gonna",
      "goods", "goody", "goofs", "goofy", "goons", "goony", "goose", "gored", "gores", "gorge",
      "gouge", "gourd", "gouty", "gowns", "grabs", "grace", "grade", "grads", "graft", "grail",
      "grain", "grams", "grand", "grant", "grape", "graph", "grasp", "grass", "grate", "grave",
      "gravy", "graze", "great", "greed", "green", "greet", "greys", "grids", "grief", "grill",
      "grime", "grimy", "grind", "grins", "gripe", "grips", "grist", "grits", "groan", "groin",
      "groom", "grope", "gross", "group", "grout", "grove", "growl", "grown", "grows", "grubs",
      "gruff", "grunt", "guano", "guard", "guava", "guess", "guest", "guide", "guild", "guile",
      "guilt", "guise", "gulch", "gulfs", "gulps", "gully", "gumbo", "gummy", "gunky", "gunny",
      "gurus", "gushy", "gusto", "gusts", "gusty", "gutsy", "gyros", "habit", "hacks", "hades",
      "hadst", "hafts", "haiku", "hails", "hairs", "hairy", "haled", "haler", "hales", "halls",
      "halos", "halts", "halve", "hands", "handy", "hangs", "hanks", "hanky", "hardy", "hared",
      "hares", "harks", "harms", "harps", "harry", "harsh", "harts", "hasps", "haste", "hasty",
      "hatch", "hated", "hater", "hates", "hauls", "haunt", "haven", "haves", "havoc", "hawed",
      "hawks", "hazel", "hazed", "hazes", "heads", "heady", "heals", "heaps", "heard", "hears",
      "heart", "heath", "heats", "heave", "heavy", "hedge", "heeds", "heels", "hefts", "hefty",
      "heigh", "heirs", "helix", "hello", "hells", "helps", "hemps", "hemp", "hence", "henna",
      "herbs", "herds", "heres", "heros", "hertz", "hewed", "hewer", "hiems", "hight", "hijab",
      "hiked", "hiker", "hikes", "hills", "hilly", "hilts", "hinge", "hints", "hippo", "hippy",
      "hired", "hirer", "hires", "hitch", "hived", "hives", "hoard", "hoary", "hobby", "hocks",
      "hogan", "hoist", "holds", "holly", "homed", "homer", "homes", "homey", "honda", "honed",
      "hones", "honey", "honks", "honor", "hoods", "hoody", "hooey", "hooks", "hoops", "hoots",
      "hoped", "hopes", "horde", "horns", "horny", "horse", "hosed", "hoses", "hosta", "hosts",
      "hotel", "hotly", "hound", "hours", "house", "hovel", "hover", "howdy", "howls", "huber",
      "huffs", "huffy", "hulks", "hulky", "hulls", "human", "humid", "humor", "humph", "humps",
      "humus", "hunch", "hunks", "hunky", "hunts", "hurds", "hurls", "hurry", "hurts", "husky",
      "hussy", "hutch", "hydra", "hydro", "hyena", "hymen", "hymns", "hyped", "hypes", "hyper",
      "iambs", "icily", "icing", "icons", "ideal", "ideas", "idiom", "idiot", "idler", "idles",
      "idols", "idyll", "igloo", "ikats", "ikons", "ileum", "iliac", "image", "imago", "imams",
      "imbed", "imbue", "impel", "imply", "inane", "inapt", "inbox", "incur", "index", "inept",
      "inert", "infer", "ingot", "inlay", "inlet", "inner", "input", "inset", "inter", "intro",
      "ionic", "irate", "irked", "irons", "irony", "isles", "islet", "issue", "itchy", "items",
      "ivies", "ivory", "jabot", "jacks", "jaded", "jades", "jails", "jambs", "jammy", "janes",
      "japan", "japed", "japer", "japes", "jares", "jarry", "jaunt", "jawed", "jazzy", "jeans",
      "jeeps", "jeers", "jello", "jells", "jelly", "jerks", "jerky", "jests", "jetty", "jewel",
      "jibed", "jibes", "jiffy", "jihad", "jilts", "jimmy", "jingo", "jinks", "jinni", "jinns",
      "jived", "jives", "jocks", "joeys", "johns", "joins", "joint", "joist", "joked", "joker",
      "jokes", "jolly", "jolts", "joule", "joust", "jowls", "jowly", "judge", "judos", "jugal",
      "juice", "juicy", "jujus", "juked", "jukes", "jumbo", "jumps", "jumpy", "junks", "junky",
      "junta", "junto", "juror", "karma", "kayak", "kazoo", "kebab", "kebob", "keels", "keens",
      "keeps", "ketch", "keyed", "khaki", "khans", "kicks", "kicky", "kiddo", "kiddy", "kievs",
      "kills", "kilns", "kilos", "kilts", "kinch", "kinds", "kings", "kinks", "kinky", "kiosk",
      "kited", "kites", "kitty", "kiwis", "knack", "knave", "knead", "kneed", "kneel", "knelt",
      "knife", "knish", "knits", "knobs", "knock", "knots", "known", "knows", "koala", "kooks",
      "kooky", "kopek", "krill", "kudos", "kudzu", "label", "labia", "labor", "laced", "lacer",
      "laces", "lacks", "ladle", "lager", "laird", "lairs", "laity", "lakes", "lamas", "lambs",
      "lamed", "lamer", "lames", "lamps", "lands", "lanes", "lanky", "lapel", "lapse", "larch",
      "lards", "lardy", "large", "larks", "larva", "lased", "laser", "lases", "lasso", "lasts",
      "latch", "lated", "laten", "later", "latex", "lathe", "laths", "lathy", "laund", "laure",
      "lavas", "laved", "laver", "laves", "lawns", "laxer", "laxly", "layby", "layer", "layup",
      "lazed", "lazes", "leach", "leads", "leafs", "leafy", "leaks", "leaky", "leans", "leant",
      "leaps", "leapt", "learn", "lease", "leash", "least", "leave", "ledge", "leech", "leeks",
      "leers", "leery", "lefts", "lefty", "legal", "leggy", "legit", "lemon", "lemur", "lends",
      "lensr", "lento", "leper", "lesio", "letup", "levee", "level", "lever", "liars", "libel",
      "licks", "lidos", "liege", "liens", "lifts", "light", "liked", "liken", "liker", "likes",
      "lilac", "lilts", "limbo", "limbs", "limby", "limed", "limes", "limey", "limit", "limns",
      "limos", "limps", "lined", "linen", "liner", "lines", "lingo", "lings", "lingy", "links",
      "lints", "linty", "lions", "lipid", "lippy", "liras", "lisps", "lists", "liter", "lithe",
      "laths", "lived", "liven", "liver", "lives", "livid", "llama", "loads", "loafs", "loamy",
      "loans", "loath", "lobby", "lobed", "lobes", "local", "locks", "locus", "lodge", "lofts",
      "lofty", "logic", "login", "logos", "loins", "lolls", "lolly", "loner", "longs", "looks",
      "looms", "loons", "loony", "loops", "loopy", "loose", "loots", "loped", "lopes", "lords",
      "lorry", "loser", "loses", "lossy", "lotsa", "lotus", "louis", "louse", "lousy", "louts",
      "loved", "lover", "loves", "lowed", "lower", "lowly", "loyal", "lucid", "lucky", "lulls",
      "lumen", "lumps", "lumpy", "lunar", "lunch", "lunge", "lungs", "lurch", "lured", "lures",
      "lurid", "lusts", "lusty", "luted", "lutes", "luxor", "lying", "lymph", "lynch", "lyres",
      "lyric", "macaw", "macho", "macro", "madam", "madly", "mafia", "magic", "magma", "maids",
      "mails", "maims", "mains", "maize", "major", "maker", "makes", "males", "malls", "malts",
      "malty", "mamas", "mambo", "mamma", "manes", "mange", "mango", "mangy", "mania", "manic",
      "manly", "manna", "manor", "manse", "maple", "march", "mares", "margs", "maria", "marks",
      "marry", "marsh", "marts", "maser", "mashy", "masks", "mason", "masts", "match", "mated",
      "mater", "mates", "maths", "matte", "matzo", "mauls", "mauve", "maven", "maxed", "maxes",
      "maxim", "maybe", "mayor", "mazed", "mazes", "meals", "mealy", "means", "meant", "meats",
      "meaty", "mecca", "medal", "media", "medic", "meets", "melee", "melon", "melt", "mends",
      "menus", "meows", "mercy", "merer", "meres", "merge", "merit", "merry", "messy", "metal",
      "meted", "meter", "metes", "meths", "metre", "metro", "mewed", "mewls", "miasm", "micas",
      "midst", "might", "mikes", "milch", "milds", "miles", "milks", "milky", "mills", "mimed",
      "mimer", "mimes", "mimic", "mince", "minds", "mined", "miner", "mines", "minim", "minis",
      "minks", "minor", "minty", "minus", "mired", "mires", "mirth", "miser", "missy", "mists",
      "misty", "mites", "mitre", "mitts", "mixed", "mixer", "mixes", "mixup", "moans", "moats",
      "mocha", "mocks", "modal", "model", "modem", "modes", "mogul", "moist", "molar", "molds",
      "moldy", "moles", "molls", "molly", "molts", "money", "monks", "month", "mooch", "moods",
      "moody", "moons", "moors", "moose", "moots", "moped", "mopes", "moral", "moray", "morel",
      "mores", "morns", "morph", "mossy", "motel", "motes", "moths", "mothy", "motif", "motor",
      "motto", "mould", "moult", "mount", "mourn", "mouse", "mousy", "mouth", "moved", "mover",
      "moves", "movie", "mowed", "mower", "mucks", "mucky", "mucus", "muddy", "muggy", "mulch",
      "mulct", "mules", "mulls", "mumbo", "mumps", "munch", "munts", "mural", "murky", "mused",
      "muses", "mushy", "music", "musks", "musky", "mussy", "musts", "musty", "mutts", "myrrh",
      "nabob", "nacho", "nacre", "nadir", "nails", "naive", "naked", "named", "namer", "names",
      "nanny", "napes", "nappy", "nasal", "nasty", "natal", "naval", "navel", "naves", "necks",
      "needs", "needy", "neigh", "nelly", "nerds", "nerdy", "nerve", "nervy", "nests", "never",
      "newel", "newer", "newly", "newsy", "newts", "niche", "nicks", "niece", "night", "nimbi",
      "nines", "ninja", "ninny", "ninth", "nippy", "nisei", "niter", "nites", "nitro", "nixed",
      "nixes", "noble", "nobly", "nodal", "noddy", "nodes", "noels", "nohow", "noise", "noisy",
      "nomad", "nonce", "nones", "nonny", "noose", "norms", "north", "nosed", "noses", "nosey",
      "notch", "noted", "notes", "nouns", "novel", "nudes", "nudge", "nulls", "numbs", "nurse",
      "nutty", "nylon", "nymph", "oaken", "oases", "oasis", "oaten", "oaths", "obese", "obeys",
      "obits", "oboes", "occur", "ocean", "ocher", "ochre", "octal", "octet", "odder", "oddly",
      "odium", "odors", "offal", "offed", "offer", "often", "ogled", "ogles", "ogres", "oiled",
      "oinks", "okapi", "okays", "older", "oldie", "oleic", "olios", "olive", "omens", "omits",
      "oncet", "onset", "onium", "onkus", "oohed", "ooped", "opals", "opens", "opera", "opine",
      "opium", "opted", "optic", "orals", "orate", "orbit", "order", "organ", "osier", "other",
      "otter", "ought", "ounce", "outed", "outer", "outdo", "outgo", "outre", "ouzel", "ovals",
      "ovary", "ovate", "overs", "overt", "oxide", "oxids", "oxime", "oxims", "oxlip", "owner",
      "owing", "owlet", "owned", "owres", "ozone", "paced", "pacer", "paces", "packs", "pacts",
      "paddy", "pagan", "paged", "pager", "pages", "pains", "paint", "pairs", "paled", "paler",
      "pales", "palms", "palmy", "palsy", "panda", "panel", "panes", "pangs", "panic", "pants",
      "papal", "papas", "paper", "parch", "pared", "parer", "pares", "parka", "parks", "parry",
      "parse", "parts", "party", "pasha", "pasta", "paste", "pasty", "patch", "patel", "pated",
      "paten", "pater", "pates", "paths", "patio", "patsy", "patty", "pauls", "pause", "paved",
      "paves", "pawed", "pawns", "peace", "peach", "peaks", "peaky", "peals", "pearl", "pears",
      "pecan", "pecks", "pedal", "peeks", "peels", "peeps", "peers", "peeve", "peggy", "peins",
      "pekan", "pekes", "pelts", "penal", "pence", "pends", "penis", "penny", "peons", "peony",
      "perch", "peril", "perks", "perky", "perms", "pesky", "pests", "petal", "peter", "petty",
      "phase", "phial", "phone", "phony", "photo", "phyla", "piano", "picks", "picky", "piece",
      "piers", "piety", "piggy", "piked", "piker", "pikes", "pilaf", "piled", "piles", "pills",
      "pilot", "pimps", "pinch", "pined", "pines", "pings", "pinko", "pinks", "pinky", "pinot",
      "pinup", "pious", "piped", "piper", "pipes", "pique", "pitch", "piths", "pithy", "pivot",
      "pixel", "pixie", "pizza", "place", "plaid", "plain", "plait", "plane", "plank", "plans",
      "plant", "plate", "plats", "playa", "plays", "plead", "pleas", "pleat", "plied", "plier",
      "plies", "plink", "plods", "plops", "plots", "plows", "pluck", "plugs", "plumb", "plume",
      "plump", "plums", "plunk", "plush", "poach", "podgy", "poesy", "poets", "point", "poise",
      "poked", "poker", "pokes", "polar", "poled", "poles", "polio", "polis", "polka", "polls",
      "polyp", "ponds", "pones", "pooch", "pools", "poops", "popes", "poppy", "porch", "pored",
      "pores", "ports", "posed", "poser", "poses", "posit", "posts", "potty", "pouch", "pound",
      "pours", "pouts", "power", "prams", "prank", "prate", "prats", "prawn", "prays", "preen",
      "preps", "press", "preys", "price", "prick", "pride", "pried", "pries", "prime", "prims",
      "print", "prior", "prism", "privy", "prize", "probe", "prods", "prof", "promo", "proms",
      "prone", "prong", "proof", "props", "prose", "proud", "prove", "prowl", "prows", "proxy",
      "prude", "prune", "psalm", "psion", "psoas", "psych", "pubic", "pubis", "pucks", "pudgy",
      "puffs", "puffy", "pulpy", "pulse", "pumas", "punch", "punks", "punky", "punny", "punts",
      "puree", "purge", "purls", "purse", "pushy", "putts", "pygmy", "pylon", "qiana", "quack",
      "quads", "quail", "quake", "qualm", "quark", "quart", "quash", "quasi", "quays", "query",
      "quell", "quern", "queue", "quick", "quids", "quiet", "quiff", "quill", "quilt", "quint",
      "quips", "quire", "quirk", "quite", "quits", "quoth", "quota", "quote", "rabid", "raced",
      "racer", "races", "racks", "racy", "radix", "rafts", "raged", "rages", "raids", "rails",
      "rains", "rainy", "raise", "rajah", "raked", "rakes", "rally", "ramps", "ranch", "randy",
      "range", "rangy", "ranks", "rants", "raped", "raper", "rapes", "rapid", "rarer", "raspy",
      "rates", "ratio", "ratty", "raved", "ravel", "raven", "raver", "raves", "rawer", "rawly",
      "rayed", "razed", "razes", "reach", "react", "reads", "ready", "reafs", "realm", "reams",
      "reaps", "rearm", "rebel", "rebus", "rebut", "recap", "recks", "recon", "recut", "reddo",
      "redds", "reddy", "redid", "redip", "redly", "redye", "reeds", "reef", "reels", "refer",
      "refit", "regal", "reges", "regma", "regna", "rehab", "reify", "reign", "reins", "reish",
      "rekey", "relax", "relay", "relet", "relic", "relit", "remap", "remit", "remix", "renal",
      "rends", "renew", "rente", "repay", "repel", "reply", "repro", "rerun", "resaw", "resay",
      "reset", "resew", "resin", "rests", "retag", "retch", "retie", "retro", "retry", "reuse",
      "revel", "revue", "rewed", "rewet", "rewin", "rexes", "rhino", "rhone", "rhumb", "rhyme",
      "rials", "ribby", "ricer", "rices", "ricks", "rider", "rides", "ridge", "ridgy", "rifer",
      "riffs", "rifle", "rifts", "right", "rigid", "rigor", "riled", "riles", "rille", "rills",
      "rimed", "rimes", "rinds", "rings", "rinks", "rinse", "riots", "ripen", "riper", "risen",
      "riser", "rises", "risky", "rites", "ritzy", "rival", "river", "rivet", "roach", "roads",
      "roams", "roans", "roars", "roast", "robed", "robes", "robin", "robot", "rocks", "rocky",
      "rodeo", "roger", "rogue", "roils", "roily", "roles", "rolls", "romps", "rondo", "roods",
      "roofs", "rooks", "roomy", "roost", "roots", "roped", "roper", "ropes", "rosal", "rosed",
      "roses", "rosin", "rotor", "rouge", "rough", "round", "rouse", "route", "routs", "roved",
      "rover", "roves", "rowan", "rowdy", "rowed", "rowel", "rower", "rowls", "royal", "royce",
      "rubes", "ruble", "rubus", "ruche", "ruder", "ruddy", "rudie", "rugby", "ruing", "ruins",
      "ruled", "ruler", "rules", "rumps", "rummy", "rumor", "runes", "rungs", "runny", "runts",
      "runty", "rupee", "rural", "ruses", "rushy", "rusts", "rusty", "rutan", "rutty", "saber",
      "sable", "sacks", "sadly", "safer", "safes", "sagas", "sager", "sages", "sahib", "sails",
      "saint", "saith", "sakes", "salad", "sales", "sally", "salmo", "salol", "salon", "salsa",
      "salts", "salty", "salve", "salvo", "samba", "sands", "sandy", "saner", "sappy", "sarge",
      "sarin", "saris", "sassy", "satay", "sated", "sates", "satin", "satyr", "sauce", "saucy",
      "sauna", "saved", "saver", "saves", "savor", "savoy", "savvy", "sawed", "saxes", "scads",
      "scald", "scale", "scamp", "scans", "scant", "scare", "scarf", "scarp", "scars", "scary",
      "scats", "scene", "scent", "schmo", "schwa", "scion", "scoff", "scold", "scone", "scoop",
      "scope", "score", "scorn", "scots", "scour", "scout", "scowl", "scows", "scram", "scrap",
      "scree", "screw", "scrub", "scuba", "scull", "scums", "scurf", "seals", "seams", "seamy",
      "seats", "sebum", "sedan", "seder", "sedge", "seeds", "seedy", "seeks", "seems", "seeps",
      "seepy", "seers", "segno", "segue", "seize", "sells", "sends", "sense", "sepia", "serif",
      "serum", "serve", "setae", "seton", "setup", "seven", "sever", "sewed", "sewer", "sexed",
      "sexes", "shack", "shade", "shady", "shaft", "shake", "shaky", "shale", "shall", "shalt",
      "shame", "shank", "shape", "shard", "share", "shark", "sharp", "shave", "shawl", "sheaf",
      "shear", "sheen", "sheep", "sheer", "sheet", "sheik", "shelf", "shell", "shift", "shill",
      "shims", "shine", "shins", "shiny", "ships", "shire", "shirk", "shoal", "shock", "shoes",
      "shone", "shook", "shoos", "shoot", "shops", "shore", "shorn", "short", "shots", "shout",
      "shove", "shown", "shows", "shrew", "shrub", "shrug", "shuck", "shunt", "shush", "shuts",
      "shyly", "sibyl", "sided", "sides", "siege", "sifts", "sighs", "sight", "sigma", "signs",
      "silas", "silks", "silky", "sills", "silly", "silts", "silty", "since", "sined", "sines",
      "sinew", "singe", "sings", "sinks", "sinus", "sired", "siren", "sires", "sissy", "sitar",
      "sited", "sites", "sixes", "sixth", "sixty", "sized", "sizer", "sizes", "skald", "skate",
      "skeet", "skews", "skids", "skiff", "skill", "skimp", "skims", "skins", "skips", "skirt",
      "skits", "skulk", "skull", "skunk", "slabs", "slack", "slags", "slain", "slake", "slams",
      "slang", "slant", "slaps", "slash", "slate", "slats", "slave", "slavs", "slays", "sleds",
      "sleek", "sleep", "sleet", "slept", "slice", "licks", "slide", "slims", "sling", "slink",
      "slips", "slits", "slobs", "sloes", "slogs", "slomo", "slosh", "sloth", "slots", "slows",
      "slosh", "slues", "slugs", "slump", "slums", "slung", "slunk", "slurp", "slurs", "smack",
      "small", "smart", "smash", "smear", "smell", "smelt", "smile", "smirk", "smite", "smock",
      "smoke", "smoky", "smolt", "smote", "smuts", "snack", "snafu", "snags", "snail", "snake",
      "snaky", "snaps", "snare", "snarf", "snarl", "snash", "sniff", "snipe", "snips", "snits",
      "snobs", "snooz", "snore", "snort", "snots", "snout", "snows", "snowy", "snubs", "snuck",
      "snuff", "soaks", "soaps", "soapy", "soars", "sober", "socks", "sodas", "sofas", "softs",
      "soft", "soggy", "soils", "solar", "soled", "soles", "solid", "solon", "solve", "songs",
      "sonic", "sonny", "sooth", "sooty", "sores", "sorry", "sorts", "souls", "sound", "soups",
      "soupy", "sours", "souse", "south", "sowed", "sower", "space", "spade", "spank", "spans",
      "spare", "spark", "spars", "spasm", "spats", "spawn", "spays", "speak", "spear", "specs",
      "speck", "speed", "spell", "spelt", "spend", "spent", "sperm", "spice", "spicy", "spied",
      "spiel", "spier", "spies", "spiff", "spike", "spiky", "spill", "spilt", "spine", "spins",
      "spiny", "spire", "spirt", "spits", "spitz", "splat", "splay", "split", "spoil", "spoke",
      "spoof", "spook", "spool", "spoon", "spoor", "spots", "spout", "sprat", "splay", "spray",
      "spree", "sprig", "sprit", "sprog", "spuds", "spume", "spumy", "spunk", "spurn", "spurs",
      "squab", "squad", "squat", "squid", "stabs", "stack", "staff", "stage", "stags", "staid",
      "stain", "stair", "stake", "stale", "stalk", "stall", "stamp", "stand", "stank", "stare",
      "stark", "start", "stash", "state", "stats", "stave", "stays", "stead", "steak", "steal",
      "steam", "steed", "steel", "steep", "steer", "stems", "steps", "stern", "stews", "stick",
      "stiff", "stile", "still", "stilt", "sting", "stink", "stint", "stipe", "stirs", "stoic",
      "stoke", "stole", "stoma", "stomp", "stone", "stony", "stood", "stool", "stoop", "store",
      "stork", "storm", "story", "stout", "stove", "strap", "straw", "stray", "strep", "strew",
      "strip", "strop", "strum", "strut", "stubs", "stuck", "studs", "study", "stuff", "stump",
      "stung", "stunk", "stuns", "stunt", "styes", "style", "styli", "suave", "sucks", "sudsy",
      "suede", "sugar", "suing", "suite", "suits", "sulky", "sully", "sumac", "summa", "sumps",
      "sunny", "sunup", "super", "supra", "surely", "surfs", "surge", "surly", "sushi", "swabs",
      "swage", "swags", "swail", "swain", "swami", "swamp", "swank", "swans", "swaps", "sward",
      "swarm", "swash", "swath", "swats", "sways", "swear", "sweat", "sweep", "sweet", "swell",
      "swept", "swift", "swigs", "swill", "swims", "swine", "swirl", "swish", "swiss", "swive",
      "swoon", "swoop", "swops", "sword", "swore", "sworn", "swung", "sykes", "sylph", "synch",
      "syncs", "synod", "syrup", "tabby", "table", "taboo", "tabor", "tabun", "tacet", "tachs",
      "tacky", "tacos", "tacti", "tacts", "taffy", "tails", "taint", "tally", "talon", "tamed",
      "tamer", "tames", "tamps", "tanga", "tango", "tangs", "tangy", "tanks", "tansy", "tapes",
      "taper", "tardy", "tared", "tares", "tarry", "tarts", "tased", "taser", "tasks", "taste",
      "tasty", "tater", "tatty", "taunt", "taupe", "tawny", "taxed", "taxes", "teach", "teals",
      "teams", "tears", "teary", "tease", "teats", "techy", "teddy", "teems", "teens", "teeny",
      "teeth", "telex", "tells", "tellt", "tempi", "tempo", "temps", "tempt", "tench", "tends",
      "tenet", "tenon", "tenor", "tense", "tenth", "tents", "terms", "terns", "terra", "terry",
      "tests", "testy", "tetch", "tetra", "texas", "texts", "thack", "thair", "thali", "thane",
      "thank", "thanx", "tharm", "thatd", "thats", "thaws", "theft", "their", "theme", "thens",
      "there", "therm", "these", "thesp", "theta", "thiam", "thick", "thief", "thigh", "thill",
      "thine", "thing", "think", "third", "thirl", "thong", "thorn", "those", "thous", "thrax",
      "thrum", "thuds", "thugs", "thuja", "thumb", "thump", "thunk", "thurl", "thurs", "thyme",
      "tiara", "tibia", "tical", "ticks", "tidal", "tided", "tides", "tiers", "tiffs", "tiger",
      "tight", "tikes", "tilts", "timed", "timer", "times", "timid", "tined", "tines", "tinge",
      "tings", "tinny", "tints", "tipsy", "tired", "tires", "titan", "titer", "tithe", "title",
      "titsy", "tizzy", "toads", "toady", "toast", "today", "toddy", "toeas", "toffs", "toffy",
      "togae", "togas", "toile", "toils", "toked", "token", "tokes", "tolls", "tolls", "tolst",
      "tombs", "tomes", "tonal", "toned", "toner", "tones", "tongs", "tonic", "tonne", "tools",
      "tooth", "toots", "topaz", "topes", "topos", "toque", "torah", "torch", "tores", "toric",
      "torns", "torso", "torte", "torts", "torus", "total", "toted", "totes", "totem", "touch",
      "tough", "tours", "touts", "towed", "towel", "tower", "towns", "toxic", "toxin", "toyed",
      "trace", "track", "tract", "trade", "trail", "train", "trait", "trams", "tramp", "trans",
      "traps", "trash", "trawl", "trays", "tread", "treat", "treed", "trees", "treks", "trend",
      "tress", "trews", "triac", "triad", "trial", "tribe", "trice", "trick", "tried", "tries",
      "trike", "trill", "trims", "trios", "tripe", "trips", "trite", "troll", "tromp", "trona",
      "troop", "trope", "troth", "trout", "trove", "truce", "truck", "trued", "truer", "trues",
      "truly", "trump", "trunk", "truss", "trust", "truth", "tryst", "tuber", "tubes", "tucks",
      "tufas", "tufts", "tulip", "tulle", "tummy", "tunas", "tuned", "tuner", "tunes", "tungs",
      "turbo", "turds", "turns", "tusks", "tutor", "twain", "twang", "tweak", "tweed", "tween",
      "tweet", "twerp", "twice", "twigs", "twill", "twine", "twins", "twirl", "twist", "twits",
      "tying", "tykes", "typed", "types", "typos", "tyred", "tyres", "tyros", "udder", "ulcer",
      "ulnae", "ulnas", "ultra", "umbel", "umber", "umbra", "umiak", "umped", "umpty", "unapt",
      "unarm", "unary", "unban", "unbar", "unbox", "uncap", "uncut", "under", "undid", "undue",
      "unfed", "unfit", "unfix", "unhip", "unhit", "unhot", "union", "unite", "units", "unity",
      "unjam", "unked", "unled", "unlet", "unlit", "unman", "unmet", "unmew", "unmix", "unpeg",
      "unpen", "unpin", "unrig", "unrip", "unsay", "unsee", "unset", "unsew", "unsod", "untie",
      "until", "unwed", "unwet", "unwit", "unwon", "unzip", "upend", "upful", "upped", "upset",
      "urban", "ureas", "urged", "urges", "urine", "usage", "users", "usher", "using", "usual",
      "usurp", "usury", "uteri", "utile", "utter", "uveal", "uvula", "vacua", "vague", "vales",
      "valet", "valid", "valor", "value", "valve", "vamps", "vaned", "vanes", "vangs", "vaped",
      "vapes", "vapid", "vapor", "varia", "varie", "vases", "vasts", "vasty", "vatic", "vault",
      "vaunt", "veals", "veins", "velar", "velds", "veldt", "velum", "venal", "vends", "venin",
      "venom", "vents", "venue", "verbs", "verde", "verge", "verse", "verts", "vesta", "vests",
      "vetch", "vetos", "vexed", "vexer", "vexes", "vials", "viand", "vibes", "vicar", "viced",
      "vices", "video", "viers", "views", "vigil", "vigor", "viled", "viles", "villa", "villi",
      "vines", "vinos", "vinyl", "viola", "viols", "viper", "viral", "vireo", "vires", "virgo",
      "virtu", "virus", "visas", "vised", "vises", "visit", "visor", "vista", "vital", "vivas",
      "vivid", "vixen", "vocab", "vocal", "vodka", "vogue", "voice", "voids", "voile", "voles",
      "volta", "volts", "volva", "vomed", "vomer", "vomit", "voted", "voter", "votes", "vouch",
      "vowed", "vowel", "vulva", "vying", "wacko", "wacks", "wacky", "waded", "wader", "wades",
      "wafer", "waged", "wager", "wages", "wagon", "wahoo", "waifs", "wails", "waist", "waits",
      "waive", "waked", "waken", "wakes", "walks", "walls", "wally", "waltz", "wands", "waned",
      "wanes", "wanly", "wanna", "wants", "wards", "wareh", "wares", "warms", "warns", "warps",
      "warts", "warty", "washy", "wasps", "waste", "watch", "water", "watts", "waved", "waver",
      "waves", "waxed", "waxen", "waxes", "weans", "wears", "weary", "weave", "webby", "weber",
      "wedge", "weeds", "weedy", "weeks", "weeps", "weepy", "wefts", "weigh", "weird", "welds",
      "wells", "welsh", "welts", "wench", "wends", "wetly", "whack", "whale", "wham", "whams",
      "wharf", "whats", "wheal", "wheat", "wheel", "whelk", "whelm", "whelp", "whenc", "where",
      "whens", "whet", "whews", "wheys", "which", "whiff", "whigs", "while", "whims", "whine",
      "whiny", "whips", "whirl", "whirr", "whish", "whisk", "whist", "white", "whits", "whole",
      "whomp", "whoop", "whops", "whore", "whorl", "whose", "whoso", "wicks", "widen", "wider",
      "wides", "widow", "width", "wield", "wifey", "wight", "wilds", "wiles", "wills", "willy",
      "wilts", "wimps", "wimpy", "wince", "winch", "winds", "windy", "wined", "wines", "wings",
      "winks", "winos", "wiped", "wiper", "wipes", "wired", "wires", "wiser", "wises", "wisps",
      "wispy", "witch", "witen", "withs", "witly", "witty", "wives", "woken", "wolfs", "woman",
      "wombs", "women", "womyn", "wonks", "wonky", "woods", "woody", "wooed", "woofs", "wools",
      "wooly", "woozy", "words", "wordy", "works", "world", "worms", "wormy", "worry", "worse",
      "worst", "worth", "worts", "would", "wound", "woven", "wowed", "wraps", "wrath", "wreak",
      "wreck", "wrens", "wrest", "wrier", "wring", "wrist", "write", "writs", "wrong", "wrote",
      "wroth", "wrung", "wryly", "xebec", "xenia", "xenon", "xerox", "xylem", "yacht", "yacks",
      "yahoo", "yakka", "yanks", "yards", "yarns", "yawed", "yawls", "yawns", "yeahs", "years",
      "yearn", "yeast", "yells", "yelps", "yenta", "yeses", "yetis", "yield", "yipes", "yocks",
      "yodel", "yogis", "yoked", "yokes", "yolks", "young", "yours", "youth", "yowls", "yukon",
      "yules", "zappy", "zeals", "zebra", "zebus", "zeros", "zests", "zesty", "zilch", "zincs",
      "zinco", "zings", "zingy", "zonal", "zoned", "zones", "zooms", "zulus"
    ].concat(targetWords).filter((v, i, a) => a.indexOf(v) === i); // Combine and ensure unique

    function initWordle(){
      wordleState = {
        target: targetWords[Math.floor(Math.random()*targetWords.length)].toUpperCase(),
        row:0, col:0,
        board: Array.from({length:6}, ()=> Array(5).fill('')),
        result: Array.from({length:6}, ()=> Array(5).fill('')),
        gameOver:false
      };
      // Clear the grid completely before initial render to ensure fresh start
      document.getElementById('boardGrid').innerHTML = '';
      renderWordle(); // This will create the initial empty cells
      initKeyboard();
      document.getElementById('wordleMsg').textContent = '';
    }

    function renderWordle(){
      const grid = document.getElementById('boardGrid');
      for(let r=0;r<6;r++){
        for(let c=0;c<5;c++){
          let cell = grid.children[r * 5 + c];
          if (!cell) { // Create cells if they don't exist (first render)
            cell = document.createElement('div');
            cell.className = 'cell';
            grid.appendChild(cell);
          }

          const currentLetter = wordleState.board[r][c] || '';
          const currentResult = wordleState.result[r][c];

          // Immediately update content
          cell.textContent = currentLetter;

          // Clear previous animation/result classes to avoid conflicts for current cell
          cell.classList.remove('pop', 'correct', 'present', 'absent', 'flip-in', 'flip-out');
          cell.style.animationDelay = ''; // Clear delays

          // Only apply styles for *previous* rows, not the one currently being typed
          if (r < wordleState.row && currentResult) {
            cell.classList.add(currentResult);
          } else if (r === wordleState.row && currentLetter) {
            // Typing in current row: apply pop animation
            cell.classList.add('pop');
            // Remove pop after animation to be ready for next pop
            setTimeout(() => cell.classList.remove('pop'), 100);
          }
        }
      }
    }

    function initKeyboard(){
      const keys = "QWERTYUIOP ASDFGHJKL ZXCVBNM".split(' ');
      const area = document.getElementById('keyboardArea');
      area.innerHTML = '';
      keys.forEach(row => {
        const rowDiv = document.createElement('div');
        row.split('').forEach(k=>{
          const b = document.createElement('div');
          b.className='kbd-btn';
          b.textContent = k;
          b.dataset.key = k; // Add data-key for easier lookup
          b.addEventListener('click', ()=> onKey(k));
          rowDiv.appendChild(b);
        });
        area.appendChild(rowDiv);
      });
      // add enter and backspace
      const opRow = document.createElement('div');
      const enter = document.createElement('div'); enter.className='kbd-btn big'; enter.textContent=getTranslation('wordleEnterBtn'); // Use translated text
      enter.dataset.key = 'Enter'; // Add data-key
      const back = document.createElement('div'); back.className='kbd-btn big'; back.textContent=getTranslation('wordleBackBtn'); // Use translated text
      back.dataset.key = 'Back'; // Add data-key
      enter.addEventListener('click', ()=> onKey('Enter'));
      back.addEventListener('click', ()=> onKey('Back'));
      opRow.appendChild(enter); opRow.appendChild(back);
      area.appendChild(opRow);

      // keyboard events
      
      // Ensure keyboard buttons are translated immediately after creation
      applyTranslations();
    }

    function onKey(key){
      if(wordleState.gameOver) return;
      document.getElementById('wordleMsg').textContent = ''; // Clear message on new input

      if(key === 'Back'){
        if(wordleState.col>0){
          wordleState.col--;
          wordleState.board[wordleState.row][wordleState.col]='';
          renderWordle();
        }
        return;
      }
      if(key === 'Enter'){
        const guess = wordleState.board[wordleState.row].join('');
        if(guess.length < 5) { showWordleMsg(getTranslation('wordleMsg5Letters')); return; }

        if (!validGuesses.includes(guess.toLowerCase())) {
          showWordleMsg(getTranslation('wordleMsgInvalidWord'));
          document.getElementById('boardGrid').classList.add('row-shake');
          setTimeout(() => {
            document.getElementById('boardGrid').classList.remove('row-shake');
          }, 400);
          return;
        }

        const target = wordleState.target;
        const res = Array(5).fill('absent');
        const tarr = target.split('');

        // First pass for correct
        for(let i=0;i<5;i++){
          if(guess[i] === tarr[i]){ res[i]='correct'; tarr[i]=null; }
        }
        // Second pass for present
        for(let i=0;i<5;i++){
          if(res[i]==='correct') continue;
          const idx = tarr.indexOf(guess[i]);
          if(idx>=0){ res[i]='present'; tarr[idx]=null; }
        }
        wordleState.result[wordleState.row] = res;

        // Animate the current row's cells with flip
        const currentRowCells = [];
        for (let c = 0; c < 5; c++) {
            currentRowCells.push(document.getElementById('boardGrid').children[wordleState.row * 5 + c]);
        }

        currentRowCells.forEach((cell, index) => {
            cell.style.animationDelay = `${index * 0.1}s`;
            cell.classList.add('flip-in'); // Start flip-in
            setTimeout(() => {
                cell.classList.remove('flip-in');
                cell.classList.add('flip-out'); // Start flip-out
                cell.classList.add(res[index]); // Apply color result
            }, index * 100 + 150); // Mid-flip point
            setTimeout(() => {
                cell.classList.remove('flip-out'); // Clean up after animation
                cell.style.animationDelay = ''; // Clear delay
            }, index * 100 + 600); // After flip-out completes
        });


        setTimeout(() => { // Delay win/lose message and state update until *all* animations finish
          if(res.every(x=>x==='correct')){
            showWordleMsg(getTranslation('wordleMsgWin'));
            wordleState.gameOver = true;
          } else if(wordleState.row >= 5){ // Check if this was the last guess (0-indexed row 5 is 6th guess)
            wordleState.gameOver = true;
            showWordleMsg(getTranslation('wordleMsgLose') + wordleState.target);
          }
          // Only increment row and reset col if game is not over and it's a valid guess
          if (!wordleState.gameOver) {
            wordleState.row++;
            wordleState.col = 0;
            // No need to call renderWordle here, as the animation process correctly updates the cells
            // for the current row. New cells for the next row will be blank.
            // If any visual glitch, a renderWordle() might be needed after a delay here.
          }
        }, 5 * 100 + 700); // Wait for the last flip animation to complete + a small buffer
        return;
      }

      // letter keys
      if(/^[A-Z]$/.test(key)){
        if(wordleState.col < 5){
          wordleState.board[wordleState.row][wordleState.col] = key;
          wordleState.col++;
          renderWordle();
        }
      }
    }

    function showWordleMsg(text){
      const el = document.getElementById('wordleMsg');
      el.textContent = text;
      // No longer automatically clear, let user clear by typing or next game.
      // setTimeout(()=>{ el.textContent=''; }, 3500);
    }

    document.getElementById('wordleRestart').addEventListener('click', ()=> initWordle());

    /* -----------------------
       2048 implementation (simple)
       ------------------------*/
    let grid2048 = null;
    let score2048 = 0;
    let bestScore2048 = 0;
    const SCORE_KEY = '2048_bestScore'; // LocalStorage key

    // Global variables for swipe detection
    let startX = 0;
    let startY = 0;
    const swipeThreshold = 50; // Minimum distance for a swipe to be recognized
    /**
 * æ£€æŸ¥2048æ¸¸æˆæ˜¯å¦è¿˜æœ‰å¯è¡Œçš„ç§»åŠ¨æˆ–åˆå¹¶æ“ä½œ
 * @returns {boolean} å¦‚æœå¯ä»¥ç§»åŠ¨æˆ–åˆå¹¶åˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› false (æ¸¸æˆç»“æŸ)
 */
    function canMove2048() {
        // æ£€æŸ¥æ˜¯å¦æœ‰ç©ºå•å…ƒæ ¼ (å¦‚æœæœ‰ï¼Œåˆ™æ¸¸æˆæœªç»“æŸ)
        for (let r = 0; r < 4; r++) {
            for (let c = 0; c < 4; c++) {
                if (grid2048.cells[r][c] === 0) {
                    return true;
                }
            }
        }

        // æ£€æŸ¥æ˜¯å¦æœ‰æ°´å¹³æ–¹å‘çš„åˆå¹¶å¯èƒ½
        for (let r = 0; r < 4; r++) {
            for (let c = 0; c < 3; c++) { // åªéœ€æ£€æŸ¥åˆ°å€’æ•°ç¬¬äºŒä¸ªï¼Œå› ä¸ºè¦æ¯”è¾ƒcå’Œc+1
                if (grid2048.cells[r][c] !== 0 && grid2048.cells[r][c] === grid2048.cells[r][c + 1]) {
                    return true;
                }
            }
        }

        // æ£€æŸ¥æ˜¯å¦æœ‰å‚ç›´æ–¹å‘çš„åˆå¹¶å¯èƒ½
        for (let c = 0; c < 4; c++) {
            for (let r = 0; r < 3; r++) { // åªéœ€æ£€æŸ¥åˆ°å€’æ•°ç¬¬äºŒä¸ªï¼Œå› ä¸ºè¦æ¯”è¾ƒrå’Œr+1
                if (grid2048.cells[r][c] !== 0 && grid2048.cells[r][c] === grid2048.cells[r + 1][c]) {
                    return true;
                }
            }
        }

        return false; // æ²¡æœ‰ç©ºå•å…ƒæ ¼ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•å¯è¡Œçš„åˆå¹¶æ“ä½œï¼Œæ¸¸æˆç»“æŸ
    }

    function init2048(){
      // Load best score
      bestScore2048 = parseInt(localStorage.getItem(SCORE_KEY) || '0', 10);
      score2048 = 0;
      updateScore2048(0); // Initialize score display

      const container = document.getElementById('grid2048');
      container.innerHTML = ''; // Clear previous grid
      grid2048 = {
        cells: Array(4).fill(null).map(()=>Array(4).fill(0)),
        dom: container,
        gameOver:false
      };
      for(let r=0;r<4;r++){
        for(let c=0;c<4;c++){
          const d = document.createElement('div');
          d.className = 'tile';
          d.dataset.r = r; d.dataset.c = c;
          container.appendChild(d);
        }
      }
      spawn2048(); spawn2048();
      render2048();
      setup2048Swipe(); // Call to set up swipe listeners

      
    }

    function setup2048Swipe() {
        const gridContainer = document.getElementById('grid2048');

        gridContainer.addEventListener('touchstart', (e) => {
            if (grid2048.gameOver) return;
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
            e.preventDefault(); // Prevent scrolling
        }, { passive: false });

        gridContainer.addEventListener('touchmove', (e) => {
            if (grid2048.gameOver) return;
            e.preventDefault(); // Prevent scrolling during swipe
        }, { passive: false });

        gridContainer.addEventListener('touchend', (e) => {
            if (grid2048.gameOver) return;
            const endX = e.changedTouches[0].clientX;
            const endY = e.changedTouches[0].clientY;
            handleSwipe(startX, startY, endX, endY);
        });

        gridContainer.addEventListener('mousedown', (e) => {
            if (grid2048.gameOver) return;
            startX = e.clientX;
            startY = e.clientY;
            e.preventDefault();
        });

        gridContainer.addEventListener('mouseup', (e) => {
            if (grid2048.gameOver) return;
            const endX = e.clientX;
            const endY = e.clientY;
            handleSwipe(startX, startY, endX, endY);
        });
    }

    function handleSwipe(sX, sY, eX, eY) {
        const diffX = eX - sX;
        const diffY = eY - sY;

        // Check if movement is significant enough
        if (Math.abs(diffX) < swipeThreshold && Math.abs(diffY) < swipeThreshold) {
            return; // Not a significant swipe
        }

        if (Math.abs(diffX) > Math.abs(diffY)) {
            // Horizontal swipe
            if (diffX > 0) {
                performMove('ArrowRight'); // <-- è°ƒç”¨æ–°çš„ performMove å‡½æ•°
            } else {
                performMove('ArrowLeft');  // <-- è°ƒç”¨æ–°çš„ performMove å‡½æ•°
            }
        } else {
            // Vertical swipe
            if (diffY > 0) {
                performMove('ArrowDown');  // <-- è°ƒç”¨æ–°çš„ performMove å‡½æ•°
            } else {
                performMove('ArrowUp');    // <-- è°ƒç”¨æ–°çš„ performMove å‡½æ•°
            }
        }
    }


    function updateScore2048(points) {
      score2048 += points;
      document.getElementById('score2048').textContent = getTranslation('score') + score2048;
      if (score2048 > bestScore2048) {
        bestScore2048 = score2048;
        localStorage.setItem(SCORE_KEY, bestScore2048);
      }
      document.getElementById('bestScore2048').textContent = getTranslation('bestScore') + bestScore2048;
    }

    function spawn2048(){
      const empty = [];
      for(let r=0;r<4;r++) for(let c=0;c<4;c++) if(grid2048.cells[r][c]===0) empty.push([r,c]);
      if(empty.length===0) return;
      const [r,c] = empty[Math.floor(Math.random()*empty.length)];
      const newValue = Math.random() < 0.9 ? 2 : 4;
      grid2048.cells[r][c] = newValue;

      // Add new-tile animation class
      const newTileElement = grid2048.dom.querySelector(`.tile[data-r="${r}"][data-c="${c}"]`);
      if (newTileElement) {
        newTileElement.classList.add('new-tile');
        // Remove after animation to allow other transitions
        setTimeout(() => {
          newTileElement.classList.remove('new-tile');
        }, 250);
      }
    }

    function render2048(){
      const tiles = grid2048.dom.querySelectorAll('.tile');
      tiles.forEach(t => {
        const r = +t.dataset.r, c = +t.dataset.c;
        const v = grid2048.cells[r][c];
        // Ensure only color-related classes are added/removed for smooth transitions
        t.className = 'tile'; // Reset classes
        if(v) t.classList.add('t' + v);
        t.textContent = v || '';
      });
    }

    

    /**
 * å¯¹å•ä¸ªè¡Œæˆ–åˆ—è¿›è¡Œæ»‘åŠ¨å’Œåˆå¹¶æ“ä½œ
 * @param {Array<number>} row è¾“å…¥çš„è¡Œæˆ–åˆ—æ•°ç»„
 * @returns {{row: Array<number>, score: number, changed: boolean}} åŒ…å«å¤„ç†åçš„è¡Œã€è·å¾—çš„åˆ†æ•°ä»¥åŠæ˜¯å¦å‘ç”Ÿå˜åŒ–çš„Duan
 */
    function slideAndMergeRow(row) {
        let originalRow = [...row]; // å¤åˆ¶åŸå§‹è¡Œï¼Œç”¨äºåç»­åˆ¤æ–­æ˜¯å¦å‘ç”Ÿå˜åŒ–
        let newRow = row.filter(val => val !== 0); // ç§»é™¤é›¶ï¼Œå®ç°å‹ç¼©

        let scoreGained = 0;
        let changed = false;

        // åˆå¹¶é˜¶æ®µ
        for (let i = 0; i < newRow.length - 1; i++) {
            if (newRow[i] !== 0 && newRow[i] === newRow[i + 1]) {
                newRow[i] *= 2; // åˆå¹¶ï¼Œå€¼ç¿»å€
                scoreGained += newRow[i]; // å¢åŠ åˆ†æ•°
                newRow.splice(i + 1, 1); // ç§»é™¤è¢«åˆå¹¶çš„ä¸‹ä¸€ä¸ªæ–¹å—
                newRow.push(0); // åœ¨æœ«å°¾æ·»åŠ ä¸€ä¸ªé›¶ï¼Œä¿æŒé•¿åº¦
                changed = true;
            }
        }

        // å¡«å……é›¶ä»¥ç¡®ä¿è¡Œæˆ–åˆ—å§‹ç»ˆæœ‰4ä¸ªå…ƒç´ ï¼ˆæœ€ç»ˆå‹ç¼©ï¼‰
        while (newRow.length < 4) {
            newRow.push(0);
        }

        // å†æ¬¡æ£€æŸ¥åŸå§‹è¡Œä¸æ–°è¡Œæ˜¯å¦ä¸€è‡´ï¼Œç¡®ä¿changedæ ‡å¿—å‡†ç¡®
        for (let i = 0; i < 4; i++) {
            if (originalRow[i] !== newRow[i]) {
                changed = true;
                break;
            }
        }

        return { row: newRow, score: scoreGained, changed: changed };
    }

    /**
 * æ‰§è¡Œä¸€æ¬¡2048çš„ç§»åŠ¨æ“ä½œ
 * @param {string} direction ç§»åŠ¨æ–¹å‘ï¼Œä¾‹å¦‚ 'ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight' æˆ– 'w', 'a', 's', 'd'
 */
    function performMove(direction) {
        if (grid2048.gameOver) return;

        let gridChanged = false;
        let totalScoreThisMove = 0;
        let tempGrid = grid2048.cells.map(r => [...r]); // æ·±åº¦å¤åˆ¶å½“å‰ç½‘æ ¼çŠ¶æ€

        // è¾…åŠ©å‡½æ•°ï¼šæ ¹æ®æ–¹å‘å¤„ç†è¡Œæˆ–åˆ—
        // isRowOperation: true è¡¨ç¤ºå¤„ç†è¡Œï¼Œfalse è¡¨ç¤ºå¤„ç†åˆ—
        // reverse: true è¡¨ç¤ºä»å³åˆ°å·¦æˆ–ä»ä¸‹åˆ°ä¸Šå¤„ç†
        function processGridLines(gridToProcess, isRowOperation, reverse = false) {
            let processedGrid = Array(4).fill(null).map(() => Array(4).fill(0));
            let localChanged = false;
            let localScore = 0;

            for (let i = 0; i < 4; i++) {
                let line = [];
                if (isRowOperation) {
                    // å¤„ç†è¡Œ (Left/Right)
                    line = reverse ? gridToProcess[i].slice().reverse() : gridToProcess[i].slice();
                } else {
                    // å¤„ç†åˆ— (Up/Down)
                    for (let j = 0; j < 4; j++) {
                        line.push(gridToProcess[reverse ? (3 - j) : j][i]);
                    }
                }

                const { row: newArr, score: rowScore, changed: rowChanged } = slideAndMergeRow(line);

                if (rowChanged) localChanged = true;
                localScore += rowScore;

                if (isRowOperation) {
                    processedGrid[i] = reverse ? newArr.reverse() : newArr;
                } else {
                    for (let j = 0; j < 4; j++) {
                        processedGrid[reverse ? (3 - j) : j][i] = newArr[j];
                    }
                }
            }
            return { grid: processedGrid, changed: localChanged, score: localScore };
        }

    let result;
    switch (direction) {
        case 'ArrowLeft':
        case 'a':
            result = processGridLines(tempGrid, true, false); // è¡Œæ“ä½œï¼Œä¸åè½¬ (å‘å·¦)
            break;
        case 'ArrowRight':
        case 'd':
            result = processGridLines(tempGrid, true, true); // è¡Œæ“ä½œï¼Œåè½¬ (å‘å³)
            break;
        case 'ArrowUp':
        case 'w':
            result = processGridLines(tempGrid, false, false); // åˆ—æ“ä½œï¼Œä¸åè½¬ (å‘ä¸Š)
            break;
        case 'ArrowDown':
        case 's':
            result = processGridLines(tempGrid, false, true); // åˆ—æ“ä½œï¼Œåè½¬ (å‘ä¸‹)
            break;
        default:
            return; // æ— æ•ˆæ–¹å‘ï¼Œä¸æ‰§è¡Œä»»ä½•æ“ä½œ
    }

    if (result.changed) {
        grid2048.cells = result.grid; // æ›´æ–°æ¸¸æˆçŠ¶æ€ç½‘æ ¼
        updateScore2048(result.score); // æ›´æ–°åˆ†æ•°
        spawn2048(); // ç”Ÿæˆæ–°æ–¹å—
        render2048(); // é‡æ–°æ¸²æŸ“ç½‘æ ¼
    }

    // æ¯æ¬¡æ½œåœ¨ç§»åŠ¨åæ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
    if (!canMove2048()) {
        grid2048.gameOver = true;
        setTimeout(() => alert(getTranslation('gameOverNoMerge')), 50);
    }
}

    document.getElementById('g2048Restart').addEventListener('click', ()=> init2048());
    document.getElementById('g2048Info').addEventListener('click', ()=> alert(getTranslation('game2048Info'))); // Use translation

    /* -----------------------
       åˆå§‹ï¼šæ˜¾ç¤º name page
       ------------------------*/
    showPage('page-name');

    // small extras: info buttons
    document.getElementById('stoneInfo').addEventListener('click', ()=> alert(getTranslation('stoneInfoText'))); // Use translation
    document.getElementById('wordleInfo').addEventListener('click', ()=> alert(getTranslation('wordleInfoText'))); // Use translation
    // g2048Info is already handled above

    document.getElementById('openNotepad').addEventListener('click', ()=> { showPage('page-notepad'); initNotepad(); });
    document.getElementById('notepadBack').addEventListener('click', ()=> { showPage('page-main'); });
    document.getElementById('saveNotepadBtn').addEventListener('click', saveNotepad);
    document.getElementById('loadNotepadBtn').addEventListener('click', loadNotepadPrompt);
    document.getElementById('applyLoadNotepadBtn').addEventListener('click', applyLoadNotepad);

    function initNotepad() {
        // Clear any previous messages
        document.getElementById('notepadMessage').textContent = '';
        document.getElementById('notepadMessage').className = 'hint'; // Reset class
        // Hide save/load code areas
        document.getElementById('notepadOutput').style.display = 'none';
        document.getElementById('notepadLoadInputArea').style.display = 'none';
        document.getElementById('notepadSaveCode').value = '';
        document.getElementById('notepadLoadCodeInput').value = '';
    }

    function saveNotepad() {
        const text = document.getElementById('notepadContent').value;
        if (!text.trim()) {
            document.getElementById('notepadMessage').textContent = getTranslation('notepadEmptySave');
            document.getElementById('notepadMessage').className = 'error shake';
            setTimeout(() => { document.getElementById('notepadMessage').className = 'hint'; }, 500);
            return;
        }
        // ä½¿ç”¨ encodeURIComponent ç¼–ç æ–‡æœ¬ä»¥å®‰å…¨åœ°å¤„ç†ç‰¹æ®Šå­—ç¬¦ï¼Œç„¶å Base64 ç¼–ç 
        const encodedText = btoa(encodeURIComponent(text));
        document.getElementById('notepadSaveCode').value = encodedText;
        document.getElementById('notepadOutput').style.display = 'flex';
        document.getElementById('notepadLoadInputArea').style.display = 'none'; // Hide load input if saving
        document.getElementById('notepadMessage').textContent = getTranslation('notepadSaveSuccess');
        document.getElementById('notepadMessage').className = 'hint';
    }

    function loadNotepadPrompt() {
        document.getElementById('notepadOutput').style.display = 'none'; // Hide save code if loading
        document.getElementById('notepadLoadInputArea').style.display = 'flex';
        document.getElementById('notepadMessage').textContent = '';
    }

    function applyLoadNotepad() {
        const encodedText = document.getElementById('notepadLoadCodeInput').value.trim();
        if (!encodedText) {
            document.getElementById('notepadMessage').textContent = getTranslation('notepadLoadError');
            document.getElementById('notepadMessage').className = 'error shake';
            setTimeout(() => { document.getElementById('notepadMessage').className = 'hint'; }, 500);
            return;
        }
        try {
            // Base64 è§£ç ï¼Œç„¶åä½¿ç”¨ decodeURIComponent è§£ç ç‰¹æ®Šå­—ç¬¦
            const decodedText = decodeURIComponent(atob(encodedText));
            document.getElementById('notepadContent').value = decodedText;
            document.getElementById('notepadMessage').textContent = getTranslation('notepadLoadSuccess');
            document.getElementById('notepadMessage').className = 'hint';
            document.getElementById('notepadLoadInputArea').style.display = 'none'; // Hide load input after successful load
        } catch (e) {
            document.getElementById('notepadMessage').textContent = getTranslation('notepadLoadError');
            document.getElementById('notepadMessage').className = 'error shake';
            setTimeout(() => { document.getElementById('notepadMessage').className = 'hint'; }, 500);
            console.error("Notepad decoding error:", e);
        }
    }

    function copyNotepadCode() {
        const copyText = document.getElementById('notepadSaveCode');
        copyText.select();
        copyText.setSelectionRange(0, 99999); // For mobile devices
        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(copyText.value).then(() => {
                document.getElementById('notepadMessage').textContent = getTranslation('notepadCopySuccess');
                document.getElementById('notepadMessage').className = 'hint';
            }).catch(err => {
                document.getElementById('notepadMessage').textContent = getTranslation('notepadCopyFail');
                document.getElementById('notepadMessage').className = 'error shake';
                console.error('Failed to copy text: ', err);
            });
        } else {
            // Fallback for older browsers (deprecated, but for maximum compatibility)
            document.execCommand("copy");
            document.getElementById('notepadMessage').textContent = getTranslation('notepadCopySuccess');
            document.getElementById('notepadMessage').className = 'hint';
        }
    }

    // ensure wordle/2048 reset when open
    document.getElementById('openWordle').addEventListener('click', ()=> initWordle());
    document.getElementById('open2048').addEventListener('click', ()=> init2048());

    /* -----------------------
       BULLET HELL GAME
       ------------------------*/
    /* -----------------------
       BULLET HELL GAME
       ------------------------*/
    /* -----------------------
       BULLET HELL GAME
       ------------------------*/
    let bulletHellGame = {
      canvas: null,
      ctx: null,
      player: { x: 0, y: 0, r: 10, speed: 200, normalSpeed: 200, shrinkFactor: 1, invulnerable: false, invulnerableTimer: 0 },
      bullets: [],
      powerUps: [],
      beamWarnings: [], // å…‰æŸè­¦å‘Šçº¿
      activeBeams: [], 
      boss: {            // Boss å¯¹è±¡
        active: false,
        x: 0, y: 0, r: 40,
        hp: 50, // Bossç”Ÿå‘½å€¼ï¼Œå¯ä»¥è°ƒæ•´
        lastSpawnTime: 0,
        activeTimer: 0, // Bossæ´»è·ƒæ—¶é—´è®¡æ—¶å™¨
        activeDuration: 75000, // Bossæ´»è·ƒ75ç§’åæ¶ˆå¤±
        lastCircleAttackTime: 0,
        circleAttackInterval: 5000, // 5ç§’å‘å°„å…‰åœˆ
        lastSmallBallAttackTime: 0,
        smallBallAttackInterval: 800, // Bosså°çƒå‘å°„é¢‘ç‡
        smallBallsPerAttack: 2, // æ¯æ¬¡å°çƒæ”»å‡»å‘å°„çš„æ•°é‡
        damage: 1, // Bossæ”»å‡»é€ æˆçš„ä¼¤å®³
        deathTimer: 0 // Bossè¢«å‡»è´¥åçš„æ¶ˆå¤±è®¡æ—¶å™¨
      },
      bossCircles: [],     // Bosså…‰åœˆ
      bossSmallBullets: [], // Bosså‘å°„çš„å°çƒ
      lives: 5,
      score: 0,
      bestScore: 0,
      running: false,
      lastFrameTime: 0,
      bulletSpawnInterval: 1000, // åˆå§‹å¼¹å¹•ç”Ÿæˆé—´éš”
      lastBulletSpawn: 0,
      difficultyIncreaseRate: 0.998, // è¿›ä¸€æ­¥å‡ç¼“éš¾åº¦å¢åŠ é€Ÿåº¦ (åŸ 0.995, ç°åœ¨æ›´æ…¢ 0.998)
      bulletSpawnIntervalCap: 300, // å¼¹å¹•ç”Ÿæˆæœ€å°é—´éš” (ä» 250 è°ƒæ•´ä¸º 300)

      powerUpSpawnInterval: 10000,
      lastPowerUpSpawn: 0,
      powerUpDuration: 30000, // æ‰€æœ‰é“å…·çš„ç»Ÿä¸€æŒç»­æ—¶é—´ (30ç§’)
      hitInvInvulnerabilityDuration: 2000, // ç©å®¶è¢«å‡»ä¸­åçš„æ— æ•Œæ—¶é—´ (2ç§’)
      teleportDistance: 80, // px
      currentSpeedBoostTimer: 0,
      currentShrinkTimer: 0,
      animationFrameId: null,
      keys: {},
      isTouchDragging: false,
      touchStartX: 0,
      touchStartY: 0,

      // å…‰æŸç›¸å…³å‚æ•°
      beamSpawnChance: 0.03, // 3% å‡ ç‡ç”Ÿæˆå…‰æŸè­¦å‘Š
      beamWarningDuration: 3000, // 3ç§’è­¦å‘Š
      beamActiveDuration: 200, // ç¬æ—¶å…‰æŸçš„æŒç»­æ—¶é—´ (ä» 500 è°ƒæ•´ä¸º 200msï¼Œè®©å®ƒé—ªç°å³é€)
      beamDamage: 2, // å…‰æŸä¼¤å®³ï¼Œ2æ¡å‘½
      beamWidth: 30, // å…‰æŸå®½åº¦ (åšåº¦)

      // å±å¹•éœ‡åŠ¨å‚æ•°
      screenShake: {
        active: false,
        duration: 200, // ms
        magnitude: 8,  // px
        timer: 0,
        xOffset: 0,
        yOffset: 0
      },

      // Boss å‡ºåœºè®¡æ•°å™¨ï¼Œç”¨äºè®¡ç®—å°çƒæ•°é‡
      bossAppearanceCount: 0,
      bossSpawnCooldown: 235000, // 235ç§’åˆ·æ–°ä¸€æ¬¡Boss
    };

    let mathGame = {
      currentDifficulty: 'easy',
      score: 0,
      questionNumber: 0,
      currentProblem: '',
      correctAnswer: 0,
      gameRunning: false,
      totalQuestions: 10,
      timePerQuestion: 0, // Set dynamically per difficulty
      timeRemaining: 0,
      animationFrameId: null, // For smooth progress bar
      lastProgressTime: 0,
      scoreTiers: [0.33, 0.66], // 1/3 and 2/3 of the time remaining
    };

    const BULLET_HELL_BEST_SCORE_KEY = 'bulletHell_bestScore';

    function initBulletHell() {
      bulletHellGame.canvas = document.getElementById('bulletHellCanvas');
      bulletHellGame.ctx = bulletHellGame.canvas.getContext('2d');
      bulletHellGame.bestScore = parseInt(localStorage.getItem(BULLET_HELL_BEST_SCORE_KEY) || '0', 10);

      resizeBulletHellCanvas(); // Initial resize
      window.removeEventListener('resize', resizeBulletHellCanvas); // Avoid multiple listeners
      window.addEventListener('resize', resizeBulletHellCanvas); // Ensure canvas resizes with window

      resetBulletHellGame();
      updateBulletHellUI();
      document.getElementById('bulletHellGameMessage').textContent = getTranslation('bulletHellStartButton');

      // Remove existing event listeners to prevent duplicates
      document.removeEventListener('keydown', handleBulletHellKeyDown);
      document.removeEventListener('keyup', handleBulletHellKeyUp);
      bulletHellGame.canvas.removeEventListener('touchstart', handleBulletHellTouchStart);
      bulletHellGame.canvas.removeEventListener('touchmove', handleBulletHellTouchMove);
      bulletHellGame.canvas.removeEventListener('touchend', handleBulletHellTouchEnd);
      bulletHellGame.canvas.removeEventListener('contextmenu', e => e.preventDefault()); // é˜²æ­¢å³é”®èœå•

      // Add new event listeners
      document.addEventListener('keydown', handleBulletHellKeyDown);
      document.addEventListener('keyup', handleBulletHellKeyUp);
      bulletHellGame.canvas.addEventListener('touchstart', handleBulletHellTouchStart, { passive: false });
      bulletHellGame.canvas.addEventListener('touchmove', handleBulletHellTouchMove, { passive: false });
      bulletHellGame.canvas.addEventListener('touchend', handleBulletHellTouchEnd);
      bulletHellGame.canvas.addEventListener('contextmenu', e => e.preventDefault()); // é˜²æ­¢å³é”®èœå•
    }

    function resizeBulletHellCanvas() {
      const parent = bulletHellGame.canvas.parentElement;
      const size = Math.min(parent.clientWidth, 600); // Max width 600px
      bulletHellGame.canvas.width = size;
      bulletHellGame.canvas.height = size * 0.8; // Maintain aspect ratio
      // Ensure player is within bounds after resize
      bulletHellGame.player.x = Math.max(bulletHellGame.player.r, Math.min(bulletHellGame.canvas.width - bulletHellGame.player.r, bulletHellGame.player.x));
      bulletHellGame.player.y = Math.max(bulletHellGame.player.r, Math.min(bulletHellGame.canvas.height - bulletHellGame.player.r, bulletHellGame.player.y));
      drawBulletHell(); // Redraw on resize
    }

    function resetBulletHellGame() {
      if (bulletHellGame.animationFrameId) {
        cancelAnimationFrame(bulletHellGame.animationFrameId);
      }
      bulletHellGame.player = {
        x: bulletHellGame.canvas.width / 2,
        y: bulletHellGame.canvas.height - 30,
        r: 10,
        speed: 200,
        normalSpeed: 200,
        shrinkFactor: 1,
        invulnerable: false,
        invulnerableTimer: 0
      };
      bulletHellGame.bullets = [];
      bulletHellGame.powerUps = [];
      bulletHellGame.beamWarnings = []; // é‡ç½®å…‰æŸè­¦å‘Š
      bulletHellGame.activeBeams = []; 
      bulletHellGame.boss = {            // é‡ç½®BossçŠ¶æ€
        active: false,
        x: bulletHellGame.canvas.width / 2, y: bulletHellGame.canvas.height / 4, r: 40,
        hp: 50,
        lastSpawnTime: performance.now() + bulletHellGame.bossSpawnCooldown, // Bossä¸‹æ¬¡å‡ºåœºæ—¶é—´
        activeTimer: 0,
        activeDuration: 75000, // 75ç§’
        lastCircleAttackTime: 0,
        circleAttackInterval: 5000,
        lastSmallBallAttackTime: 0,
        smallBallAttackInterval: 800,
        smallBallsPerAttack: 2,
        damage: 1,
        deathTimer: 0
      };
      bulletHellGame.bossCircles = [];     // é‡ç½®Bosså…‰åœˆ
      bulletHellGame.bossSmallBullets = []; // é‡ç½®Bosså°çƒ
      bulletHellGame.bossAppearanceCount = 0; // é‡ç½®Bosså‡ºåœºè®¡æ•°å™¨

      bulletHellGame.lives = 5;
      bulletHellGame.score = 0;
      bulletHellGame.running = false;
      bulletHellGame.lastFrameTime = performance.now();
      bulletHellGame.bulletSpawnInterval = 1000;
      bulletHellGame.lastBulletSpawn = 0;
      bulletHellGame.powerUpSpawnInterval = 10000;
      bulletHellGame.lastPowerUpSpawn = 0;
      bulletHellGame.currentSpeedBoostTimer = 0;
      bulletHellGame.currentShrinkTimer = 0;
      bulletHellGame.keys = {};
      bulletHellGame.isTouchDragging = false;
      bulletHellGame.screenShake = { active: false, duration: 200, magnitude: 8, timer: 0, xOffset: 0, yOffset: 0 }; // é‡ç½®å±å¹•éœ‡åŠ¨çŠ¶æ€

      document.getElementById('bulletHellGameMessage').textContent = '';
      drawBulletHell();
      updateBulletHellUI();
    }

    function startGameBulletHell() {
      if (!bulletHellGame.running) {
        resetBulletHellGame(); // Reset before starting new game
        bulletHellGame.running = true;
        bulletHellGame.lastFrameTime = performance.now();
        bulletHellGame.lastBulletSpawn = bulletHellGame.lastFrameTime;
        bulletHellGame.lastPowerUpSpawn = bulletHellGame.lastFrameTime;
        bulletHellGame.boss.lastSpawnTime = bulletHellGame.lastFrameTime + bulletHellGame.bossSpawnCooldown; // é¦–æ¬¡Bosså‡ºåœºå€’è®¡æ—¶
        document.getElementById('bulletHellStartBtn').textContent = getTranslation('restartGame');
        document.getElementById('bulletHellGameMessage').textContent = '';
        bulletHellGame.animationFrameId = requestAnimationFrame(gameLoopBulletHell);
      } else {
        // If already running, this button acts as restart
        resetBulletHellGame();
        document.getElementById('bulletHellStartBtn').textContent = getTranslation('bulletHellStartButton');
        document.getElementById('bulletHellGameMessage').textContent = getTranslation('bulletHellStartButton');
      }
    }

    function updateBulletHellUI() {
      document.getElementById('bulletHellScore').textContent = `${getTranslation('score')}${Math.floor(bulletHellGame.score)}`;
      document.getElementById('bulletHellBestScore').textContent = `${getTranslation('bestScore')}${bulletHellGame.bestScore}`;
      document.getElementById('bulletHellLives').textContent = `${getTranslation('lives')}${bulletHellGame.lives}`;
    }

    // --- è¾…åŠ©ç»˜åˆ¶å‡½æ•° ---
    function drawHeart(ctx, x, y, size, color) {
      ctx.fillStyle = color;
      ctx.beginPath();
      ctx.moveTo(x, y + size / 4);
      ctx.quadraticCurveTo(x + size / 2, y - size / 2, x + size, y + size / 4);
      ctx.quadraticCurveTo(x + size, y + size, x, y + size * 1.2);
      ctx.quadraticCurveTo(x - size, y + size, x - size, y + size / 4);
      ctx.quadraticCurveTo(x - size / 2, y - size / 2, x, y + size / 4);
      ctx.closePath();
      ctx.fill();
    }

    function drawLightning(ctx, x, y, size, color) {
      ctx.fillStyle = color;
      ctx.beginPath();
      ctx.moveTo(x, y);
      ctx.lineTo(x + size / 3, y + size / 2);
      ctx.lineTo(x, y + size / 2);
      ctx.lineTo(x + size / 2, y + size);
      ctx.lineTo(x - size / 3, y + size / 2);
      ctx.lineTo(x, y + size / 2);
      ctx.closePath();
      ctx.fill();
    }

    function drawDownArrow(ctx, x, y, size, color) {
      ctx.fillStyle = color;
      ctx.beginPath();
      ctx.moveTo(x, y + size);
      ctx.lineTo(x - size / 2, y + size / 2);
      ctx.lineTo(x - size / 4, y + size / 2);
      ctx.lineTo(x - size / 4, y);
      ctx.lineTo(x + size / 4, y);
      ctx.lineTo(x + size / 4, y + size / 2);
      ctx.lineTo(x + size / 2, y + size / 2);
      ctx.closePath();
      ctx.fill();
    }

    function drawShield(ctx, x, y, size, color) {
      ctx.fillStyle = color;
      ctx.beginPath();
      ctx.moveTo(x, y);
      ctx.bezierCurveTo(x + size, y, x + size, y + size, x, y + size * 1.5);
      ctx.bezierCurveTo(x - size, y + size, x - size, y, x, y);
      ctx.closePath();
      ctx.fill();
      ctx.fillStyle = 'rgba(255,255,255,0.7)';
      ctx.beginPath();
      const starSize = size * 0.3;
      const starX = x;
      const starY = y + size * 0.5;
      for (let i = 0; i < 5; i++) {
        ctx.lineTo(starX + starSize * Math.cos(i * 2 * Math.PI / 5 + Math.PI / 2),
                   starY + starSize * Math.sin(i * 2 * Math.PI / 5 + Math.PI / 2));
        ctx.lineTo(starX + starSize / 2 * Math.cos(i * 2 * Math.PI / 5 + Math.PI / 2 + Math.PI / 5),
                   starY + starSize / 2 * Math.sin(i * 2 * Math.PI / 5 + Math.PI / 2 + Math.PI / 5));
      }
      ctx.closePath();
      ctx.fill();
    }

    function drawRightArrow(ctx, x, y, size, color) {
      ctx.fillStyle = color;
      ctx.beginPath();
      ctx.moveTo(x - size / 2, y - size / 4);
      ctx.lineTo(x - size / 2, y + size / 4);
      ctx.lineTo(x + size / 4, y + size / 4);
      ctx.lineTo(x + size / 4, y + size / 2);
      ctx.lineTo(x + size, y);
      ctx.lineTo(x + size / 4, y - size / 2);
      ctx.lineTo(x + size / 4, y - size / 4);
      ctx.closePath();
      ctx.fill();
    }

    // --- æ ¸å¿ƒç»˜åˆ¶å‡½æ•° ---
    function drawBulletHell() {
      const { ctx, canvas, player, bullets, powerUps, beamWarnings, beams, screenShake, boss, bossCircles, bossSmallBullets } = bulletHellGame;

      // 1. æ¸…ç©ºç”»å¸ƒ
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // 2. åº”ç”¨å±å¹•éœ‡åŠ¨ (æ‰€æœ‰å…ƒç´ éƒ½ä¼šéšä¹‹éœ‡åŠ¨)
      if (screenShake.active) {
        ctx.save();
        ctx.translate(screenShake.xOffset, screenShake.yOffset);
      }

      // 3. ç»˜åˆ¶å…‰æŸè­¦å‘Šçº¿ (æ•´ä¸ªé€šé“é—ªçƒ)
      beamWarnings.forEach(w => {
        const alpha = Math.abs(Math.sin(performance.now() / 200)) * 0.8 + 0.2; // 0.2-1.0 ä¹‹é—´é—ªçƒ
        ctx.fillStyle = `rgba(255,0,0,${alpha})`; // çº¢è‰²è­¦å‘Šçº¿

        if (w.lane === 'horizontal') {
            ctx.fillRect(0, w.y, canvas.width, w.width); // ç»˜åˆ¶æ•´ä¸ªåŒºåŸŸ
        } else {
            ctx.fillRect(w.x, 0, w.width, canvas.height); // ç»˜åˆ¶æ•´ä¸ªåŒºåŸŸ
        }
      });

      // 4. ç»˜åˆ¶å…‰æŸ (é…·ç‚«çš„æ‰«è¿‡æ•ˆæœ)
      bulletHellGame.activeBeams.forEach(b => {
        const alpha = b.timer / bulletHellGame.beamActiveDuration; // æ ¹æ®å‰©ä½™æ—¶é—´æ·¡å‡º
        ctx.fillStyle = `rgba(200,100,255,${alpha})`; // å›ºä½“ç´«è‰²/ç²‰è‰²
        ctx.fillRect(b.x, b.y, b.width, b.height);
      });

      // 5. ç»˜åˆ¶ Boss
      if (boss.active) {
        ctx.fillStyle = 'purple';
        ctx.beginPath();
        ctx.arc(boss.x, boss.y, boss.r, 0, Math.PI * 2);
        ctx.fill();

        // ç»˜åˆ¶ Boss è¡€æ¡ (ç®€åŒ–)
        const hpBarWidth = boss.r * 2;
        const hpBarHeight = 5;
        const bossMaxHp = 50 + (bulletHellGame.bossAppearanceCount - 1) * 10;
        const currentHpWidth = hpBarWidth * (boss.hp / bossMaxHp);
        ctx.fillStyle = 'red';
        ctx.fillRect(boss.x - boss.r, boss.y - boss.r - 10, hpBarWidth, hpBarHeight);
        ctx.fillStyle = 'lime';
        ctx.fillRect(boss.x - boss.r, boss.y - boss.r - 10, currentHpWidth, hpBarHeight);
      }

      // 6. ç»˜åˆ¶ Boss å…‰åœˆ
      bossCircles.forEach(c => {
        ctx.strokeStyle = `rgba(128,0,128,${c.alpha})`; // ç´«è‰²ï¼Œé€æ¸é€æ˜
        ctx.lineWidth = c.thickness; // å…‰åœˆå®½åº¦
        ctx.beginPath();
        ctx.arc(c.x, c.y, c.r, 0, Math.PI * 2);
        ctx.stroke();
      });

      // 7. ç»˜åˆ¶ Boss å°çƒ
      bossSmallBullets.forEach(b => {
        ctx.fillStyle = 'yellow'; // åŒºåˆ«äºæ™®é€šå­å¼¹
        ctx.beginPath();
        ctx.arc(b.x, b.y, b.r, 0, Math.PI * 2);
        ctx.fill();
      });

      // 8. ç»˜åˆ¶ç©å®¶
      const playerColor = player.invulnerable ? 'rgba(255,255,255,0.6)' : (document.body.classList.contains('dark-theme') ? '#e74c3c' : '#ff4c4c');
      const actualPlayerR = player.r * player.shrinkFactor;
      drawHeart(ctx, player.x, player.y, actualPlayerR, playerColor);

      // 9. ç»˜åˆ¶æ™®é€šå­å¼¹
      ctx.fillStyle = 'white';
      bullets.forEach(b => {
        ctx.beginPath();
        ctx.arc(b.x, b.y, b.r, 0, Math.PI * 2);
        ctx.fill();
      });

      // 10. ç»˜åˆ¶é“å…·
      powerUps.forEach(p => {
        const powerUpColor = 'gold'; // é“å…·ä¸­æ€§é¢œè‰²
        const powerUpSize = 10;
        switch (p.type) {
          case 'speed': drawLightning(ctx, p.x, p.y, powerUpSize, powerUpColor); break;
          case 'heal': drawHeart(ctx, p.x, p.y, powerUpSize, 'lime'); break; // ç»¿è‰²å°çˆ±å¿ƒ
          case 'shrink': drawDownArrow(ctx, p.x, p.y, powerUpSize, powerUpColor); break;
          case 'invincible': drawShield(ctx, p.x, p.y, powerUpSize, 'lightblue'); break;
          case 'teleport': drawRightArrow(ctx, p.x, p.y, powerUpSize, powerUpColor); break;
        }
      });

      // æ¢å¤ä¸Šä¸‹æ–‡ (ç§»é™¤éœ‡åŠ¨æ•ˆæœ)
      if (screenShake.active) {
        ctx.restore();
      }
    }

    // --- æ¸¸æˆä¸»å¾ªç¯ ---
    function gameLoopBulletHell(currentTime) {
      const deltaTime = (currentTime - bulletHellGame.lastFrameTime) / 1000; // seconds
      bulletHellGame.lastFrameTime = currentTime;

      if (!bulletHellGame.running) return;

      updateBulletHell(deltaTime);
      drawBulletHell();

      bulletHellGame.animationFrameId = requestAnimationFrame(gameLoopBulletHell);
    }

    // --- æ¸¸æˆçŠ¶æ€æ›´æ–°é€»è¾‘ ---
    function updateBulletHell(dt) {
      const { player, canvas, bullets, powerUps, beamWarnings, beams, screenShake, boss, bossCircles, bossSmallBullets } = bulletHellGame;
      const now = performance.now();

      // ç©å®¶ç§»åŠ¨
      const moveAmount = player.speed * dt;
      if (bulletHellGame.keys['ArrowLeft'] || bulletHellGame.keys['a']) {
        player.x = Math.max(player.r * player.shrinkFactor, player.x - moveAmount);
      }
      if (bulletHellGame.keys['ArrowRight'] || bulletHellGame.keys['d']) {
        player.x = Math.min(canvas.width - player.r * player.shrinkFactor, player.x + moveAmount);
      }
      if (bulletHellGame.keys['ArrowUp'] || bulletHellGame.keys['w']) {
        player.y = Math.max(player.r * player.shrinkFactor, player.y - moveAmount);
      }
      if (bulletHellGame.keys['ArrowDown'] || bulletHellGame.keys['s']) {
        player.y = Math.min(canvas.height - player.r * player.shrinkFactor, player.y + moveAmount);
      }

      // æ›´æ–°å±å¹•éœ‡åŠ¨
      if (screenShake.active) {
        screenShake.timer -= dt * 1000;
        if (screenShake.timer <= 0) {
          screenShake.active = false;
          screenShake.timer = 0;
          screenShake.xOffset = 0;
          screenShake.yOffset = 0;
        } else {
          screenShake.xOffset = (Math.random() - 0.5) * screenShake.magnitude * 2;
          screenShake.yOffset = (Math.random() - 0.5) * screenShake.magnitude * 2;
        }
      }

      // æ›´æ–°é“å…·/å‡»ä¸­æ— æ•Œè®¡æ—¶å™¨
      if (player.invulnerable && player.invulnerableTimer > 0) {
        player.invulnerableTimer -= dt * 1000;
        if (player.invulnerableTimer <= 0) {
          player.invulnerable = false;
          player.invulnerableTimer = 0;
        }
      }
      if (bulletHellGame.currentSpeedBoostTimer > 0) {
        bulletHellGame.currentSpeedBoostTimer -= dt * 1000;
        if (bulletHellGame.currentSpeedBoostTimer <= 0) {
          player.speed = player.normalSpeed; // Reset speed
          bulletHellGame.currentSpeedBoostTimer = 0;
        }
      }
      if (bulletHellGame.currentShrinkTimer > 0) {
        bulletHellGame.currentShrinkTimer -= dt * 1000;
        if (bulletHellGame.currentShrinkTimer <= 0) {
          player.shrinkFactor = 1; // Reset size
          bulletHellGame.currentShrinkTimer = 0;
        }
      }

      // æ™®é€šå¼¹å¹•ç”Ÿæˆ
      if (now - bulletHellGame.lastBulletSpawn > bulletHellGame.bulletSpawnInterval) {
        if (!boss.active && Math.random() < bulletHellGame.beamSpawnChance) { // å¦‚æœBossä¸æ´»è·ƒï¼Œæœ‰å‡ ç‡ç”Ÿæˆå…‰æŸè­¦å‘Š
          spawnBeamWarning();
          document.getElementById('bulletHellGameMessage').textContent = getTranslation('bulletHellTruckWarning'); // ä½¿ç”¨å…‰æŸè­¦å‘Šç¿»è¯‘
          // æ¶ˆæ¯ä¼šåœ¨è­¦å‘Šè®¡æ—¶å™¨ç»“æŸæ—¶æˆ–ç”±å…¶ä»–äº‹ä»¶æ¸…é™¤
        } else if (!boss.active || (boss.active && Math.random() < 0.5)) { // Bossæ´»è·ƒæ—¶ï¼Œæ™®é€šå­å¼¹ç”Ÿæˆé¢‘ç‡å‡åŠ
          spawnBullet();
        }
        bulletHellGame.lastBulletSpawn = now;
        // é€æ¸å¢åŠ éš¾åº¦
        bulletHellGame.bulletSpawnInterval *= bulletHellGame.difficultyIncreaseRate;
        if (bulletHellGame.bulletSpawnInterval < bulletHellGame.bulletSpawnIntervalCap) {
            bulletHellGame.bulletSpawnInterval = bulletHellGame.bulletSpawnIntervalCap; // é™åˆ¶æœ€å°ç”Ÿæˆé—´éš”
        }
      }

      // æ™®é€šå­å¼¹ç§»åŠ¨å’Œç¢°æ’
      for (let i = bullets.length - 1; i >= 0; i--) {
        const b = bullets[i];
        b.x += b.vx * dt;
        b.y += b.vy * dt;

        // ç§»é™¤å±å¹•å¤–çš„å­å¼¹
        if (b.x < -b.r || b.x > canvas.width + b.r || b.y < -b.r || b.y > canvas.height + b.r) {
          bullets.splice(i, 1);
          continue;
        }

        // ä¸ç©å®¶ç¢°æ’
        const effectivePlayerR = player.r * player.shrinkFactor;
        const dx = player.x - b.x;
        const dy = player.y - b.y;
        const distance = Math.sqrt(dx * dx + dy * dy);
        if (distance < effectivePlayerR + b.r && !player.invulnerable) {
          bulletHellGame.lives--;
          player.invulnerable = true;
          player.invulnerableTimer = bulletHellGame.hitInvInvulnerabilityDuration; // ä½¿ç”¨ç‹¬ç«‹çš„å‡»ä¸­æ— æ•Œæ—¶é—´
          bullets.splice(i, 1); // ç¢°æ’åç§»é™¤å­å¼¹
          if (bulletHellGame.lives <= 0) {
            gameOverBulletHell();
            return;
          }
        }
      }

      // æ›´æ–°å…‰æŸè­¦å‘Š
      for (let i = beamWarnings.length - 1; i >= 0; i--) {
        const w = beamWarnings[i];
        w.timer -= dt * 1000;
        if (w.timer <= 0) {
          // è­¦å‘Šç»“æŸï¼Œç”Ÿæˆå…‰æŸ
          spawnBeam(w);
          document.getElementById('bulletHellGameMessage').textContent = getTranslation('bulletHellBeamComing');
          setTimeout(() => { document.getElementById('bulletHellGameMessage').textContent = ''; }, 1000); // 1ç§’åæ¸…é™¤æ¶ˆæ¯
          beamWarnings.splice(i, 1);
        }
      }

      // æ›´æ–°å…‰æŸçŠ¶æ€å’Œç¢°æ’
      // æ›´æ–°æ´»è·ƒå…‰æŸçŠ¶æ€å’Œç¢°æ’ (ç¬æ—¶å……æ»¡ä¸€æ•´è¡Œ/åˆ—)
      for (let i = bulletHellGame.activeBeams.length - 1; i >= 0; i--) {
        const b = bulletHellGame.activeBeams[i];
        b.timer -= dt * 1000; // å‡å°‘å…‰æŸçš„è®¡æ—¶å™¨

        if (b.timer <= 0) {
          bulletHellGame.activeBeams.splice(i, 1); // è®¡æ—¶å™¨ç»“æŸåç§»é™¤å…‰æŸ
          continue;
        }

        // ç¢°æ’æ£€æµ‹ï¼šç©å®¶æ˜¯å¦ä¸ç¬æ—¶å…‰æŸåŒºåŸŸé‡å 
        // åªæœ‰å½“ç©å®¶ä¸æ˜¯æ— æ•ŒçŠ¶æ€ä¸”å…‰æŸè¿˜æœªé€ æˆä¼¤å®³æ—¶æ‰æ£€æµ‹
        if (!b.hasDamaged && !player.invulnerable) {
          const effectivePlayerR = player.r * player.shrinkFactor;
          const playerRect = {
            x: player.x - effectivePlayerR,
            y: player.y - effectivePlayerR,
            width: effectivePlayerR * 2,
            height: effectivePlayerR * 2
          };

          // åˆ¤æ–­çŸ©å½¢ç¢°æ’
          if (playerRect.x < b.x + b.width &&
              playerRect.x + playerRect.width > b.x &&
              playerRect.y < b.y + b.height &&
              playerRect.y + playerRect.height > b.y) {
            bulletHellGame.lives -= b.damage;
            player.invulnerable = true;
            player.invulnerableTimer = bulletHellGame.hitInvInvulnerabilityDuration;
            startScreenShake(); // å±å¹•éœ‡åŠ¨
            b.hasDamaged = true; // æ ‡è®°å…‰æŸå·²é€ æˆä¼¤å®³ï¼Œé¿å…é‡å¤ä¼¤å®³
            if (bulletHellGame.lives <= 0) {
              gameOverBulletHell();
              return;
            }
          }
        }
      }


      // Bossç”Ÿæˆé€»è¾‘
      if (!boss.active && (now - boss.lastSpawnTime) > 0) {
        spawnBoss();
      }

      // Bossæ´»è·ƒé€»è¾‘
      if (boss.active) {
        // æ›´æ–°Bossæ´»è·ƒè®¡æ—¶å™¨
        boss.activeTimer -= dt * 1000;
        if (boss.activeTimer <= 0) {
            boss.active = false;
            boss.lastSpawnTime = now + bulletHellGame.bossSpawnCooldown; // å®‰æ’ä¸‹æ¬¡Bosså‡ºåœº
            bossCircles.length = 0; // æ¸…é™¤æ‰€æœ‰Bosså…‰åœˆ
            bossSmallBullets.length = 0; // æ¸…é™¤æ‰€æœ‰Bosså°çƒ
            document.getElementById('bulletHellGameMessage').textContent = getTranslation('bossVanish');
            setTimeout(() => { document.getElementById('bulletHellGameMessage').textContent = ''; }, 1000); // 1ç§’åæ¸…é™¤æ¶ˆæ¯
        }

        // Bosså…‰åœˆæ”»å‡»
        if (now - boss.lastCircleAttackTime > boss.circleAttackInterval) {
          spawnBossCircleAttack();
          boss.lastCircleAttackTime = now;
        }

        // Bosså°çƒæ”»å‡»
        if (now - boss.lastSmallBallAttackTime > boss.smallBallAttackInterval) {
          spawnBossSmallBalls();
          boss.lastSmallBallAttackTime = now;
        }
      }

      // æ›´æ–° Boss å…‰åœˆ
      for (let i = bossCircles.length - 1; i >= 0; i--) {
        const c = bossCircles[i];
        c.r += c.growthRate * dt;
        c.alpha -= c.fadeRate * dt;

        if (c.alpha <= 0 || c.r > c.maxR) { // è¶…è¿‡æœ€å¤§åŠå¾„ä¹Ÿç§»é™¤
          bossCircles.splice(i, 1);
          continue;
        }

        // ä¸ç©å®¶ç¢°æ’ (ç¯å½¢ç¢°æ’)
        const effectivePlayerR = player.r * player.shrinkFactor;
        const dx = player.x - c.x;
        const dy = player.y - c.y;
        const distance = Math.sqrt(dx * dx + dy * dy);
        // ç©å®¶ä½äºå…‰åœˆçš„åšåº¦èŒƒå›´å†…
        if (distance > c.r - c.thickness && distance < c.r + c.thickness && !player.invulnerable) {
          bulletHellGame.lives -= c.damage;
          player.invulnerable = true;
          player.invulnerableTimer = bulletHellGame.hitInvInvulnerabilityDuration; // ä½¿ç”¨ç‹¬ç«‹çš„å‡»ä¸­æ— æ•Œæ—¶é—´
          if (bulletHellGame.lives <= 0) {
            gameOverBulletHell();
            return;
          }
        }
      }

      // æ›´æ–° Boss å°çƒå’Œç¢°æ’
      for (let i = bossSmallBullets.length - 1; i >= 0; i--) {
        const b = bossSmallBullets[i];
        b.x += b.vx * dt;
        b.y += b.vy * dt;

        // ç§»é™¤å±å¹•å¤–çš„å°çƒ
        if (b.x < -b.r || b.x > canvas.width + b.r || b.y < -b.r || b.y > canvas.height + b.r) {
          bossSmallBullets.splice(i, 1);
          continue;
        }

        // ä¸ç©å®¶ç¢°æ’
        const effectivePlayerR = player.r * player.shrinkFactor;
        const dx = player.x - b.x;
        const dy = player.y - b.y;
        const distance = Math.sqrt(dx * dx + dy * dy);
        if (distance < effectivePlayerR + b.r && !player.invulnerable) {
          bulletHellGame.lives -= b.damage;
          player.invulnerable = true;
          player.invulnerableTimer = bulletHellGame.hitInvInvulnerabilityDuration; // ä½¿ç”¨ç‹¬ç«‹çš„å‡»ä¸­æ— æ•Œæ—¶é—´
          bossSmallBullets.splice(i, 1); // ç¢°æ’åç§»é™¤å°çƒ
          if (bulletHellGame.lives <= 0) {
            gameOverBulletHell();
            return;
          }
        }
      }

      // é“å…·ç”Ÿæˆ
      if (now - bulletHellGame.lastPowerUpSpawn > bulletHellGame.powerUpSpawnInterval) {
        spawnPowerUp();
        bulletHellGame.lastPowerUpSpawn = now;
      }

      // é“å…·ç§»åŠ¨å’Œæ”¶é›†
      for (let i = powerUps.length - 1; i >= 0; i--) {
        const p = powerUps[i];
        p.y += p.speed * dt; // é“å…·ä¸‹è½

        if (p.y > canvas.height + p.size) { // ç§»é™¤å±å¹•å¤–çš„é“å…·
          powerUps.splice(i, 1);
          continue;
        }

        // ä¸ç©å®¶ç¢°æ’
        const effectivePlayerR = player.r * player.shrinkFactor;
        const dx = player.x - p.x;
        const dy = player.y - p.y;
        const distance = Math.sqrt(dx * dx + dy * dy);
        if (distance < effectivePlayerR + p.size) {
          applyPowerUp(p.type);
          powerUps.splice(i, 1);
        }
      }

      // æ›´æ–°åˆ†æ•°
      bulletHellGame.score += dt;
      if (Math.floor(bulletHellGame.score) > bulletHellGame.bestScore) {
        bulletHellGame.bestScore = Math.floor(bulletHellGame.score);
        localStorage.setItem(BULLET_HELL_BEST_SCORE_KEY, bulletHellGame.bestScore);
      }
      updateBulletHellUI();
    }

    // --- å„ç±»ç”Ÿæˆå‡½æ•° ---
    function spawnBullet() {
      const { canvas, player } = bulletHellGame;
      const r = 5 + Math.random() * 5; // å­å¼¹åŠå¾„
      const speed = 150 + Math.random() * 100; // å­å¼¹é€Ÿåº¦

      let startX, startY;
      const side = Math.floor(Math.random() * 4); // 0:ä¸Š, 1:å³, 2:ä¸‹, 3:å·¦

      // åœ¨ç”»å¸ƒå¤–ç”Ÿæˆ
      switch (side) {
        case 0: // ä¸Šæ–¹
          startX = Math.random() * canvas.width;
          startY = -r;
          break;
        case 1: // å³æ–¹
          startX = canvas.width + r;
          startY = Math.random() * canvas.height;
          break;
        case 2: // ä¸‹æ–¹
          startX = Math.random() * canvas.width;
          startY = canvas.height + r;
          break;
        case 3: // å·¦æ–¹
          startX = -r;
          startY = Math.random() * canvas.height;
          break;
      }

      // æœå‘ç©å®¶çš„åŒºåŸŸ
      const angle = Math.atan2(player.y - startY, player.x - startX) + (Math.random() - 0.5) * Math.PI / 4; // å¢åŠ ä¸€äº›éšæœºæ€§
      const vx = speed * Math.cos(angle);
      const vy = speed * Math.sin(angle);

      bulletHellGame.bullets.push({ x: startX, y: startY, r: r, vx: vx, vy: vy });
    }

    const powerUpTypes = ['speed', 'heal', 'shrink', 'invincible', 'teleport'];
    function spawnPowerUp() {
      const { canvas } = bulletHellGame;
      const type = powerUpTypes[Math.floor(Math.random() * powerUpTypes.length)];
      const x = Math.random() * (canvas.width - 20) + 10;
      const y = -20; // åœ¨ç”»å¸ƒä¸Šæ–¹ç”Ÿæˆ
      const size = 10;
      const speed = 80; // é“å…·ä¸‹è½é€Ÿåº¦
      bulletHellGame.powerUps.push({ x, y, size, type, speed });
    }

    function startScreenShake() {
      bulletHellGame.screenShake.active = true;
      bulletHellGame.screenShake.timer = bulletHellGame.screenShake.duration;
    }

    function spawnBeamWarning() {
      const { canvas, beamWarningDuration, beamWidth } = bulletHellGame;

      const direction = Math.random() < 0.5 ? 'horizontal' : 'vertical';

      if (direction === 'horizontal') {
          const y = Math.random() * (canvas.height - beamWidth); // å…‰æŸ Y åæ ‡
          bulletHellGame.beamWarnings.push({
              lane: direction,
              y: y, // å…‰æŸå®é™… Y åæ ‡
              width: beamWidth, // å…‰æŸå®½åº¦
              timer: beamWarningDuration
          });
      } else { // vertical
          const x = Math.random() * (canvas.width - beamWidth); // å…‰æŸ X åæ ‡
          bulletHellGame.beamWarnings.push({
              lane: direction,
              x: x, // å…‰æŸå®é™… X åæ ‡
              width: beamWidth, // å…‰æŸå®½åº¦
              timer: beamWarningDuration
          });
      }
    }

    function spawnBeam(warning) {
      const { canvas, beamActiveDuration, beamDamage, beamWidth } = bulletHellGame;
      let x, y, width, height;

      if (warning.lane === 'horizontal') {
          x = 0;
          y = warning.y;
          width = canvas.width;
          height = beamWidth;
      } else { // vertical
          x = warning.x;
          y = 0;
          width = beamWidth;
          height = canvas.height;
      }

      // ç›´æ¥æ·»åŠ åˆ° activeBeamsï¼Œå®ƒå°†ç«‹å³æ˜¾ç¤ºä¸ºæ•´ä¸ªåŒºåŸŸçš„å…‰æŸ
      bulletHellGame.activeBeams.push({
          x: x, y: y,
          width: width, height: height,
          damage: beamDamage,
          timer: beamActiveDuration, // å…‰æŸæŒç»­æ—¶é—´ (çŸ­ä¿ƒçš„é—ªç°)
          hasDamaged: false // ç¡®ä¿å…‰æŸåªé€ æˆä¸€æ¬¡ä¼¤å®³
      });

      document.getElementById('bulletHellGameMessage').textContent = getTranslation('bulletHellBeamComing');
      setTimeout(() => { document.getElementById('bulletHellGameMessage').textContent = ''; }, 1000); // 1ç§’åæ¸…é™¤æ¶ˆæ¯
    }

    function spawnBoss() {
      const { canvas, boss } = bulletHellGame;
      boss.active = true;
      boss.x = canvas.width / 2;
      boss.y = canvas.height / 4;
      boss.lastCircleAttackTime = performance.now();
      boss.lastSmallBallAttackTime = performance.now();
      
      bulletHellGame.bossAppearanceCount++; // å¢åŠ Bosså‡ºåœºè®¡æ•°
      boss.smallBallsPerAttack = 2 * bulletHellGame.bossAppearanceCount; // æ¯æ¬¡å°çƒæ”»å‡»å‘å°„çš„æ•°é‡ (2, 4, 6...)
      boss.hp = 50 + (bulletHellGame.bossAppearanceCount - 1) * 10; // æ¯æ¬¡å‡ºåœºå¢åŠ HP
      boss.activeTimer = boss.activeDuration; // é‡ç½®Bossæ´»è·ƒè®¡æ—¶å™¨

      document.getElementById('bulletHellGameMessage').textContent = getTranslation('bulletHellBossAppear');
      setTimeout(() => { document.getElementById('bulletHellGameMessage').textContent = ''; }, 2000);
    }

    function spawnBossCircleAttack() {
      const { boss } = bulletHellGame;
      const initialR = boss.r + 5;
      const maxR = Math.max(bulletHellGame.canvas.width, bulletHellGame.canvas.height) * 0.7; // å…‰åœˆæœ€å¤§åŠå¾„
      const growthRate = 100; // px/s
      const fadeRate = 0.5; // alpha per second
      const thickness = 5; // å…‰åœˆåšåº¦

      bulletHellGame.bossCircles.push({
          x: boss.x, y: boss.y,
          r: initialR, alpha: 1,
          maxR: maxR, growthRate: growthRate, fadeRate: fadeRate,
          thickness: thickness,
          damage: boss.damage
      });
    }

    function spawnBossSmallBalls() {
      const { player, boss } = bulletHellGame;
      const bulletR = 4;
      const bulletSpeed = 250;

      for (let i = 0; i < boss.smallBallsPerAttack; i++) {
          const angle = Math.atan2(player.y - boss.y, player.x - boss.x) + (Math.random() - 0.5) * Math.PI / 8; // ç•¥å¾®æ•£å°„
          const vx = bulletSpeed * Math.cos(angle);
          const vy = bulletSpeed * Math.sin(angle);
          bulletHellGame.bossSmallBullets.push({
              x: boss.x, y: boss.y, r: bulletR, vx: vx, vy: vy, damage: boss.damage
          });
      }
    }

    // --- é“å…·åº”ç”¨ä¸æ¸¸æˆç»“æŸ ---
    function applyPowerUp(type) {
      const { player, canvas } = bulletHellGame;
      document.getElementById('bulletHellGameMessage').textContent = `${getTranslation('powerUp' + type.charAt(0).toUpperCase() + type.slice(1))}!`; // æ˜¾ç¤ºæ”¶é›†åˆ°çš„é“å…·
      setTimeout(() => { document.getElementById('bulletHellGameMessage').textContent = ''; }, 1000); // 1ç§’åæ¸…é™¤æ¶ˆæ¯

      switch (type) {
        case 'speed':
          player.speed = player.normalSpeed * 1.5;
          bulletHellGame.currentSpeedBoostTimer = bulletHellGame.powerUpDuration; // é“å…·æŒç»­æ—¶é—´
          break;
        case 'heal':
          bulletHellGame.lives = Math.min(5, bulletHellGame.lives + 1); // æœ€å¤š5æ¡å‘½
          break;
        case 'shrink':
          player.shrinkFactor = 0.6; // ç¼©å°åˆ°æ­£å¸¸å°ºå¯¸çš„60%
          bulletHellGame.currentShrinkTimer = bulletHellGame.powerUpDuration; // é“å…·æŒç»­æ—¶é—´
          break;
        case 'invincible':
          player.invulnerable = true;
          player.invulnerableTimer = bulletHellGame.powerUpDuration; // é“å…·æŒç»­æ—¶é—´
          break;
        case 'teleport':
          // ç¬ç§»åˆ°éšæœºå®‰å…¨ä½ç½®ï¼ˆè¿œç¦»å½“å‰å¼¹å¹•æœ€å¯†é›†åŒºåŸŸï¼Œæˆ–ç›´æ¥ç¬ç§»åˆ°å±å¹•ä¸­å¤®ï¼‰
          player.x = canvas.width / 2;
          player.y = canvas.height / 2;
          break;
      }
      updateBulletHellUI();
    }

    function gameOverBulletHell() {
      bulletHellGame.running = false;
      if (bulletHellGame.animationFrameId) {
        cancelAnimationFrame(bulletHellGame.animationFrameId);
      }
      document.getElementById('bulletHellGameMessage').textContent = `${getTranslation('gameOverBulletHell')} ${getTranslation('score')}${Math.floor(bulletHellGame.score)}!`;
      document.getElementById('bulletHellStartBtn').textContent = getTranslation('restartGame');
    }

    // --- é”®ç›˜å’Œè§¦æ‘¸æ§åˆ¶ ---
    function handleBulletHellKeyDown(e) {
      bulletHellGame.keys[e.key] = true;
    }

    function handleBulletHellKeyUp(e) {
      bulletHellGame.keys[e.key] = false;
    }

    function handleBulletHellTouchStart(e) {
      e.preventDefault();
      bulletHellGame.isTouchDragging = true;
      const touch = e.touches[0];
      const rect = bulletHellGame.canvas.getBoundingClientRect();
      // ç›´æ¥å°†ç©å®¶ç§»åŠ¨åˆ°è§¦æ‘¸ä½ç½®
      const newX = touch.clientX - rect.left;
      const newY = touch.clientY - rect.top;
      const effectivePlayerR = bulletHellGame.player.r * bulletHellGame.player.shrinkFactor;
      bulletHellGame.player.x = Math.max(effectivePlayerR, Math.min(bulletHellGame.canvas.width - effectivePlayerR, newX));
      bulletHellGame.player.y = Math.max(effectivePlayerR, Math.min(bulletHellGame.canvas.height - effectivePlayerR, newY));
    }

    function handleBulletHellTouchMove(e) {
      e.preventDefault();
      if (bulletHellGame.isTouchDragging) {
        const touch = e.touches[0];
        const rect = bulletHellGame.canvas.getBoundingClientRect();
        const newX = touch.clientX - rect.left;
        const newY = touch.clientY - rect.top;

        // ä¿æŒç©å®¶åœ¨ç”»å¸ƒå†…
        const effectivePlayerR = bulletHellGame.player.r * bulletHellGame.player.shrinkFactor;
        bulletHellGame.player.x = Math.max(effectivePlayerR, Math.min(bulletHellGame.canvas.width - effectivePlayerR, newX));
        bulletHellGame.player.y = Math.max(effectivePlayerR, Math.min(bulletHellGame.canvas.height - effectivePlayerR, newY));
      }
    }

    function handleBulletHellTouchEnd(e) {
      bulletHellGame.isTouchDragging = false;
    }

    document.addEventListener('keydown', (e) => {
      const activePage = document.querySelector('.page.active');
      if (!activePage) return; // No active page, do nothing

      const activePageId = activePage.id;

      switch (activePageId) {
        case 'page-wordle':
          if (wordleState && !wordleState.gameOver) {
            const k = e.key;
            if (k === 'Enter') { onKey('Enter'); e.preventDefault(); }
            else if (k === 'Backspace') { onKey('Back'); e.preventDefault(); }
            else if (/^[a-z]$/i.test(k)) { onKey(k.toUpperCase()); }
          }
          break;

        case 'page-math':
          if (mathGame.gameRunning) {
            // The event listener on the input field already handles 'Enter'
            // No need to duplicate here, but ensure focus is on input
            document.getElementById('mathAnswerInput').focus();
          } else { // If not running, maybe allow Escape to go back
            if (e.key === 'Escape') {
              showPage('page-learning');
              e.preventDefault();
            }
          }
          break;
        case 'page-2048':
          if (grid2048 && !grid2048.gameOver) {
            const key = e.key;
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'w', 'a', 's', 'd'].includes(key)) {
              performMove(key);
              e.preventDefault();
            }
          }
          break;
        case 'page-bullet-hell':
          if (bulletHellGame.running) {
            handleBulletHellKeyDown(e);
          }
          break;
        case 'page-name': // Allow Enter key for name input
          if (e.key === 'Enter') {
            enterEarth();
            e.preventDefault();
          }
          break;
        case 'page-notepad': // Allow Escape to go back to main menu
          if (e.key === 'Escape') {
            showPage('page-main');
          }
          break;
        // Other pages can be added here if they need specific key handling
      }
    });

    document.addEventListener('keyup', (e) => {
      const activePage = document.querySelector('.page.active');
      if (!activePage) return;

      const activePageId = activePage.id;
      if (activePageId === 'page-bullet-hell' && bulletHellGame.running) {
        handleBulletHellKeyUp(e);
      }
    });
  </script>
</body>
</html>